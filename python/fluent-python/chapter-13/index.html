<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Chapter 13 | Dongseok Kim</title> <meta name="author" content="Dongseok Kim"> <meta name="description" content="Interfaces, Protocols, and ABCs"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-light.min.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-dark.min.css" media="none" id="highlight_theme_dark"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://d0ngse0kkim.github.io/python/fluent-python/chapter-13/"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Chapter 13",
      "description": "Interfaces, Protocols, and ABCs",
      "published": "February 3, 2024",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Dongseok </span>Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">programming</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/python">Python</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/softwaredesign/">Software Design</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/tools/">Tools</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">hobbies</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/running">running</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">others</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/repositories">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/cv/">cv</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Chapter 13</h1> <p>Interfaces, Protocols, and ABCs</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#abstract">Abstract</a></div> <div><a href="#the-typing-map">The Typing Map</a></div> <div><a href="#two-kinds-of-protocols">Two Kinds of Protocols</a></div> <div><a href="#programming-ducks">Programming Ducks</a></div> <div><a href="#goose-typing">Goose Typing</a></div> <div><a href="#static-protocols">Static Protocols</a></div> <div><a href="#chapter-summary">Chapter Summary</a></div> <div><a href="#references">References</a></div> </nav> </d-contents> <h2 id="abstract">Abstract</h2> <p>This is a summary of chapter 13 of <a href="https://www.oreilly.com/library/view/fluent-python-2nd/9781492056348/" rel="external nofollow noopener" target="_blank">Fluent Python</a>. This chapter provides an overview of typing in Python, covering nominal and structural typing, runtime and static protocols, duck typing, defensive programming, and abstract base classes (ABCs). The chapter explains how to define and use ABCs, subclass an ABC, and implement <code>__subclasshook__</code> for your own ABCs. The chapter also covers best practices for protocol design and provides a summary of the content.</p> <h2 id="the-typing-map">The Typing Map</h2> <h3 id="nominal-typing-vs-structural-typing"><em>Nominal Typing vs Structural Typing</em></h3> <dl> <dt>Nominal Typing<sup id="fnref:wikipedia__nominal_type_system" role="doc-noteref"><a href="#fn:wikipedia__nominal_type_system" class="footnote" rel="footnote">1</a></sup> </dt> <dd>Nominal typing means that two variables are type-compatible if and only if their declarations name the same type. For example, in C, two struct types with different names in the same translation unit are never considered compatible, even if they have identical field declarations.</dd> <dt>Structural Typing<sup id="fnref:wikipedia__structural_type_system" role="doc-noteref"><a href="#fn:wikipedia__structural_type_system" class="footnote" rel="footnote">2</a></sup> </dt> <dd>In structural typing, an element is considered to be compatible with another if, for each feature within the second element’s type, a corresponding and identical feature exists in the first element’s type. Two types are considered to be identical if each is compatible with the other.</dd> </dl> <h3 id="typing-system-in-python"><em>Typing System in Python</em></h3> <table> <thead> <tr> <th>Kinds</th> <th>Version</th> <th>Type systems</th> <th>Timing</th> <th>Remarks</th> </tr> </thead> <tbody> <tr> <td><strong>Duck typing</strong></td> <td>Any Python</td> <td>Structural</td> <td>Runtime</td> <td>avoiding <code>isinstance</code> checks</td> </tr> <tr> <td><strong>Goose typing</strong></td> <td>Python &gt;= 2.6</td> <td>Nominal</td> <td>Runtime</td> <td>using <code>isinstance</code> checks against ABCs</td> </tr> <tr> <td><strong>Static typing</strong></td> <td>Python &gt;= 3.5</td> <td>Nominal</td> <td>Static</td> <td>PEP 484<sup id="fnref:pythonorg__PEP_484" role="doc-noteref"><a href="#fn:pythonorg__PEP_484" class="footnote" rel="footnote">3</a></sup> <br> type hints and <br> external type checker</td> </tr> <tr> <td><strong>Static duck typing</strong></td> <td>Python &gt;= 3.8</td> <td>Structural</td> <td>Static</td> <td>PEP 544<sup id="fnref:pythonorg__PEP_544" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup> <br> <code>typing.Protocol</code> <br> type hints and <br> external type checker</td> </tr> </tbody> </table> <dl> <dt>Duck typing</dt> <dd>Default typing system in Python.</dd> <dt>Goose typing</dt> <dd>Typing system which is supported by abstract base classes (ABCs). This typing system executes runtime checks of objects against ABCs. This typing system can be used in Python &gt;= 2.6. Refer PEP 3119<sup id="fnref:pythonorg__PEP_3119" role="doc-noteref"><a href="#fn:pythonorg__PEP_3119" class="footnote" rel="footnote">5</a></sup> and official documents of ABC<sup id="fnref:pythonorg__abc" role="doc-noteref"><a href="#fn:pythonorg__abc" class="footnote" rel="footnote">6</a></sup>.</dd> <dt>Static typing</dt> <dd>Traditional typing systems used in C and Java. Static typing system is available in Python &gt;= 3.5 by the <code>typing</code> module <sup id="fnref:pythonorg__typing" role="doc-noteref"><a href="#fn:pythonorg__typing" class="footnote" rel="footnote">7</a></sup> and it requires external type checker compatible with PEP 484<sup id="fnref:pythonorg__PEP_484:1" role="doc-noteref"><a href="#fn:pythonorg__PEP_484" class="footnote" rel="footnote">3</a></sup>.</dd> <dt>Static duck typing</dt> <dd>Typing system used in the Go language. Static duck typing is available in Python &gt;= 3.8, which can be used by using <code>typing.Protocol</code><sup id="fnref:pythonorg__typing_protocol" role="doc-noteref"><a href="#fn:pythonorg__typing_protocol" class="footnote" rel="footnote">8</a></sup> and it requires external type checker. Static duck typing system is added in PEP 544<sup id="fnref:pythonorg__PEP_544:1" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup>.</dd> </dl> <h2 id="two-kinds-of-protocols">Two Kinds of Protocols</h2> <p>In this book, the following terms are adopted.</p> <dl> <dt>Dynamic Protocol</dt> <dd>The informal protocols of Python. Dynamic protocols are implicit, defined by convention, described in the documentation. These protocols are supported by the Python interpreter. Documentation can be found in the Data Model Chapter of the Python Language Reference<sup id="fnref:pythonorg__data_model" role="doc-noteref"><a href="#fn:pythonorg__data_model" class="footnote" rel="footnote">9</a></sup> </dd> <dt>Static Protocol</dt> <dd>A protocol defined in PEP 544<sup id="fnref:pythonorg__PEP_544:2" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup>, since Python 3.8. Static protocol has an explicit definition which is defined by subclassing <code>typing.Protocol</code><sup id="fnref:pythonorg__typing_protocol:1" role="doc-noteref"><a href="#fn:pythonorg__typing_protocol" class="footnote" rel="footnote">8</a></sup> </dd> </dl> <p>The major differences between these two protocols are described below.</p> <ol> <li>The dynamic protocol does not require fulfilling all the protocol’s requirements. In contrast, the static protocol requires that the class with static protocol must implement every method declared in the protocol class.</li> <li>The static protocols can be verified by static type checkers. In constrast, dynamic protocols cannot be checked statically.</li> </ol> <h2 id="programming-ducks">Programming Ducks</h2> <p>This subchapter covers the sequence and iterable dynamic protocols.</p> <h3 id="python-digs-sequences">Python Digs Sequences</h3> <p><code>collections.abc.Sequence</code> is an ABC of sequence container type. Details of <code>collections.abc.Sequence</code> can be found in official documentation.<sup id="fnref:pythonorg__collections_abc_collections" role="doc-noteref"><a href="#fn:pythonorg__collections_abc_collections" class="footnote" rel="footnote">10</a></sup></p> <p>The following UML diagram describes the relationship between classes related to the <code>collections.abc.Sequence</code> class. The red-colored methods are abstract methods that must be implemented in concrete method that inherits the ABC. The blue-colored methods are mixin methods that are provided by the ABC or can be overridden by a subclass.</p> <div class="column mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-13/collections_abc_sequence.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-13/collections_abc_sequence.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-13/collections_abc_sequence.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-13/collections_abc_sequence.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML class diagram for the classes related with collections.abc.Sequence. <br>Red : Abstract methods, Blue : Mixin methods.</figcaption> </figure> </div> </div> <p>According to this UML diagram, a correct subclass of <code>collections.abc.Sequence</code> have these properties.</p> <ul> <li>A subclass of <code>collections.abc.Sequence</code> must implement the following abstract methods: <ol> <li><code>__getitem__</code></li> <li><code>__len__</code></li> </ol> </li> <li>A subclass of <code>collections.abc.Sequence</code> can inherit the following mixin methods, which can be overridden by the subclasses: <ol> <li><code>__contains__</code></li> <li><code>__iter__</code></li> <li><code>__reversed__</code></li> <li><code>index</code></li> <li><code>count</code></li> </ol> </li> </ul> <h4 id="sequence-like-classes"><em>Sequence like classes</em></h4> <p>A class that</p> <ol> <li>does not inherit from <code>collections.abc.Sequence</code> and</li> <li>does not implement all abstract methods of <code>collections.abc.Sequence</code> </li> </ol> <p>may still support some of the functions that <code>collections.abc.Sequence</code> does.</p> <p>The following is a partial implement of a <code>collection.abc.Sequence</code>-like class.</p> <pre><code class="language-python">&gt;&gt;&gt; class MyList:
...     def __init__(self, items):
...         self.items = items
...     def __getitem__(self, index):
...         return self.items[index]
&gt;&gt;&gt; mylist = MyList([1, 2, 3, 4, 5])
&gt;&gt;&gt; mylist[0]
1
&gt;&gt;&gt; mylist[-1]
5
&gt;&gt;&gt; for num in mylist: print(num)
...
1
2
3
4
5
&gt;&gt;&gt; 5 in mylist
True
&gt;&gt;&gt; 6 in mylist
False
</code></pre> <p>Despite the absence of several methods, instances of <code>MyList</code> are still usable as sequences.</p> <ol> <li>Despite the absence of <code>__iter__</code> method, iteration using <code>for</code> over the instances of the <code>MyList</code> class is available.</li> <li>Despite the absence of <code>__contains__</code> method, the <code>in</code> operator over the instances of the <code>MyList</code> class is available.</li> </ol> <p>Python manages to make iteration and <code>in</code> operator work by using <code>__getitem__</code> when <code>__iter__</code> and <code>__contains__</code> are unavailable.</p> <h3 id="monkey-patching-implementing-a-protocol-at-runtime">Monkey Patching: Implementing a Protocol at Runtime</h3> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="104b2c9d2ddd1aaed07a5971d754f5251aa732b1" path="01-data-model/frenchdeck.py" language="python" line="1-17"></div> <p>The <code>FrenchDeck</code> class does not have <code>__setitem__</code> method. Therefore, <code>random.shuffle</code><sup id="fnref:pythonorg__random_shuffle" role="doc-noteref"><a href="#fn:pythonorg__random_shuffle" class="footnote" rel="footnote">11</a></sup> on the instances of the <code>FrenchDeck</code> class raises an <code>TypeError</code>.</p> <pre><code class="language-python">&gt;&gt;&gt; import random
&gt;&gt;&gt; deck = FrenchDeck()
&gt;&gt;&gt; random.shuffle(deck)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/Users/user/.pyenv/versions/3.11.1/lib/python3.11/random.py", line 380, in shuffle
    x[i], x[j] = x[j], x[i]
    ~^^^
TypeError: 'FrenchDeck' object does not support item assignment
</code></pre> <p>In this situation, it is possible to make the <code>FrenchDeck</code> class to support <code>random.shuffle</code> by adding <code>__setitem__</code> method outside of the implementation of the <code>FrenchDeck</code> class.</p> <pre><code class="language-python">&gt;&gt;&gt; def setitem(instance, position, item):
...     instance._cards[position] = item
...
&gt;&gt;&gt; FrenchDeck.__setitem__ = setitem
&gt;&gt;&gt; deck = FrenchDeck()
&gt;&gt;&gt; random.shuffle(deck)
&gt;&gt;&gt; deck[:5]
[Card(rank='8', suit='hearts'), Card(rank='10', suit='clubs'), Card(rank='5', suit='diamonds'), Card(rank='8', suit='spades'), Card(rank='3', suit='clubs')]
</code></pre> <p>The <code>random.shuffle</code> method only requires the argument’s class to implement the methods from the mutable sequence protocol. It does not mandate that the argument’s class belongs to a specific type or class.</p> <h3 id="defensive-programming-and-fail-fast">Defensive Programming and “Fail Fast”</h3> <h4 id="an-example-of-__init__-method"><em>An Example of <code>__init__</code> Method</em></h4> <pre><code class="language-python">    def __init__(self, iterable):
        self.data = list(data)
</code></pre> <p>In this example, the <code>__init__</code> function invokes <code>list()</code> on the <code>iterable</code> argument instead of restricting the argument to the <code>list</code> type. By doing this, it offers the following advantages.</p> <ol> <li>The <code>__init__</code> function can accepts any iterable.</li> <li>If the <code>__init__</code> function accepts a non-iterable argument, it raises a <code>TypeError</code> exception during the object initialization phase.</li> </ol> <p>However, there are also some potential disadvantages to consider:</p> <ol> <li>Data that should not be copied cannnot be used.</li> <li>Infinite generator as argument can consume all available memory. <ul> <li>This disadvantage can be resolved by calling the <code>len()</code> function on the <code>iterable</code> argument.</li> </ul> </li> </ol> <h4 id="an-example-of-error-handling-with-duck-typing"><em>An Example of Error Handling with Duck Typing</em></h4> <pre><code class="language-python">try:
    field_names = field_names.replace(',', ' ').split()  # &lt;1&gt;
except AttributeError:  # &lt;2&gt;
    pass  # &lt;3&gt;
field_names = tuple(field_names)  # &lt;4&gt;
if not all(s.isidentifier() for s in field_names):  # &lt;5&gt;
    raise ValueError('field_names must all be valid identifiers')
</code></pre> <ul> <li> <code>&lt;1&gt;</code> : Assume <code>field_names</code> is a <code>str</code> and split with <code>,</code> or ` ` with <code>str.split</code><sup id="fnref:pythonorg__built_in_types_str_split" role="doc-noteref"><a href="#fn:pythonorg__built_in_types_str_split" class="footnote" rel="footnote">12</a></sup>.</li> <li> <code>&lt;2&gt;</code> : If <code>field_names</code> is not a <code>str</code>, assume it as sequence of <code>str</code>.</li> <li> <code>&lt;3&gt;</code> : In case of sequence of <code>str</code>, there is no need to split string.</li> <li> <code>&lt;4&gt;</code> : To make sure that <code>field_names</code> is sequence of <code>str</code>, make <code>tuple</code> of <code>str</code> with <code>tuple()</code> </li> <li> <code>&lt;5&gt;</code> : Check all strings in <code>field_names</code> to ensure that each string is a valid name for an attributes of the class.</li> </ul> <h2 id="goose-typing">Goose Typing</h2> <p>Python does not have an <code>interface</code> keyword. Instead of using functions related the <code>interface</code> keyword, it is necessary to use abstract base classes in Python for explicit type checking at runtime.</p> <p>abstract base class<sup id="fnref:pythonorg__glossary_abstract_base_class" role="doc-noteref"><a href="#fn:pythonorg__glossary_abstract_base_class" class="footnote" rel="footnote">13</a></sup> in Python glossary explains the advantage of introducing ABC into duck typing:</p> <blockquote> <p>Abstract base classes complement duck-typing<sup id="fnref:pythonorg__glossary_duck_typing" role="doc-noteref"><a href="#fn:pythonorg__glossary_duck_typing" class="footnote" rel="footnote">14</a></sup> by providing a way to define interfaces when other techniques like <code>hasattr()</code><sup id="fnref:pythonorg__built_in_functions_hasattr" role="doc-noteref"><a href="#fn:pythonorg__built_in_functions_hasattr" class="footnote" rel="footnote">15</a></sup> would be clumsy or subtly wrong (for example with magic methods<sup id="fnref:pythonorg__data_model_special_lookup" role="doc-noteref"><a href="#fn:pythonorg__data_model_special_lookup" class="footnote" rel="footnote">16</a></sup> ). ABCs introduce virtual subclasses, which are classes that don’t inherit from a class but are still recognized by <code>isinstance()</code><sup id="fnref:pythonorg__built_in_functions_isinstance" role="doc-noteref"><a href="#fn:pythonorg__built_in_functions_isinstance" class="footnote" rel="footnote">17</a></sup> and <code>issubclass()</code><sup id="fnref:pythonorg__built_in_functions_issubclass" role="doc-noteref"><a href="#fn:pythonorg__built_in_functions_issubclass" class="footnote" rel="footnote">18</a></sup>; see the <code>abc</code> module documentation<sup id="fnref:pythonorg__abc:1" role="doc-noteref"><a href="#fn:pythonorg__abc" class="footnote" rel="footnote">6</a></sup>.</p> </blockquote> <h3 id="summary-of-waterfowl-and-abcs-and-comments-of-author"><em>Summary of Waterfowl and ABCs and comments of author</em></h3> <ul> <li>Subclassing from ABCs to explicitly indicate that you are implementing a previously defined interface.</li> <li>Use ABCs for runtime type checking instead of concrete classes as the second argument for <code>isinstance</code> and <code>issubclass</code>. <ul> <li>Runtime type checking with ABCs is more acceptable and does not limit polymorphism.</li> <li>Enforcing an API contract is possible using runtime type checking with ABCs.</li> </ul> </li> <li>Replace runtime type checking with concrete classes using <code>if</code>/<code>elif</code>/<code>else</code> with polymorphism.</li> <li>Avoid defining custom ABCs or metaclasses; instead, use the predefined ABCs provided. <ul> <li>ABCs are intended to encapsulate very general concepts and abtractions introduced by a framework, such as sequences and exact numbers.</li> <li>In most cases, it is sufficient to use an existing ABCs instead of creating a new one.</li> </ul> </li> </ul> <h3 id="subclassing-an-abc">Subclassing an ABC</h3> <h4 id="collectionsabcmutablesequence"><code>collections.abc.MutableSequence</code></h4> <div class="column mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-13/collections_abc_mutablesequence.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-13/collections_abc_mutablesequence.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-13/collections_abc_mutablesequence.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-13/collections_abc_mutablesequence.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML class diagram for the classes related with collections.abc.MutableSequence. <br>Red : Abstract methods, Blue : Mixin methods.</figcaption> </figure> </div> </div> <p>The above figure is a UML class diagram of classes related with <code>collections.abc.MutableSequence</code>. According to the above figure, <code>collections.abc.MutableSequence</code> must implement the following abstract method.</p> <ul> <li><code>__getitem__</code></li> <li><code>__setitem__</code></li> <li><code>__delitem__</code></li> <li><code>__len__</code></li> <li><code>insert</code></li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/frenchdeck2.py" language="python" line="1-26"></div> <p>In order to satisfy the requirement from abstract methods of <code>collections.abc.MutableSequence</code>, The new <code>FrenchDeck2</code> have to implement <code>__setitem__</code>, <code>__delitem__</code>, and <code>insert</code> methods.</p> <h3 id="abcs-in-the-standard-library">ABCs in the Standard Library</h3> <div class="column mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-13/collections_abc.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-13/collections_abc.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-13/collections_abc.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-13/collections_abc.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML class diagram for the classes in collections.abc module.</figcaption> </figure> </div> </div> <dl> <dt> <code>Iterable</code>, <code>Container</code>, <code>Sized</code> </dt> <dd>Basic classes for ABCs of collection. <code>Iterable</code> supports iteration with <code>__iter__</code>. <code>Containter</code> supports the <code>in</code> operator with <code>__contains__</code>. <code>Sized</code> supports built-in <code>len()</code> function with <code>__len__</code>.</dd> <dt><code>Collection</code></dt> <dd>Subclass of <code>Iterable</code>, <code>Container</code> and <code>Sized</code>. It was added in Python 3.6 to improve the efficiency of subclassing.</dd> <dt> <code>Sequence</code>, <code>Mapping</code>, <code>Set</code> </dt> <dd>Main immutable collection types.</dd> <dt> <code>MutableSequence</code>, <code>MutableMapping</code>, <code>MutableSet</code> </dt> <dd>Main mutable collection types.</dd> <dt> <code>KeysView</code>, <code>ItemsView</code>, <code>ValuesView</code> </dt> <dd>Classes for objects returned from <code>dict.keys()</code>, <code>dict.values()</code> and <code>dict.items()</code>. <code>KeysView</code> and <code>ItemsView</code> support methods from the <code>Set</code> class.</dd> <dt><code>Iterator</code></dt> <dd> <code>Iterator</code> must implement a <code>__next__</code> method that returns succesive items in the stream and raises a <code>StopIteration</code> exception after the final item has been returned. Any further invocation of the <code>__next__</code> method raises the <code>StopIteration</code> exception indicating that the iterator object is exhausted. <code>Iterator</code> also must implement <code>__iter__</code> method that returns the iterator object itself. For more information, Refer to the Glossary page <sup id="fnref:pythonorg__glossary_iterator" role="doc-noteref"><a href="#fn:pythonorg__glossary_iterator" class="footnote" rel="footnote">19</a></sup> and Built-in Types<sup id="fnref:pythonorg__built_in_types_iterator" role="doc-noteref"><a href="#fn:pythonorg__built_in_types_iterator" class="footnote" rel="footnote">20</a></sup> of iterator in official documentation.</dd> <dt> <code>Callable</code>, <code>Hashable</code> </dt> <dd>This supports type checking objects that must be callable or hashable.</dd> </dl> <h3 id="defining-and-using-an-abc">Defining and Using an ABC</h3> <p>Defining Interfaces and providing type hints to support static typing can be achieved by using abstract base classes in Python.</p> <p>The following example creates a <code>Tombola</code> ABC that provides a non-repeating random-picking process framework. The <code>Tombola</code> ABC has the following four methods:</p> <ul> <li> <code>.load(...)</code> : Abstract method <ul> <li>Put items into the container.</li> </ul> </li> <li> <code>.pick()</code> : Abstract method <ul> <li>Remove and return a random item from the container.</li> </ul> </li> <li> <code>loaded()</code> : Concrete method <ul> <li>Return <code>True</code> if there is at lease one item in the containter.</li> </ul> </li> <li> <code>inspect()</code> : Concrete method <ul> <li>Return a <code>tuple</code> that holds the items currently in the container, without changing its contents.</li> <li>The internal ordering of the items in the container is not preserved.</li> </ul> </li> </ul> <div class="column mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-13/tombola.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-13/tombola.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-13/tombola.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-13/tombola.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML class diagram for the <code>Tombola</code> ABC.<br>Red : Abstract methods, Blue : Mixin methods. </figcaption> </figure> </div> </div> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="13-protocol-abc/tombola.py" language="python" line="3-31"></div> <ul> <li> <code>&lt;1&gt;</code>: To define an ABC, subclass <code>abc.ABC</code> </li> <li> <code>&lt;2&gt;</code>, <code>&lt;3&gt;</code>: Abstract methods can be defined using <code>abc.abstractmethod</code> decorator.</li> <li> <code>&lt;4&gt;</code> : ABC can define concrete methods.</li> <li> <code>&lt;5&gt;</code>, <code>&lt;6&gt;</code>, <code>&lt;7&gt;</code> : Concrete method must rely only on the interface defined by the ABC.</li> <li> <code>.pick()</code> <code>.inspect()</code> method uses <code>LookupError</code> for checking whether the container is empty <ul> <li> <code>LookupError</code> covers <code>IndexError</code> for sequences and <code>KeyError</code> for mappings.</li> <li>For details of exception hierarchy, refer an official document of exceptions<sup id="fnref:pythonorg__exceptions_hierarchy" role="doc-noteref"><a href="#fn:pythonorg__exceptions_hierarchy" class="footnote" rel="footnote">21</a></sup>.</li> </ul> </li> </ul> <h3 id="abc-syntax-details">ABC Syntax Details</h3> <pre><code class="language-python">import abc

class NewABC(abc.ABC):
    @classmethod
    @abc.abstractmethod
    def new_classmethod(cls, ...):
        pass

    @staticmethod
    @abc.abstractmethod
    def new_staticmethod(...):
        pass
</code></pre> <p>To define an abstract class method and an abstract static method, you can use the <code>abc.abstractmethod</code> decorator in combination with the <code>classmethod</code> or <code>staticmethod</code> decorator. It’s important to note that the <code>abc.abstractmethod</code> decorators should be applied as the innermost decorator.</p> <h3 id="subclassing-an-abc-1">Subclassing an ABC</h3> <p>The following examples present the definition of concrete classes subclassing the <code>Tombola</code> ABC.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/bingo.py" language="python" line="3-26"></div> <ul> <li> <code>&lt;1&gt;</code> : Subclass <code>Tombola</code> ABC.</li> <li> <code>&lt;2&gt;</code> : <code>random.SystemRandom</code> implements the random API using the <code>os.urandom()</code> function, which provides random bytes suitable for cryptographic use.</li> <li> <code>&lt;3&gt;</code> : Load initial items using the <code>.load()</code> method in <code>Tombola</code> ABC.</li> <li> <code>&lt;4&gt;</code> : Shuffles items in the container using the <code>random.SystemRandom</code> instance.</li> <li> <code>&lt;5&gt;</code> : Implement the abstract method <code>.pick()</code> in <code>Tombola</code> ABC.</li> <li> <code>&lt;6&gt;</code> : Make instances of class <code>BingoCage</code> callable.</li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="13-protocol-abc/lotto.py" language="python" line="3-27"></div> <ul> <li> <code>&lt;1&gt;</code> : The argument <code>iterable</code> accepts any iterable which can be used to build a <code>list</code>.</li> <li> <code>&lt;2&gt;</code> : <code>random.randrange()</code> raises <code>ValueError</code> if the range is empty.</li> <li> <code>&lt;3&gt;</code> : The randomly selected item is popped.</li> <li> <code>&lt;4&gt;</code> : Override the <code>.loaded()</code> method in the <code>Tombola</code> ABC using <code>bool()</code>. This makes <code>.loaded()</code> method faster and more memory-efficient compared to the original implementation in the <code>Tombola</code> ABC.</li> <li> <code>&lt;5&gt;</code> : Override the <code>.inspect()</code> method in the <code>Tombola</code> ABC using <code>tuple()</code>.</li> </ul> <h3 id="a-virtual-subclass-of-an-abc">A Virtual Subclass of an ABC</h3> <p>An important characteristic of goose typing is the ability to register a class as a <em>virtual subclass</em> of an ABC, even if it does not inherit from it. By doing this, It is possible to ensure that the class implements the interface defined in the ABC.</p> <div class="column mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-13/tombolist.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-13/tombolist.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-13/tombolist.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-13/tombolist.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML class diagram for the <code>TomboList</code> ABC.<br>Red : Abstract methods, Blue : Mixin methods. </figcaption> </figure> </div> </div> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="13-protocol-abc/tombolist.py" language="python" line="1-23"></div> <ul> <li> <code>&lt;1&gt;</code> : Registering a class as a virtual subclass of an ABC can be done by calling the <code>register</code> class method of the ABC.</li> <li> <code>&lt;2&gt;</code> : <code>TomboList</code> extents <code>list</code> instead of <code>Tombola</code> ABC.</li> <li> <code>&lt;3&gt;</code>, <code>&lt;4&gt;</code>, <code>&lt;6&gt;</code> : Use the boolean behavior and <code>.pop()</code> method, inherited from <code>list</code> class.</li> <li> <code>&lt;5&gt;</code> : Implement the <code>load</code> abstract method using the <code>extent</code> method from the <code>list</code> class.</li> <li> <code>&lt;7&gt;</code> : It is possible to register a class as a virtual subclass after its implementation. <ul> <li>This is useful when registering a class that you do not maintain, but which satisfies the interface.</li> </ul> </li> </ul> <p>By doing this, the registered <code>TomboList</code> class will be recognized as subclass by the following calling methods.</p> <ul> <li><code>issubclass(TomboList, Tombola)</code></li> <li><code>isinstance(TomboList(...), Tombola)</code></li> </ul> <h3 id="usage-of-register-in-practice">Usage of register in Practice</h3> <p>The following codes from CPython use the <code>.register()</code> class method of the <code>Sequence</code> ABC to register the <code>tuple</code>, <code>str</code>, <code>range</code> and <code>memoryview</code> classes as virtual subclasses.</p> <div class="embed-github-src" repo="python/cpython" branch="0bbf30e2b910bc9c5899134ae9d73a8df968da35" path="Lib/_collections_abc.py" language="python" line="1078-1081"></div> <h3 id="structural-typing-with-abcs">Structural Typing with ABCs</h3> <dl> <dt>Nominal Typing Aspect of ABC</dt> <dd>Subclassing ABC or registering as a virtual subclasses of ABC makes <code>issubclass(SubClass, ABCClass)</code> returns <code>True</code>.</dd> <dt>Structural Typing Aspect of ABC</dt> <dd>Some ABCs support structural typing, which enable the usage of <code>issubclass()</code> and <code>isinstance()</code> without requiring subclassing or virtual subclass registeration.<br> The structural typing aspect of an ABC can be supported by implementing a special class method <code>__subclasshook__()</code>. For example, the <code>__subclasshook__()</code> method of <code>Sized</code> class checks whether the class argument has an attribute named <code>__len__</code> and returns <code>True</code>, which means the class in the argument is subclass of the <code>Sized</code> class.<br> The following example shows the structural typing aspect of the <code>collections.abc.Sized</code> class. The <code>__subclasshook__()</code> method searches for <code>__len__()</code> method in the <code>__dict__</code> of the class.</dd> </dl> <pre><code class="language-python">class HaveLenClass:
    def __len__(self): return 10

from collections import abc
print(isinstance(HaveLenClass(), abc.Sized)) # True
print(issubclass(HaveLenClass, abc.Sized)) # True
</code></pre> <div class="embed-github-src" repo="python/cpython" branch="0fbddb14dc03f61738af01af88e7d8aa8df07336" path="Lib/_collections_abc.py" language="python" line="369-381"></div> <div class="embed-github-src" repo="python/cpython" branch="0fbddb14dc03f61738af01af88e7d8aa8df07336" path="Lib/_collections_abc.py" language="python" line="74-84"></div> <h4 id="implementing-__subclasshook__-for-your-own-abcs"><em>Implementing <code>__subclasshook__</code> for your own ABCs</em></h4> <p>It is not a good idea to implement <code>__subclasshook__</code> for your own ABCs, as it can be risky to make assumptions based on the existence of method implementation in the interface provided by the ABC.</p> <p>The <code>abc.Sequence</code> class does not implement <code>__subclasshook__</code>. It is impossible to check whether an class is a subclass of <code>abc.Sequence</code> or not based on the existence of methods <code>__len__</code>, <code>__getitem__</code> and <code>__iter__</code> because subclasses of <code>Mapping</code> also have these method.</p> <p>In most use cases, it is more effective and comprehensive to use subclassing or virtual subclass registering with ABCs compared to using the structural typing aspect of ABCs.</p> <h2 id="static-protocols">Static Protocols</h2> <p>A protocol defined in PEP 544<sup id="fnref:pythonorg__PEP_544:3" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup>, since Python 3.8. Static protocol has an explicit definition which is defined by subclassing <code>typing.Protocol</code><sup id="fnref:pythonorg__typing_protocol:2" role="doc-noteref"><a href="#fn:pythonorg__typing_protocol" class="footnote" rel="footnote">8</a></sup></p> <p>The static protocols can be verified by static type checkers. In constrast, dynamic protocols cannot be checked statically.</p> <h3 id="the-typed-double-function">The Typed double Function</h3> <p>In this example, the following simple <code>double</code> function will be typed statically by subclassing <code>typing.Protocol</code><sup id="fnref:pythonorg__typing_protocol:3" role="doc-noteref"><a href="#fn:pythonorg__typing_protocol" class="footnote" rel="footnote">8</a></sup></p> <pre><code class="language-python">&gt;&gt;&gt; def double(x):
...     return x * 2
...
&gt;&gt;&gt; double(1.5)
3.0
&gt;&gt;&gt; double('A')
'AA'
&gt;&gt;&gt; double([10, 20, 30])
[10, 20, 30, 10, 20, 30]
&gt;&gt;&gt; from fractions import Fraction
&gt;&gt;&gt; double(Fraction(2, 5))
Fraction(4, 5)
</code></pre> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/double/double_protocol.py" language="python"></div> <ul> <li> <code>&lt;1&gt;</code>, <code>&lt;2&gt;</code> : The <code>__mul__</code> method in the <code>Repeatable</code> protocol defines a static protocol that can annotate the type of the argument for the <code>double</code> function. The type annotation <code>T</code> on the argument <code>self</code> and return value represents that the result type of the <code>double</code> method is the same as the type of <code>self</code>.</li> <li> <code>&lt;3&gt;</code> : The <code>RT</code> type variable is bounded by the <code>Repeatable</code> protocol.</li> <li> <code>&lt;4&gt;</code> : The type checker can ensure that the type of the argument <code>x</code> must support multiplication, or the <code>__mul__</code> method. Furthermore, the type checker verifies that the type of the argument <code>x</code> is the same as the type of return value of the <code>double</code> function.</li> </ul> <h3 id="runtime-checkable-static-protocols">Runtime Checkable Static Protocols</h3> <p>The above example illustrates the usage of <code>typing.Protocol</code> to describe a static type checking feature of a subclass of the <code>typing.Protocol</code>. This subclass of <code>typing.Protocol</code> allows for type checking during compile time, but by using the <code>runtime_checkable</code> decorator<sup id="fnref:pythonorg__typing_runtime_checkable" role="doc-noteref"><a href="#fn:pythonorg__typing_runtime_checkable" class="footnote" rel="footnote">22</a></sup>, it can also be used for runtime type checking.</p> <p>There are several predefined protocols that are available to use for runtime type-checking:</p> <ol> <li> <code>class typing.SupportsComplex</code><sup id="fnref:pythonorg__typing_supportscomplex" role="doc-noteref"><a href="#fn:pythonorg__typing_supportscomplex" class="footnote" rel="footnote">23</a></sup> : An ABC with one abstract method, <code>__complex__</code>.</li> <li> <code>class typing.SupportsFloat</code><sup id="fnref:pythonorg__typing_supportsfloat" role="doc-noteref"><a href="#fn:pythonorg__typing_supportsfloat" class="footnote" rel="footnote">24</a></sup> : An ABC with one abstract method, <code>__float__</code>.</li> </ol> <p>The source code below defines <code>class typing.SupportsComplex</code> in CPython:</p> <div class="embed-github-src" repo="python/cpython" branch="3635388f52b42e5280229104747962117104c453" path="Lib/typing.py" language="python" line="1751-1758"></div> <p>It includes an abstract method <code>__complex__</code> that takes only a <code>self</code> argument and returns a <code>complex</code>. This method defines an ABC that support compatibility to convert to <code>complex</code>.</p> <p>The <code>runtime_checkable</code> decorator is applied to the <code>typing.SupportsComplex</code> to provice a runtime type-checking facility.</p> <p>The class uses an empty <code>__slots__</code> for optimizing memory usage.</p> <pre><code class="language-python">&gt;&gt;&gt; from typing import SupportsComplex
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; c64 = np.complex64(3+4j)
&gt;&gt;&gt; isinstance(c64, complex)
False
&gt;&gt;&gt; isinstance(c64, SupportsComplex)
True
&gt;&gt;&gt; c = complex(c64)
&gt;&gt;&gt; c
(3+4j)
&gt;&gt;&gt; isinstance(c, SupportsComplex)
False
&gt;&gt;&gt; complex(c)
(3+4j)
&gt;&gt;&gt; isinstance(c, (complex, SupportsComplex))
True
&gt;&gt;&gt; import numbers
&gt;&gt;&gt; isinstance(c, numbers.Complex)
True
&gt;&gt;&gt; isinstance(c64, numbers.Complex)
True
</code></pre> <p><code>isinstance(val, SupportsComplex)</code> works well for <code>val</code> that is compatible with conversion to <code>Complex</code>, but does not work for <code>val</code> that is an instance of <code>Complex</code>. To handle this problem, you can use the following methods to call the <code>isinstance</code> method:</p> <ol> <li><code>isinstance(val, (complex, typing.SupportsComplex))</code></li> <li> <code>isinstance(val, numbers.Complex)</code> : Note that this convention is not recommended because it is not recognized by static type checkers.</li> </ol> <h3 id="duck-typing-is-your-friend">Duck Typing Is Your Friend</h3> <p>It is possible to simplify a type-checking process by using duck typing.</p> <h4 id="runtime-type-checking-with-static-protocoltypingprotocol">Runtime Type-checking with Static Protocol(<code>typing.Protocol</code>)</h4> <pre><code class="language-python">if isinstance(o, (complex, SupportsComplex)):
    # do something that requires `o` to be convertible to complex
else:
    raise TypeError('o must be convertible to complex')
</code></pre> <h4 id="goose-typing-isinstance-with-abc">Goose Typing (<code>isinstance</code> with ABC)</h4> <pre><code class="language-python">if isinstance(o, numbers.Complex):
    # do something with `o`, an instance of `Complex`
else:
    raise TypeError('o must be an instance of Complex')
</code></pre> <h4 id="duck-typing-with-a-custom-message">Duck Typing with a Custom Message</h4> <pre><code class="language-python">try:
    c = complex(o)
except TypeError as exc:
    raise TypeError('o must be convertible to complex') from exc
</code></pre> <h4 id="duck-typing-with-a-predefined-message">Duck Typing with a Predefined Message</h4> <pre><code class="language-python">c = complex(o)
</code></pre> <h3 id="limitations-of-runtime-protocol-checks">Limitations of Runtime Protocol Checks</h3> <p><code>isinstance</code>/<code>issubclass</code> checks only examine the presence or absence of methods, without verifying their signatures, or type annotations.</p> <p>In Python 3.9, there are <code>__float__</code> method on class <code>Complex</code> for purpose of raising <code>TypeError</code> exception. This causes instances of <code>Complex</code> to pass <code>isinstance</code>/<code>issubclass</code> checks on <code>typing.SupportsFloat</code>:</p> <pre><code class="language-python">&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.version
'3.9.5 (v3.9.5:0a7dcbdb13, May 3 2021, 13:17:02) \n[Clang 6.0 (clang-600.0.57)]'
&gt;&gt;&gt; c = 3+4j
&gt;&gt;&gt; c.__float__
&lt;method-wrapper '__float__' of complex object at 0x10a16c590&gt;
&gt;&gt;&gt; c.__float__()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: can't convert complex to float
&gt;&gt;&gt; from typing import SupportsFloat
&gt;&gt;&gt; c = 3+4j
&gt;&gt;&gt; isinstance(c, SupportsFloat)
True
&gt;&gt;&gt; issubclass(complex, SupportsFloat)
True
</code></pre> <h3 id="supporting-a-static-protocol">Supporting a Static Protocol</h3> <h4 id="supporting-a-static-protocol-without-static-type-checking-coverage"><em>Supporting a Static Protocol without Static Type-Checking Coverage</em></h4> <p>It is possible to check type in runtime by implementing <code>__complex__</code> method on class <code>Vector2d</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/typing/vector2d_v4.py" language="python" line="166-171"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/typing/vector2d_v4.py" language="python" line="89-97"></div> <h4 id="supporting-a-static-protocol-with-static-type-checking-coverage"><em>Supporting a Static Protocol with Static Type-Checking Coverage</em></h4> <p>Static type-checking is available by providing type annotation to the <code>__abs__</code>, <code>__complex__</code> and <code>fromcomplex</code> method.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/typing/vector2d_v5.py" language="python" line="164-173"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/typing/vector2d_v5.py" language="python" line="91-98"></div> <h3 id="designing-a-static-protocol">Designing a Static Protocol</h3> <p>A simple static protocol with only one method is more useful and flexible compared to a static protocol with multiple methods.</p> <p>The ABC <code>Tombola</code> specifies two method: <code>load</code> and <code>pick</code>. Based in the previous statement regarding static protocol definition, it is recommended to define a static protocol with only the <code>pick</code> method for implementing a random picking process.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/typing/randompick.py" language="python"></div> <p>Usages of the static protocol <code>RandomPicker</code> is described in the following example codes:</p> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="13-protocol-abc/typing/randompick_test.py" language="python"></div> <ul> <li> <code>&lt;5&gt;</code> : This type hint is available because <code>SimplePicker</code> is consistent-with <code>RandomPicker</code>.</li> <li> <code>&lt;6&gt;</code> : This test will be passed because <code>isinstance(popper, RandomPicker)</code> will returns <code>True</code>.</li> <li> <code>&lt;8&gt;</code> : Mypy will display that <code>Revealed type is 'Any'</code>.</li> </ul> <h3 id="best-practices-for-protocol-design">Best Practices for Protocol Design</h3> <h4 id="designing-protocols"><em>Designing Protocols</em></h4> <dl> <dt>Define a narrow protocol</dt> <dd>It is clear that a narrow protocol is more useful. Such protocols often have only a single method, rarely more than a couple of methods. This resolves tight coupling between the methods used for defining the protocol. This also satisfies Interface segregation principle<sup id="fnref:wikipedia__interface_segregation_principle" role="doc-noteref"><a href="#fn:wikipedia__interface_segregation_principle" class="footnote" rel="footnote">25</a></sup>.</dd> <dt>Define a protocol near the function that uses it</dt> <dd>It is recommended to define a static protocol in “client code” instead of the library code. This resolves tight coupling between the “client code” and library code.</dd> </dl> <p>Martin Fowler wrote a post defining role interface<sup id="fnref:external__martin_fowler_roleinterface" role="doc-noteref"><a href="#fn:external__martin_fowler_roleinterface" class="footnote" rel="footnote">26</a></sup>, a useful idea to keep in mind when designing protocols.</p> <h4 id="naming-conventions-for-protocols-"> <em>Naming Conventions for Protocols</em> <sup id="fnref:github__python_typeshed_contributing" role="doc-noteref"><a href="#fn:github__python_typeshed_contributing" class="footnote" rel="footnote">27</a></sup> </h4> <dl> <dt>Use plain names for protocols that represent a clear concept</dt> <dd> <code>Iterator</code>, <code>Container</code> </dd> <dt>Use <code>SupportsX</code> for protocols that provide callable methods</dt> <dd> <code>SupportsInt</code>, <code>SupportsRead</code>, <code>SupportsReadSeek</code> </dd> <dt>Use <code>HasX</code> for protocols that have readable and/or writable attributes or getter/setter methods</dt> <dd> <code>HasItems</code>, <code>HasFileno</code> </dd> </dl> <h3 id="extending-a-protocol">Extending a Protocol</h3> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/typing/randompick.py" language="python"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e" branch="8a330d822b997c7992d0b7675c82ad75832300c6" path="13-protocol-abc/typing/randompickload.py" language="python"></div> <ul> <li> <code>&lt;1&gt;</code> : If you want to make an extended protocol runtime-checkable, you must apply the <code>runtime_checkable</code> decorator to it.</li> <li> <code>&lt;2&gt;</code> : In order to create an extended protocol, it is necessary to explicitly include <code>typing.Protocol</code> as one of its base classes in addition to the protocol being extended. Unlike regular inheritance in Python, this is a requirement. <sup id="fnref:pythonorg__PEP_544_merging_and_extending_protocols" role="doc-noteref"><a href="#fn:pythonorg__PEP_544_merging_and_extending_protocols" class="footnote" rel="footnote">28</a></sup> </li> <li> <code>&lt;3&gt;</code> : We only need to define the additional method required to define the new extended protocol.</li> </ul> <h3 id="the-numbers-abcs-and-numeric-protocols">The numbers ABCs and Numeric Protocols</h3> <ul> <li>Using <code>isinstance</code> with classes in <code>numbers</code><sup id="fnref:pythonorg__numbers" role="doc-noteref"><a href="#fn:pythonorg__numbers" class="footnote" rel="footnote">29</a></sup> : Runtime-checkable but impossible to static-type-check.</li> <li>Using <code>Union</code> and <code>TypeVar</code> on numeric types in the standard library : impossible to use on numeric types outside of the standard library. <ul> <li><code>_Number = Union[float, Decimal, Fraction]</code></li> <li><code>_NumberT = TypeVar('_NumberT', float, Decimal, Fraction)</code></li> </ul> </li> <li>Using the numeric protocols provided by the <code>typing</code> module. <sup id="fnref:pythonorg__typing_protocols" role="doc-noteref"><a href="#fn:pythonorg__typing_protocols" class="footnote" rel="footnote">30</a></sup> : Recommended, but some of use cases, such as <code>SupportsFloat</code> on <code>complex</code> in Python 3.9, are problematic. <ul> <li> <code>SupportsComplex</code>, <code>SupportsFloat</code> </li> </ul> </li> </ul> <h2 id="chapter-summary">Chapter Summary</h2> <h3 id="the-typing-map-1">The Typing Map</h3> <table> <thead> <tr> <th>Kinds</th> <th>Version</th> <th>Type systems</th> <th>Timing</th> <th>Remarks</th> </tr> </thead> <tbody> <tr> <td><strong>Duck typing</strong></td> <td>Any Python</td> <td>Structural</td> <td>Runtime</td> <td>avoiding <code>isinstance</code> checks</td> </tr> <tr> <td><strong>Goose typing</strong></td> <td>Python &gt;= 2.6</td> <td>Nominal</td> <td>Runtime</td> <td>using <code>isinstance</code> checks against ABCs</td> </tr> <tr> <td><strong>Static typing</strong></td> <td>Python &gt;= 3.5</td> <td>Nominal</td> <td>Static</td> <td>PEP 484<sup id="fnref:pythonorg__PEP_484:2" role="doc-noteref"><a href="#fn:pythonorg__PEP_484" class="footnote" rel="footnote">3</a></sup> <br> type hints and <br> external type checker</td> </tr> <tr> <td><strong>Static duck typing</strong></td> <td>Python &gt;= 3.8</td> <td>Structural</td> <td>Static</td> <td>PEP 544<sup id="fnref:pythonorg__PEP_544:4" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup> <br> <code>typing.Protocol</code> <br> type hints and <br> external type checker</td> </tr> </tbody> </table> <h3 id="two-kinds-of-protocol">Two Kinds of Protocol</h3> <dl> <dt>Dynamic Protocol</dt> <dd>The informal protocols of Python. Dynamic protocols are implicit, defined by convention, described in the documentation. These protocols are supported by the Python interpreter. Documentation can be found in the Data Model Chapter of the Python Language Reference<sup id="fnref:pythonorg__data_model:1" role="doc-noteref"><a href="#fn:pythonorg__data_model" class="footnote" rel="footnote">9</a></sup> </dd> <dt>Static Protocol</dt> <dd>A protocol defined in PEP 544<sup id="fnref:pythonorg__PEP_544:5" role="doc-noteref"><a href="#fn:pythonorg__PEP_544" class="footnote" rel="footnote">4</a></sup>, since Python 3.8. Static protocol has an explicit definition which is defined by subclassing <code>typing.Protocol</code><sup id="fnref:pythonorg__typing_protocol:4" role="doc-noteref"><a href="#fn:pythonorg__typing_protocol" class="footnote" rel="footnote">8</a></sup> </dd> </dl> <h3 id="programming-ducks-1">Programming Ducks</h3> <ul> <li>An abstract of <code>collections.abc.Sequence</code><sup id="fnref:pythonorg__collections_abc_collections:1" role="doc-noteref"><a href="#fn:pythonorg__collections_abc_collections" class="footnote" rel="footnote">10</a></sup> </li> <li>Monkey patching for satisfying dynamic protocol at runtime</li> </ul> <h3 id="goose-typing-1">Goose Typing</h3> <ul> <li>Subclassing from library defined ABCs</li> <li>Implementation of an user defined ABC</li> <li>Subclassing from the user defined ABC</li> <li>Registering a class as a virtual subclass of an ABC using <code>register</code> method.</li> <li> <code>isinstance</code> against ABCs <ul> <li>Nominal Typing Aspect of ABC by using <code>issubclass(SubClass, ABCClass)</code> </li> <li>Structural Typing Aspect of ABC and <code>__subclasshook__()</code> method</li> </ul> </li> </ul> <h3 id="static-protocols-1">Static Protocols</h3> <ul> <li>Definition of a static protocol using subclass of <code>typing.Protocol</code> </li> <li>Type annotation using a static protocol</li> <li>Runtime type check with a static protocol</li> <li>How to make the existing class support a static protocol</li> <li>How to design a static protocol and best practices for protocol design</li> <li>How to extend an existing protocol</li> <li>Usage of <code>numbers</code> ABCs and numeric protocols</li> </ul> <h2 id="references">References</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:wikipedia__nominal_type_system" role="doc-endnote"> <p><a href="https://en.wikipedia.org/wiki/Nominal_type_system" rel="external nofollow noopener" target="_blank">Wikipedia : Nominal Type System</a> <a href="#fnref:wikipedia__nominal_type_system" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:wikipedia__structural_type_system" role="doc-endnote"> <p><a href="https://en.wikipedia.org/wiki/Structural_type_system" rel="external nofollow noopener" target="_blank">Wikipedia : Structural Type System</a> <a href="#fnref:wikipedia__structural_type_system" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__PEP_484" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0484/" rel="external nofollow noopener" target="_blank">PEP 484 – Type Hints</a> <a href="#fnref:pythonorg__PEP_484" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__PEP_484:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a> <a href="#fnref:pythonorg__PEP_484:2" class="reversefootnote" role="doc-backlink">↩<sup>3</sup></a></p> </li> <li id="fn:pythonorg__PEP_544" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0544/" rel="external nofollow noopener" target="_blank">PEP 544 – Protocols: Structural subtyping (static duck typing)</a> <a href="#fnref:pythonorg__PEP_544" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__PEP_544:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a> <a href="#fnref:pythonorg__PEP_544:2" class="reversefootnote" role="doc-backlink">↩<sup>3</sup></a> <a href="#fnref:pythonorg__PEP_544:3" class="reversefootnote" role="doc-backlink">↩<sup>4</sup></a> <a href="#fnref:pythonorg__PEP_544:4" class="reversefootnote" role="doc-backlink">↩<sup>5</sup></a> <a href="#fnref:pythonorg__PEP_544:5" class="reversefootnote" role="doc-backlink">↩<sup>6</sup></a></p> </li> <li id="fn:pythonorg__PEP_3119" role="doc-endnote"> <p><a href="https://peps.python.org/pep-3119/" rel="external nofollow noopener" target="_blank">PEP 3119 – Introducing Abstract Base Classes</a> <a href="#fnref:pythonorg__PEP_3119" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__abc" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/abc.html" rel="external nofollow noopener" target="_blank">abc — Abstract Base Classes</a> <a href="#fnref:pythonorg__abc" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__abc:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a></p> </li> <li id="fn:pythonorg__typing" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html" rel="external nofollow noopener" target="_blank">typing — Support for type hints</a> <a href="#fnref:pythonorg__typing" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__typing_protocol" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.Protocol" rel="external nofollow noopener" target="_blank">typing — Support for type hints : <code>typing.Protocol</code></a> <a href="#fnref:pythonorg__typing_protocol" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__typing_protocol:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a> <a href="#fnref:pythonorg__typing_protocol:2" class="reversefootnote" role="doc-backlink">↩<sup>3</sup></a> <a href="#fnref:pythonorg__typing_protocol:3" class="reversefootnote" role="doc-backlink">↩<sup>4</sup></a> <a href="#fnref:pythonorg__typing_protocol:4" class="reversefootnote" role="doc-backlink">↩<sup>5</sup></a></p> </li> <li id="fn:pythonorg__data_model" role="doc-endnote"> <p><a href="https://docs.python.org/3/reference/datamodel.html" rel="external nofollow noopener" target="_blank">The Python Language Reference » 3. Data model</a> <a href="#fnref:pythonorg__data_model" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__data_model:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a></p> </li> <li id="fn:pythonorg__collections_abc_collections" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes" rel="external nofollow noopener" target="_blank">collections.abc — Abstract Base Classes for Containers : Collections Abstract Base Classes</a> <a href="#fnref:pythonorg__collections_abc_collections" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:pythonorg__collections_abc_collections:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a></p> </li> <li id="fn:pythonorg__random_shuffle" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/random.html#random.shuffle" rel="external nofollow noopener" target="_blank">random — Generate pseudo-random numbers : random.shuffle(x)</a> <a href="#fnref:pythonorg__random_shuffle" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__built_in_types_str_split" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/stdtypes.html#str.split" rel="external nofollow noopener" target="_blank">Built-in Types : <code>str.split</code></a> <a href="#fnref:pythonorg__built_in_types_str_split" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__glossary_abstract_base_class" role="doc-endnote"> <p><a href="https://docs.python.org/3/glossary.html#term-abstract-base-class" rel="external nofollow noopener" target="_blank">Glossary : abstract base class</a> <a href="#fnref:pythonorg__glossary_abstract_base_class" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__glossary_duck_typing" role="doc-endnote"> <p><a href="https://docs.python.org/3/glossary.html#term-duck-typing" rel="external nofollow noopener" target="_blank">Glossary : duck typing</a> <a href="#fnref:pythonorg__glossary_duck_typing" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__built_in_functions_hasattr" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/functions.html#hasattr" rel="external nofollow noopener" target="_blank">Built-in Functions : <code>hasattr</code></a> <a href="#fnref:pythonorg__built_in_functions_hasattr" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__data_model_special_lookup" role="doc-endnote"> <p><a href="https://docs.python.org/3/reference/datamodel.html#special-lookup" rel="external nofollow noopener" target="_blank">The Python Language Reference » 3. Data model : 3.3.11. Special method lookup</a> <a href="#fnref:pythonorg__data_model_special_lookup" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__built_in_functions_isinstance" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/functions.html#isinstance" rel="external nofollow noopener" target="_blank">Built-in Functions : <code>isinstance</code></a> <a href="#fnref:pythonorg__built_in_functions_isinstance" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__built_in_functions_issubclass" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/functions.html#issubclass" rel="external nofollow noopener" target="_blank">Built-in Functions : <code>issubclass</code></a> <a href="#fnref:pythonorg__built_in_functions_issubclass" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__glossary_iterator" role="doc-endnote"> <p><a href="https://docs.python.org/3/glossary.html#term-iterator" rel="external nofollow noopener" target="_blank">Glossary : <code>iterator</code></a> <a href="#fnref:pythonorg__glossary_iterator" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__built_in_types_iterator" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/stdtypes.html#iterator-types" rel="external nofollow noopener" target="_blank">Built-in Types : Iterator Types</a> <a href="#fnref:pythonorg__built_in_types_iterator" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__exceptions_hierarchy" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy" rel="external nofollow noopener" target="_blank">Built-in Exceptions : Exception hierarchy</a> <a href="#fnref:pythonorg__exceptions_hierarchy" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__typing_runtime_checkable" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.runtime_checkable" rel="external nofollow noopener" target="_blank">typing — Support for type hints : <code>typing.runtime_checkable</code></a> <a href="#fnref:pythonorg__typing_runtime_checkable" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__typing_supportscomplex" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.SupportsComplex" rel="external nofollow noopener" target="_blank">typing — Support for type hints : <code>typing.SupportsComplex</code></a> <a href="#fnref:pythonorg__typing_supportscomplex" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__typing_supportsfloat" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.SupportsFloat" rel="external nofollow noopener" target="_blank">typing — Support for type hints : <code>typing.SupportsFloat</code></a> <a href="#fnref:pythonorg__typing_supportsfloat" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:wikipedia__interface_segregation_principle" role="doc-endnote"> <p><a href="https://en.wikipedia.org/wiki/Interface_segregation_principle" rel="external nofollow noopener" target="_blank">Wikipedia : Interface segregation principle</a> <a href="#fnref:wikipedia__interface_segregation_principle" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:external__martin_fowler_roleinterface" role="doc-endnote"> <p><a href="https://martinfowler.com/bliki/RoleInterface.html" rel="external nofollow noopener" target="_blank">Martin Fowler : RoleInterface</a> <a href="#fnref:external__martin_fowler_roleinterface" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:github__python_typeshed_contributing" role="doc-endnote"> <p><a href="https://github.com/python/typeshed/blob/main/CONTRIBUTING.md#conventions" rel="external nofollow noopener" target="_blank">Python Repository : Contributing to typeshed</a> <a href="#fnref:github__python_typeshed_contributing" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__PEP_544_merging_and_extending_protocols" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0544/#merging-and-extending-protocols" rel="external nofollow noopener" target="_blank">PEP 544 – Protocols: Structural subtyping (static duck typing) : Merging and extending protocols</a> <a href="#fnref:pythonorg__PEP_544_merging_and_extending_protocols" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__numbers" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/numbers.html" rel="external nofollow noopener" target="_blank">numbers — Numeric abstract base classes</a> <a href="#fnref:pythonorg__numbers" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:pythonorg__typing_protocols" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#protocols" rel="external nofollow noopener" target="_blank">typing — Support for type hints : Protocols</a> <a href="#fnref:pythonorg__typing_protocols" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Dongseok Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script> <script>hljs.highlightAll();</script> <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script> <script>hljs.initLineNumbersOnLoad();</script> <script>function append_code_block_header(e){if(!e.className)return;const[t,r]=get_language_and_url(e);r&&(replace_className(e,t),elemCodeBlockHeader=create_elem_code_block_header(r),append_elem_code_block_header_to_previous(e,elemCodeBlockHeader))}function get_language_and_url(e){return e.className.split(/:(.*)/s)}function replace_className(e,t){e.classList.remove(e.className),e.classList.add(t)}function create_elem_code_block_header(e){var t=document.createElement("a");return t.textContent=e,(e.startsWith("http://")||e.startsWith("https://"))&&(t.setAttribute("href",e),t.setAttribute("target","_blank")),t.className="language-plaintext",t}function append_elem_code_block_header_to_previous(e,t){var r=e.parentElement;r.insertBefore(t,r.firstChild),r.classList.add("code-block-header")}function embed_external_source(e){var t=get_url_raw(e),r=get_url_blob(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c),_={startFrom:Math.max(l,1)};e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c,_)})["catch"](function(e){throw e})}function embed_local_source(e){var t=get_url_raw_local(e),r=get_url_blob_local(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c);e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c)})["catch"](function(e){throw e})}function get_url_raw(e){return["https://raw.githubusercontent.com",e.getAttribute("repo"),e.getAttribute("branch"),e.getAttribute("path")].join("/")}function get_url_blob(e){return["https://github.com",e.getAttribute("repo"),"blob",e.getAttribute("branch"),e.getAttribute("path")+get_line_specifier(e)].join("/")}function get_url_raw_local(e){return e.getAttribute("path")}function get_url_blob_local(e){return get_url_raw_local(e)}function get_lines(e){const t=e.getAttribute("line");if(!t)return[0,0];var[r,n]=t.split(/-(.*)/s);return r=parseInt(r),n=parseInt(n),isNaN(r)&&(r=0),isNaN(n)&&(n=0),[r,n]}function get_line_specifier(e){const t=get_lines(e);return 0==t[0]&&0==t[1]?"":(0==t[1]&&t[1],"#L"+String(t[0])+"-L"+String(t[1]))}function create_elem_code_block(e,t,r,n,c){var l=document.createElement("code");return l.className="language-"+e+":"+t,l.textContent=slice_by_line_number(r,n,c),l}function slice_by_line_number(e,t,r){return 0==t&&0==r?e:(0==t&&(t=1),e.split("\n").slice(t-1,r).join("\n"))}function create_elem_pre_from_code_block(e){var t=document.createElement("pre");return t.appendChild(e),append_code_block_header(e),t}const code=document.getElementsByTagName("code");Array.from(code).forEach(append_code_block_header);var divs=document.getElementsByClassName("embed-github-src");Array.prototype.forEach.call(divs,embed_external_source);divs=document.getElementsByClassName("embed-local-src");Array.prototype.forEach.call(divs,embed_local_source);</script> </body> </html>