<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Chapter 15 | Dongseok Kim</title> <meta name="author" content="Dongseok Kim"> <meta name="description" content="More About Type Hints"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-light.min.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-dark.min.css" media="none" id="highlight_theme_dark"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://d0ngse0kkim.github.io/python/fluent-python/chapter-15/"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Chapter 15",
      "description": "More About Type Hints",
      "published": "February 3, 2024",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">DongseokÂ </span>Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">programming</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/python">Python</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/softwaredesign/">Software Design</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/tools/">Tools</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">hobbies</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/running">running</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">others</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/repositories">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/cv/">cv</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Chapter 15</h1> <p>More About Type Hints</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#abstract">Abstract</a></div> <div><a href="#overloaded-signatures">Overloaded Signatures</a></div> <div><a href="#max-overload">Max Overload</a></div> <div><a href="#typeddict">TypedDict</a></div> <div><a href="#type-casting">Type Casting</a></div> <div><a href="#reading-type-hints-at-runtime">Reading Type Hints at Runtime</a></div> <div><a href="#implementing-a-generic-class">Implementing a Generic Class</a></div> <div><a href="#variance">Variance</a></div> <div><a href="#implementing-a-generic-static-protocol">Implementing a Generic Static Protocol</a></div> <div><a href="#chapter-summary">Chapter Summary</a></div> <div><a href="#further-reading">Further Reading</a></div> <div><a href="#links">Links</a></div> </nav> </d-contents> <h2 id="abstract">Abstract</h2> <p>This is a summary of chapter 15 of <a href="https://www.oreilly.com/library/view/fluent-python-2nd/9781492056348/" rel="external nofollow noopener" target="_blank">Fluent Python</a><sup id="fnref:bible" role="doc-noteref"><a href="#fn:bible" class="footnote" rel="footnote">1</a></sup>. This chapter provides tips for type annotation in Python.</p> <h2 id="overloaded-signatures">Overloaded Signatures</h2> <p>It is possible to allow for accepting different combination of arguments by using <code>@typing.overload</code><sup id="fnref:pythonorg__typing_overload" role="doc-noteref"><a href="#fn:pythonorg__typing_overload" class="footnote" rel="footnote">2</a></sup> decorator.</p> <h3 id="example-of-sum-built-in-function"><em>Example of <code>sum()</code> built-in function</em></h3> <p>The following result from the Python interpreter is the execution result of <code>help(sum)</code><sup id="fnref:pythonorg__builtinfunctions_sum" role="doc-noteref"><a href="#fn:pythonorg__builtinfunctions_sum" class="footnote" rel="footnote">3</a></sup>.</p> <pre><code class="language-python">&gt;&gt;&gt; help(sum)
sum(iterable, /, start=0)
    Return the sum of a 'start' value (default: 0) plus an iterable of numbers

    When the iterable is empty, return the start value.
    This function is intended specifically for use with numeric values and may
    reject non-numeric types.
</code></pre> <p>This indicates the following aspect of the argument <code>iterable</code>:</p> <ol> <li>The argument <code>iterable</code> is positional-only parameter because <code>iterable</code> is positioned before the <code>/</code> syntax.<br> (Details of <code>/</code> syntax can be found in PEP 570<sup id="fnref:pythonorg__pep570" role="doc-noteref"><a href="#fn:pythonorg__pep570" class="footnote" rel="footnote">4</a></sup>.)</li> <li>The argument <code>iterable</code> has no default value, therefore it is mandatory to specify the <code>iterable</code> when calling <code>sum</code> function.</li> <li>The argument <code>iterable</code> has to be of <code>typing.Iterable</code> type.</li> </ol> <p>This indicates the following aspect of the argument <code>start</code>:</p> <ol> <li>The argument <code>start</code> is positional or keyword parameter because <code>start</code> is positioned after the <code>/</code> syntax and there is no <code>*</code> syntax.<br> (Details of <code>/</code> and <code>*</code> syntax can be found in PEP 570<sup id="fnref:pythonorg__pep570:1" role="doc-noteref"><a href="#fn:pythonorg__pep570" class="footnote" rel="footnote">4</a></sup>.)</li> <li>The argument <code>start</code> has default value <code>0</code>, therefore it is optional to specify the <code>start</code> argument.</li> <li>When the argument <code>start</code> is not specified, <code>start</code> is automatically set to <code>0</code>, which is of type <code>int</code>.</li> </ol> <p>Therefore, the following cases are possible combination of arguments types and return values types.</p> <ol> <li>In the case where <code>start</code> is not specified: <ul> <li> <code>iterable: typing.Iterable[_T]</code> is an arbitrary type <code>_T = TypeVar('_T')</code> of <code>typing.Iterable</code>.</li> <li> <code>start</code> is not specified.</li> <li>The return type is <code>_T</code> or <code>int</code> which is type of default value of <code>start</code>.</li> </ul> </li> <li>In the case where <code>start</code> is specified: <ul> <li> <code>iterable: typing.Iterable[_T]</code> is an arbitrary type <code>_T = typing.TypeVar('_T')</code> of <code>typing.Iterable</code>,\</li> <li> <code>start</code> is an arbitrary type <code>_S = typing.TypeVar(_S)</code>,\</li> <li>The return type is <code>_T</code> or <code>_S</code>.</li> </ul> </li> </ol> <p>This two cases can be found in the following python typeshed source codes.</p> <div class="embed-github-src" repo="python/typeshed" branch="a8834fcd46339e17fc8add82b5803a1ce53d3d60" path="stdlib/2and3/builtins.pyi" language="python" line="25-29"></div> <div class="embed-github-src" repo="python/typeshed" branch="a8834fcd46339e17fc8add82b5803a1ce53d3d60" path="stdlib/2and3/builtins.pyi" language="python" line="1434-1437"></div> <p>The same implementation can be found in the Fluent Python book.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/mysum.py" language="python"></div> <ul> <li> <code>&lt;1&gt;</code> : <code>T = TypeVar('T')</code> is a type for the argument <code>it</code>, and <code>S = TypeVar('S')</code> is a type for the argument <code>start</code>.</li> <li> <code>&lt;2&gt;</code> : Type annotations are provided in the case where <code>start</code> is not specified. <ul> <li>The return type can be <code>T</code> or the type of the default value of <code>start</code>, which is <code>int</code>.</li> </ul> </li> <li> <code>&lt;3&gt;</code> : Type annotations are provided in the case where <code>start</code> is specified. <ul> <li>The return type can be <code>T</code> or <code>S</code>.</li> </ul> </li> <li> <code>&lt;4&gt;</code> : This is the implementation of the <code>sum()</code> function.</li> </ul> <p>It is possible to find many examples that use <code>@typing.overload</code> decorator in the stub file for built-in types in the Python standard library <sup id="fnref:github__python_typeshed_stdlib_2and3_builtins_pyi" role="doc-noteref"><a href="#fn:github__python_typeshed_stdlib_2and3_builtins_pyi" class="footnote" rel="footnote">5</a></sup>.</p> <h2 id="max-overload">Max Overload</h2> <p>In this sub chapter, the following <code>max()</code> function will be type-annotated by six <code>@typing.overload</code> decorator syntax.</p> <h3 id="implementation-of-max-function"><em>Implementation of <code>max()</code> function</em></h3> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="12-13"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="37-60"></div> <p>The logic of <code>max()</code> function can be described as follows:</p> <ol> <li>If <code>args</code> are not empty which means there are 2 or more positional parameter except for the <code>key</code> and <code>default</code> arguments, assign the following data to each variables: <ul> <li> <code>candidate</code> : Assign the first positional parameter (argument <code>first</code>).</li> <li> <code>series</code> : The iterator starting from the second, third fourth, and so on positional parameters (argument <code>args</code>).</li> </ul> </li> <li>If <code>args</code> is empty, which means there is only one positional parameter except for the <code>key</code> and <code>default</code> arguments, assign the following data to each variables: <ul> <li> <code>series</code> : Generate an iterator using <code>iter(first)</code> and assign it to <code>series</code>. This process assumes that <code>first</code> must be iterable. If <code>first</code> is not iterable, an exception will be raised.</li> <li> <code>candidate</code> : If the iterator generation <code>iter(first)</code> is successful, the first item from the iterator <code>series</code> will be assigned to <code>candidate</code> and the iterator will consume the first item of it by <code>next(series)</code>. <ul> <li>If it is impossible to get item from the iterator by using <code>next(series)</code> because there are no further items produced by the iterator <code>series</code>, try to return the default value from the argument <code>default</code>. If the argument <code>default</code> is not specified, raise <code>ValueError(EMPTY_MSG)</code>.</li> </ul> </li> </ul> </li> <li>If the argument <code>key</code> is not specified (in the case of <code>key == None</code>), find the maximum value using inequality operator <code>&lt;</code> in the items from the variable <code>candidate</code> and the iterator <code>series</code>.</li> <li>If the argument <code>key</code> is specified with function, items from the variable <code>candidate</code> and the iterator <code>series</code> is compared by <code>key(item)</code> and the inequality operator <code>&lt;</code>.</li> <li>Return the maximum value stored in <code>candidate</code>.</li> </ol> <h3 id="type-hint-by-using-typingoverload-decorator"><em>Type hint by using <code>@typing.overload</code> decorator</em></h3> <p>According to the logic of <code>max()</code> function, the eight combinations of arguments can be provided. Before explaining the implementation of type hint using <code>@typing.overload</code> decorator, import and define some types and variables.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="2-13"></div> <table> <thead> <tr> <th>Symbol</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>SupportsLessThan</code></td> <td>Static protocol which is used to type hint an object that can accepts the <code>&lt;</code> operator</td> </tr> <tr> <td><code>LT</code></td> <td>Type variable which is used to type hint an object that implements <code>SupportsLessThan</code> protocol</td> </tr> <tr> <td><code>T</code></td> <td>Type variable which is used to type hint an object that is used as an argument of the <code>key</code> function</td> </tr> <tr> <td><code>DT</code></td> <td>Type variable which is used to type hint an object that is used to the argument <code>default</code> </td> </tr> </tbody> </table> <dl> <dt>Case 1 : In the case where multiple arguments are provided and <code>key</code>, <code>default</code> </dt> <dt>is not provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td>positional arguments</td> <td>multiple arguments implementing <code>__lt__</code> </td> </tr> <tr> <td><code>key</code></td> <td>not provided</td> </tr> <tr> <td><code>default</code></td> <td>not provided</td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="15-17"></div> <p>To type hint that the multiple positional argument must support the <code>&lt;</code> operator, the type variable <code>LT</code> is used.</p> <p>Because the variable <code>__arg1</code> and <code>__arg2</code> are used, two or more positional arguments must be provided. Note that double underscores <code>__</code> are used to avoid potential naming conflicts.</p> <p><code>key: None = ...</code> indicates that type of parameter <code>key</code> is <code>None</code> and the ellipsis <code>...</code> indicates that the implementation of the default value is omitted in this type hint. However, an actual default value is provided by the implementation of the <code>max()</code> function.</p> <dl> <dt>Case 2 : In the case where single iterable arguments is provided and <code>key</code>,</dt> <dt> <code>default</code> is not provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td>positional arguments</td> <td>single iterable argument yielding objects implementing <code>__lt__</code> </td> </tr> <tr> <td><code>key</code></td> <td>not provided</td> </tr> <tr> <td><code>default</code></td> <td>not provided</td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="21-23"></div> <p>There is only one parameter before <code>*</code>. This indicates that single argument must be provided. This argument is annotated with <code>__iterable: Iterable[LT]</code>, which means that <code>__iterable</code> is iterable which yields objects supporting <code>&lt;</code> operator.</p> <p><code>*</code> on the parameter list indicates that <code>key</code> and <code>default</code> are keyword only parameters<sup id="fnref:pythonorg__pep570_syntax_and_semantics" role="doc-noteref"><a href="#fn:pythonorg__pep570_syntax_and_semantics" class="footnote" rel="footnote">6</a></sup>.</p> <dl> <dt>Case 3 : In the case where multiple arguments are provided, <code>key</code> is provided</dt> <dt>but <code>default</code> is not provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>provided, function that returns objects implementing <code>__lt__</code> </td> </tr> <tr> <td><code>default</code></td> <td>not provided</td> </tr> <tr> <td>positional arguments</td> <td>multiple arguments with the same type that can be an argument of the <code>key</code> function</td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="18-20"></div> <p>The part of positional arguments is same as in case 1. Note that the return type is <code>T</code>, which is the same as the type of <code>__arg1</code>, <code>__arg2</code> and <code>args</code>.</p> <dl> <dt>Case 4 : In the case where single iterable arguments is provided, <code>key</code> is</dt> <dt>provided but <code>default</code> is not provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>provided, function that returns objects implementing <code>__lt__</code> </td> </tr> <tr> <td><code>default</code></td> <td>not provided</td> </tr> <tr> <td>positional arguments</td> <td>single iterable yielding objects that can be an argument of the <code>key</code> function</td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="24-26"></div> <dl> <dt>Case 5 : In the case where multiple arguments are provided, <code>key</code> is not</dt> <dt>provided and <code>default</code> is provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>not provided</td> </tr> <tr> <td><code>default</code></td> <td>provided</td> </tr> <tr> <td>positional arguments</td> <td>multiple arguments implementing <code>__lt__</code> </td> </tr> </tbody> </table> <pre><code class="language-python">@overload
def max(__arg1: LT, __arg2: LT, *args: LT, key: None = ...,
        default: DT) -&gt; Union[LT, DT]:
    ...
</code></pre> <p>The part of positional arguments is the same as in case 1 and case 3. Note that the return type is <code>Union[LT, DT]</code>, which implies that the return value can be either the specified argument or the default value specified by the <code>default</code> parameter.</p> <dl> <dt>Case 6 : In the case where single iterable arguments is provided, <code>key</code> is not</dt> <dt>provided and <code>default</code> is provided</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>not provided</td> </tr> <tr> <td><code>default</code></td> <td>provided</td> </tr> <tr> <td>positional arguments</td> <td>single argument yielding objects implementing <code>__lt__</code> </td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="28-30"></div> <dl> <dt>Case 7 : In the case where multiple arguments are provided and <code>key</code> and</dt> <dt> <code>default</code> is provided.</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>provided, function that returns objects implementing <code>__lt__</code> </td> </tr> <tr> <td><code>default</code></td> <td>provided</td> </tr> <tr> <td>positional arguments</td> <td>multiple arguments with the same type that can be an argument of the <code>key</code> function</td> </tr> </tbody> </table> <pre><code class="language-python">@overload
def max(__arg1: T, __arg2: T, *args: T, key: Callable[[T], LT],
        default: DT) -&gt; Union[LT, DT]:
    ...
</code></pre> <dl> <dt>Case 8 : In the case where single iterable arguments is provided and <code>key</code> and</dt> <dt> <code>default</code> is provided.</dt> <dd>In this case, the following combination of arguments is provided.</dd> </dl> <table> <thead> <tr> <th>Argument</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td>provided, function that returns objects implementing <code>__lt__</code> </td> </tr> <tr> <td><code>default</code></td> <td>provided</td> </tr> <tr> <td>positional arguments</td> <td>single iterable yielding objects that can be an argument of the <code>key</code> function</td> </tr> </tbody> </table> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/protocol/mymax/mymax.py" language="python" line="32-34"></div> <h2 id="typeddict">TypedDict</h2> <p><code>typing.TypedDict</code><sup id="fnref:pythonorg__typing_typeddict" role="doc-noteref"><a href="#fn:pythonorg__typing_typeddict" class="footnote" rel="footnote">7</a></sup> can be used to provide type hints for a <code>dict</code> object with predefined types for each values of keys. For example, suppose adding a type annotation to the following JSON object.</p> <pre><code class="language-json">{
    "isbn": "0134757599",
    "title": "Refactoring, 2e",
    "authors": ["Martin Fowler", "Kent Beck"],
    "pagecount": 478
}
</code></pre> <p>It is possible to attempt to provide type hint for this JSON object by using the following conventional type annotations.</p> <ol> <li> <code>dict[str, Any]</code> : The values may be of any type.</li> <li> <code>dict[str, typing.Union[str, list[str], int]]</code> : Although difficult to read, it is possible to narrow the range of possible types of values compared to the type hint above.</li> </ol> <p>Adopting the second type annotation cannot prevent the key of <code>"isbn"</code> from becoming an object of <code>list[str]</code>. This problem can be solved by using <code>typing.TypedDict</code>.</p> <p><code>typing.TypedDict</code> was introduced by PEP 589<sup id="fnref:pythonorg__pep589" role="doc-noteref"><a href="#fn:pythonorg__pep589" class="footnote" rel="footnote">8</a></sup>. <code>typing.TypedDict</code> provides type hints for dictionaries with a fixed set of keys. The following code is an example of type hints for the above JSON object.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/books.py" language="python" line="3-9"></div> <p><code>typing.TypedDict</code> provides the following functionality.</p> <ol> <li>Provide type hints for each âfieldâ of <code>dict</code> to the type checker. <ul> <li>Assigning an incompatible type for a field raises error by the type checker.</li> <li>Assigning to a key that is not defined in the class definition raises an error by the type checker.</li> <li>Deleting a key that is defined in the class definition raises an error by the type checker.</li> </ul> </li> <li>Class-like syntax to provide type hints for each field. <ul> <li>It is possible to generate a constructor by subclassing <code>typing.TypedDict</code> class, as shown in the example above with <code>BookDict</code>.</li> </ul> </li> <li>There is no runtime type checking facility. Therefore, the above type checking facilities are not provided during runtime.</li> <li>A generated constructor such as <code>BookDict</code> has the same effect as calling the <code>dict</code> constructor with the same arguments. <ul> <li>The defined fields, like <code>isbn: str</code>, does not create instance attributes.</li> <li>Setting default values for fields and method definitions is not allowed.</li> <li>It is possible to set undefined fields on subclass definition.</li> </ul> </li> </ol> <h3 id="several-demos-on-the-book"><em>Several Demos on the book</em></h3> <h4 id="example-15-5-using-a-bookdict-but-not-quite-as-intended"><em>Example 15-5. Using a <code>BookDict</code>, but not quite as intended</em></h4> <pre><code class="language-python">&gt;&gt;&gt; from books import BookDict
&gt;&gt;&gt; pp = BookDict(title='Programming Pearls',  # &lt;1&gt;
...               authors='Jon Bentley',  # &lt;2&gt;
...               isbn='0201657880',
...               pagecount=256)
&gt;&gt;&gt; pp  # &lt;3&gt;
{'title': 'Programming Pearls', 'authors': 'Jon Bentley', 'isbn': '0201657880',
'pagecount': 256}
&gt;&gt;&gt; type(pp)  # &lt;4&gt;
&lt;class 'dict'&gt;
&gt;&gt;&gt; pp.title  # &lt;5&gt;
Traceback (most recent call last):
File "&lt;stdin&gt;", line 1, in &lt;module&gt;
AttributeError: 'dict' object has no attribute 'title'
&gt;&gt;&gt; pp['title']
'Programming Pearls'
&gt;&gt;&gt; pp.__annotations__  # &lt;6&gt;
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
AttributeError: 'dict' object has no attribute '__annotations__'. Did you mean: '__contains__'?
&gt;&gt;&gt; BookDict.__annotations__  # &lt;7&gt;
{'isbn': &lt;class 'str'&gt;, 'title': &lt;class 'str'&gt;, 'authors': typing.List[str],
 'pagecount': &lt;class 'int'&gt;}
</code></pre> <ul> <li> <code>&lt;1&gt;</code> : The <code>BookDict</code>, which is a subclass of <code>TypedDict</code>, can be instantiated by using keyword arguments or by passing <code>dict</code> argument including a <code>dict</code> literal.</li> <li> <code>&lt;2&gt;</code> : Although the <code>authors</code> field was intentionally set to an object of <code>str</code> instead of <code>list[str]</code>, it can be instantiated without raising an exception.</li> <li> <code>&lt;3&gt;</code> : The result of <code>repr</code> of <code>pp</code> is the same as <code>dict</code> </li> <li> <code>&lt;4&gt;</code> : The type of <code>pp</code> is <code>dict</code> instead of <code>BookDict</code> or <code>TypedDict</code> </li> <li> <code>&lt;5&gt;</code> : It is not possible to access <code>title</code> property on the definition of <code>BookDict</code>, because <code>pp</code> is an object of <code>dict</code> instead of <code>BookDict</code>.</li> <li> <code>&lt;6&gt;</code> : The <code>pp</code> object also does not have the <code>__annotations__</code> property, which holds the information of type hints.</li> <li> <code>&lt;7&gt;</code> : The <code>BookDict</code> class has the <code>__annotations__</code> property.</li> </ul> <h4 id="example-15-6-demo_bookspy--legal-and-illegal-operations-on-a-bookdict"><em>Example 15-6. <code>demo_books.py</code> : legal and illegal operations on a <code>BookDict</code></em></h4> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/demo_books.py" language="python" line="1-20"></div> <ul> <li> <code>&lt;1&gt;</code> : Annotated a return type to check the <code>demo()</code> function by <code>mypy</code>.</li> <li> <code>&lt;2&gt;</code> : Generate a valid object of <code>BookDict</code> with vaild type and complete number of fields.</li> <li> <code>&lt;3&gt;</code> : The <code>authors</code> should have the same type with <code>book['authors']</code>, which is <code>list[str]</code>.</li> <li> <code>&lt;4&gt;</code> : <code>if TYPE_CHECKING</code> becomes <code>True</code> only when the program is checked by the type checker. At runtime, <code>if TYPE_CHECKING</code> becomes <code>False</code>.</li> <li> <code>&lt;5&gt;</code> : The <code>reveal_type()</code> function prints the type of the argument to stdout during type checking.</li> <li> <code>&lt;6&gt;</code> : Although the <code>authors</code> is of type <code>list[str]</code>, this assignment can be done without raising an exception on runtime.</li> </ul> <pre><code class="language-bash">(.venv) ~/fluent-python % python demo_books.py
(.venv) ~/fluent-python % mypy --version
mypy 1.4.1 (compiled: yes)
(.venv) ~/fluent-python % mypy demo_books.py
demo_books.py:13: note: Revealed type is "builtins.list[builtins.str]"
demo_books.py:14: error: Incompatible types in assignment
    (expression has type "str", variable has type "list[str]")  [assignment]
demo_books.py:15: error: TypedDict "BookDict" has no key "weight"  [typeddict-unknown-key]
demo_books.py:16: error: Key "title" of TypedDict "BookDict" cannot be deleted  [misc]
Found 3 errors in 1 file (checked 1 source file)
</code></pre> <ul> <li> <code>python demo_books.py</code> can be executed without raising an exception.</li> <li>Note at <code>demo_books.py:13</code> : This indicates that the variable <code>authors</code> is of type <code>list[str]</code> </li> <li>Error at <code>demo_books.py:14</code> : This indicates that assigning an object of type <code>str</code> to <code>authors</code> is illegal.</li> <li>Error at <code>demo_books.py:15</code> : This indicates that assigning to a key that is not part of the <code>BookDict</code> definition is not allowed.</li> <li>Error at <code>demo_books.py:16</code> : This indicates that deleting a key that is part of the <code>BookDict</code> definition is not allowed.</li> </ul> <h4 id="example-15-78-bookspy--to_xml-function"><em>Example 15-7,8. <code>books.py</code> : <code>to_xml</code> function</em></h4> <p>This is an example of the <code>BookDict</code> application. The <code>to_xml</code> function converts a <code>BookDict</code> object into an XML string, as shown in the following XML code.</p> <pre><code class="language-xml">&lt;BOOK&gt;
    &lt;ISBN&gt;0134757599&lt;/ISBN&gt;
    &lt;TITLE&gt;Refactoring, 2e&lt;/TITLE&gt;
    &lt;AUTHOR&gt;Martin Fowler&lt;/AUTHOR&gt;
    &lt;AUTHOR&gt;Kent Beck&lt;/AUTHOR&gt;
    &lt;PAGECOUNT&gt;478&lt;/PAGECOUNT&gt;
&lt;/BOOK&gt;
</code></pre> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/books.py" language="python" line="13-25"></div> <ul> <li> <code>&lt;1&gt;</code> : Annotate the type of the parameter <code>book</code> as <code>BookDict</code>.</li> <li> <code>&lt;2&gt;</code> : The contents of the XML code are stored temporarily in <code>elements</code>, which is of type <code>list[str]</code>. By doing this, the elements of <code>elements</code> must be <code>str</code> objects and this is checked by <code>mypy</code>.</li> <li> <code>&lt;3&gt;</code>, <code>&lt;4&gt;</code> : This codes generates <code>&lt;AUTHOR&gt;...&lt;/AUTHOR&gt;</code> parts of XML code. Because <code>mypy</code> understands <code>isinstance()</code> checks, the type of <code>value</code> must be <code>list</code> in this block guarded by the <code>if</code> clause.</li> </ul> <h4 id="example-15-9-books_anypy--from_json-function"><em>Example 15-9. <code>books_any.py</code> : <code>from_json</code> function</em></h4> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/books_any.py" language="python" line="29-31"></div> <ul> <li> <code>&lt;1&gt;</code> : The return type of <code>json.loads(data)</code> is <code>Any</code>.</li> <li> <code>&lt;2&gt;</code> : <code>Any</code> is <em>consistent-with</em> every type, therefore <code>whatever</code> can be returned.</li> </ul> <p>The <code>&lt;2&gt;</code> of the above example reveals that using the <code>Any</code> type prevents <code>mypy</code> from flagging any problem of the code. By adding <code>--disallow-any-expr</code>, <code>mypy</code> will flag the two lines of the sample code.</p> <pre><code class="language-bash">(.venv) ~/fluent-python % mypy --version
mypy 1.4.1 (compiled: yes)
(.venv) ~/fluent-python % mypy books_any.py --disallow-any-expr
books_any.py:30: error: Expression has type "Any"
books_any.py:31: error: Expression has type "Any"
Found 2 errors in 1 file (checked 1 source file)
</code></pre> <h4 id="example-15-10-bookspy--from_json-function-with-variable-annotation"><em>Example 15-10. <code>books.py</code> : <code>from_json</code> function with variable annotation</em></h4> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/books.py" language="python" line="29-31"></div> <ul> <li> <code>&lt;1&gt;</code> : By adding a type annotation as shown at <code>whatever: BookDict</code>, <code>--disallow-any-expr</code> will not flag any error on this line.</li> <li> <code>&lt;2&gt;</code> : Therefore, this line will return the declared return type, <code>BookDict</code>.</li> </ul> <h4 id="example-15-11-12-13-demo_not_bookpy--from_json-returns-an-invalid-bookdict-and-to_xml-accepts-it"><em>Example 15-11, 12, 13. <code>demo_not_book.py</code> : <code>from_json</code> returns an invalid <code>BookDict</code>, and <code>to_xml</code> accepts it</em></h4> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="dd535abcf76739d451c2baaf7813b8390a7dfe88" path="15-more-types/typeddict/demo_not_book.py" language="python" line="1-23"></div> <ul> <li> <code>&lt;1&gt;</code> : <code>not_book</code> is not a valid object of <code>BookDict</code>.</li> <li> <code>&lt;2&gt;</code> : In this block guarded by the <code>if TYPE_CHECKING</code> clause, the type of <code>not_book</code> and <code>not_book['authors']</code> will be revealed.</li> <li> <code>&lt;3&gt;</code> : This line is valid because <code>print()</code> function can handle every object.</li> <li> <code>&lt;4&gt;</code> : This line is invalid because an object of <code>BookDict</code> does not have a <code>flavor</code> field. But, this line does not raise an exception because runtime checking of <code>BookDict</code> is unavailable.</li> <li> <code>&lt;5&gt;</code> : Although the <code>to_xml()</code> function accepts only an object of <code>BookDict</code>, this line also does not raise an exception because runtime checking of <code>BookDict</code> is unavailable.</li> <li> <code>&lt;6&gt;</code> : The XML output of the <code>to_xml()</code> function will be printed to stdout without raising an exception.</li> </ul> <pre><code class="language-bash">(.venv) ~/fluent-python % mypy demo_not_book.py
../demo_books.py:12: note: Revealed type is "TypedDict('demo_books.BookDict',
    {'isbn': builtins.str, 'title': builtins.str,
     'authors': builtins.list[builtins.str], 'pagecount': builtins.int})"
../demo_books.py:13: note: Revealed type is "builtins.list[builtins.str]"
../demo_books.py:16: error: TypedDict "BookDict" has no key "flavor"  [typeddict-item]
</code></pre> <p>Type checker raise an error when referencing <code>'flavor'</code> field of the <code>BookDict</code> object.</p> <pre><code class="language-bash">(.venv) ~/fluent-python % python demo_not_book.py
{'title': 'Andromeda Strain', 'flavor': 'pistachio', 'authors': True}
pistachio
&lt;BOOK&gt;
        &lt;TITLE&gt;Andromeda Strain&lt;/TITLE&gt;
        &lt;FLAVOR&gt;pistachio&lt;/FLAVOR&gt;
        &lt;AUTHORS&gt;True&lt;/AUTHORS&gt;
&lt;/BOOK&gt;
</code></pre> <p>The above stdout is the results of <code>python demo_not_book.py</code>. Although the variable <code>not_book</code> and <code>not_book['flavor']</code> are invalid, all of the <code>print</code> statements are executed normally.</p> <p>Considering the above results, using <code>typing.TypedDict</code> while handling dynamic data structures like JSON and XML lacks the ability to perform type-checking during runtime. For performing type-checking while handling dynamic data structures, use <code>pydantic</code><sup id="fnref:pypiorg__pydantic" role="doc-noteref"><a href="#fn:pypiorg__pydantic" class="footnote" rel="footnote">9</a></sup> library for type-checking.</p> <p>The features of <code>typing.TypedDict</code>, including optional keys, inheritance functionality, are decribed in the official website documentation<sup id="fnref:pythonorg__typing_typeddict:1" role="doc-noteref"><a href="#fn:pythonorg__typing_typeddict" class="footnote" rel="footnote">7</a></sup>.</p> <h2 id="type-casting">Type Casting</h2> <p><code>typing.cast()</code> is a function that is used to supress incorrect errors or warnings generated by <code>mypy</code>. The official documentation for <code>typing.cast()</code> can be found in mypy documentation<sup id="fnref:mypy__documentation_casts" role="doc-noteref"><a href="#fn:mypy__documentation_casts" class="footnote" rel="footnote">10</a></sup>.</p> <div class="embed-github-src" repo="python/cpython/" branch="bee66d3cb98e740f9d8057eb7f503122052ca5d8" path="Lib/typing.py" language="python" line="1340-1348"></div> <p><code>typing.cast(type, value)</code> returns the second argument <code>value</code> as the type specified by the first argument <code>type</code>. As shown in the following code, <code>typing.cast()</code> does nothing during runtime.</p> <h3 id="example-of-typingcast"><em>Example of <code>typing.cast()</code></em></h3> <pre><code class="language-python">def find_first_str(a: list[object]) -&gt; str:
    index = next(i for i, x in enumerate(a) if isinstance(x, str))
    # We only get here if there's at least one string
    return a[index]
</code></pre> <p>The <code>find_first_str()</code> function above returns the first element of the list <code>a</code> that is of type <code>str</code>. This is determined by the <code>if isinstance(x, str)</code> statement inside the generator expression, where <code>index</code> always corresponds to the index of the first <code>str</code> object in the list <code>a</code>. However, the type checking performed by <code>mypy</code> will raise an error because <code>a[index]</code> is of type <code>object</code>.</p> <pre><code class="language-bash">find_first_str.py:4: error: Incompatible return value type (got "object", expected "str")  [return-value]
Found 1 error in 1 file (checked 1 source file)
</code></pre> <p>To correct an erronous result of <code>mypy</code>, <code>typing.cast()</code> can be used to cast the type of <code>a[index]</code> into type <code>str</code>.</p> <pre><code class="language-python">from typing import cast

def find_first_str(a: list[object]) -&gt; str:
    index = next(i for i, x in enumerate(a) if isinstance(x, str))
    # We only get here if there's at least one string
    return cast(str, a[index])
</code></pre> <h3 id="policy-of-using-typingcast-call-and--type-ignore-comment"><em>Policy of using <code>typing.cast()</code> call and <code># type: ignore</code> comment</em></h3> <ul> <li> <code>mypy</code> is usually correct when it reports an error. Donât use <code>typing.cast()</code> too frequently.</li> <li> <code>typing.cast()</code> is more informative compared to the <code># type: ignore</code> comment.</li> <li>Using the <code>Any</code> type is contagious because <code>Any</code> is <em>consistent-with</em> all types.</li> <li>Use <code># type: ignore</code> and <code>Any</code> only when <code>typing.cast()</code> cannot solve the problem.</li> </ul> <h2 id="reading-type-hints-at-runtime">Reading Type Hints at Runtime</h2> <p>At import time, Python reads the type hint of imported functions, classes and modules. The type hints are stored in <code>__annotations__</code> attributes. For example, the <code>clip()</code> function has type annotation of parameters and return value.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="f248baf418c49e5748bd503dd992b52440ed236b" path="15-more-types/clip_annot.py" language="python" line="21-21"></div> <p>The type hint of the <code>clip()</code> function can be read by using the following code.</p> <pre><code class="language-python">&gt;&gt;&gt; from clip_annot import clip
&gt;&gt;&gt; clip.__annotations__
{'text': &lt;class 'str'&gt;, 'max_len': &lt;class 'int'&gt;, 'return': &lt;class 'str'&gt;}
</code></pre> <p>The <code>return</code> key maps to the return type of the <code>clip()</code> function. This is because the <code>return</code> keyword is reserved for indicating the value that is returned from a function, and using it as a parameter name raises a <code>SyntaxError</code>.</p> <p>The <code>__annotations__</code> properties are evaluated by the Python interpreter at import time. This is why the above value of <code>clip.__annotations__</code> are the Python classes <code>str</code> and <code>int</code>.</p> <p>The import time evaluation of type annoatations is default at Python 3.11. The evaluation process may change if PEP 563<sup id="fnref:pythonorg__pep563" role="doc-noteref"><a href="#fn:pythonorg__pep563" class="footnote" rel="footnote">11</a></sup> or PEP 649<sup id="fnref:pythonorg__pep649" role="doc-noteref"><a href="#fn:pythonorg__pep649" class="footnote" rel="footnote">12</a></sup> is implemented.</p> <h3 id="problems-with-annotations-at-runtime">Problems with Annotations at Runtime</h3> <p>Type Annotations causes the following two problems.</p> <ol> <li>CPU and memory resources for importing modules are increased by using more type hints in the module. <ul> <li>CPU resources are used when evaluating the <code>__annotations__</code> property.</li> <li>Memory resources are used when storing the <code>__annotations__</code> property.</li> </ul> </li> <li>Referring to types not yet defined stores type annotation information as strings instead of actual types. <ul> <li>This problem is called the âForward reference problemâ.</li> </ul> </li> </ol> <h4 id="example-of-forward-reference-problem"><em>Example of Forward reference problem</em></h4> <pre><code class="language-python">class Rectangle:
    # ... lines omitted ...
    def stretch(self, factor: float) -&gt; 'Rectangle':
        return Rectangle(width=self.width * factor)
</code></pre> <p>Referencing a class <code>Rectangle</code> in the type hint of the <code>stretch</code> method is an example of the âForward Referenceâ problem. The âForward Referenceâ problem occurs when referencing a certain type before its definition.</p> <p>In the above example, the <code>stretch</code> method must reference the class <code>Rectangle</code> type before the definition of the class <code>Rectangle</code> is done. Because referencing a type before its definition is impossible, the <code>stretch</code> method annotates its return type using the string <code>'Rectangle'</code>.</p> <h4 id="annotation-using-string-object"><em>Annotation using string object</em></h4> <pre><code class="language-python">&gt;&gt;&gt; class Rectangle:
...     # ... lines omitted ...
...     def stretch(self, factor: float) -&gt; 'Rectangle':
...         return Rectangle(width=self.width * factor)
...
&gt;&gt;&gt; Rectangle.stretch.__annotations__
{'factor': &lt;class 'float'&gt;, 'return': 'Rectangle'}
</code></pre> <p><code>Rectangle.stretch.__annotations__</code> stores type hint of return value as a string object. Static type checker can deal with these type hints stored in string object.</p> <p>To get type hint as the actual type, the following function can be used:</p> <ol> <li> <code>typing.get_type_hints(obj, globalns=None, localns=None, include_extras=False)</code> <sup id="fnref:pythonorg__typing_get_type_hints" role="doc-noteref"><a href="#fn:pythonorg__typing_get_type_hints" class="footnote" rel="footnote">13</a></sup> <ul> <li>Available in Python 3.5 or later.</li> </ul> </li> <li> <code>inspect.get_annotations(obj, *, globals=None, locals=None, eval_str=False)</code> <sup id="fnref:pythonorg__inspect_get_annotations" role="doc-noteref"><a href="#fn:pythonorg__inspect_get_annotations" class="footnote" rel="footnote">14</a></sup> <ul> <li>Available in Python 3.10 or later.</li> </ul> </li> </ol> <pre><code class="language-python">&gt;&gt;&gt; typing.get_type_hints(Rectangle.stretch)
{'factor': &lt;class 'float'&gt;, 'return': &lt;class '__main__.Rectangle'&gt;}
&gt;&gt;&gt; inspect.get_annotations(Rectangle.stretch)
{'factor': &lt;class 'float'&gt;, 'return': 'Rectangle'}
</code></pre> <h4 id="pep-563postponed-evaluation-of-annotations"><em>PEP 563âPostponed Evaluation of Annotations</em></h4> <p>With PEP 563<sup id="fnref:pythonorg__pep563:1" role="doc-noteref"><a href="#fn:pythonorg__pep563" class="footnote" rel="footnote">11</a></sup>, type hints are not evaluated at import time. To enable a functionality of the PEP 563, use the following <code>import</code> statement:</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/clip_annot_post.py" language="python" line="1-1"></div> <p>With this <code>import</code> statement, <code>__annotations__</code> property holds type hints as string objects.</p> <pre><code class="language-python">&gt;&gt;&gt; import clip_annot_post
&gt;&gt;&gt; clip_annot_post.clip.__annotations__
{'text': 'str', 'max_len': 'int', 'return': 'str'}
</code></pre> <p>To convert type hints stored as string objects into the actual type, <code>typing.get_type_hints()</code> or <code>inspect.get_annotations()</code> can be used to obtain the actual type.</p> <pre><code class="language-python">&gt;&gt;&gt; import clip_annot_post
&gt;&gt;&gt; clip_annot_post.clip.__annotations__
{'text': 'str', 'max_len': 'int', 'return': 'str'}
&gt;&gt;&gt; typing.get_type_hints(clip_annot_post.clip)
{'text': &lt;class 'str'&gt;, 'max_len': &lt;class 'int'&gt;, 'return': &lt;class 'str'&gt;}
&gt;&gt;&gt; inspect.get_annotations(clip_annot_post.clip)
{'text': 'str', 'max_len': 'int', 'return': 'str'}
&gt;&gt;&gt; inspect.get_annotations(clip_annot_post.clip, eval_str=True)
{'text': &lt;class 'str'&gt;, 'max_len': &lt;class 'int'&gt;, 'return': &lt;class 'str'&gt;}
</code></pre> <p><code>typing.get_type_hints()</code> has the following limitations<sup id="fnref:pythonorg__pep563:2" role="doc-noteref"><a href="#fn:pythonorg__pep563" class="footnote" rel="footnote">11</a></sup>:</p> <ol> <li>Usage of <code>typing.get_type_hints()</code> is generally costly at runtime.</li> <li> <code>typing.get_type_hints()</code> cannot properly handle non-global contexts such as inner classes or classes within functions.</li> <li> <code>typing.get_type_hints()</code> does not properly handle classes with methods accepting or returning objects of their own type, if a class generator is used.</li> </ol> <h3 id="dealing-with-the-problem">Dealing with the Problem</h3> <p>If reading type annotations at runtime is needed, the following approaches can be recommended:</p> <ol> <li>Use <code>inspect.get_annotations()</code> (from Python 3.10) or <code>typing.get_type_hints()</code> (since Python 3.5) instead of reading the <code>__annotations__</code> property directly.</li> <li>Create a simple wrapper function that calls <code>inspect.get_annotations()</code> or <code>typing.get_type_hints()</code> and invoke the wrapper function when reading type annotations. This approach localizes future changes related to reading type annoations into a single function.</li> </ol> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="80f7f84274a47579e59c29a4657691525152c9d5" path="24-class-metaprog/checked/metaclass/checkedlib.py" language="python" line="118-123"></div> <p>Python documentation pages<sup id="fnref:pythonorg__annotations_best_practices" role="doc-noteref"><a href="#fn:pythonorg__annotations_best_practices" class="footnote" rel="footnote">15</a></sup> provides advices when using type annotations at runtime.</p> <h2 id="implementing-a-generic-class">Implementing a Generic Class</h2> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/lotto/generic_lotto_demo.py" language="python" line="6-11"></div> <p>The above example explains the usage of a <strong>Generic Class</strong>.</p> <ul> <li> <code>&lt;1&gt;</code> : A generic class can be instantiated by using a pair of brackets with an actual type parameter, like <code>[int]</code>.</li> <li> <code>&lt;2&gt;</code> : <code>first</code> is recognized as an <code>int</code> object by <code>mypy</code>.</li> <li> <code>&lt;3&gt;</code> : <code>remain</code> is recognized as a <code>tuple[int, ...]</code> object by <code>mypy</code>.</li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/lotto/generic_lotto_errors.py" language="python" line="1-17"></div> <ul> <li> <code>&lt;1&gt;</code> : An error is raised by <code>mypy</code> because <code>LottoBlower[int]</code> cannot be initialized by using <code>float</code> objects.</li> <li> <code>&lt;2&gt;</code> : An error is raised by <code>mypy</code> because the method <code>load</code> of <code>LottoBlower[int]</code> accepts only iterable of <code>int</code> objects.</li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="13-protocol-abc/tombola.py" language="python" line="3-31"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/lotto/generic_lotto.py" language="python" line="1-29"></div> <p>The above two code blocks are implementations of a generic class <code>LottoBlower</code>. In this paragraph, details of the class <code>LottoBlower</code> definition are discussed.</p> <ul> <li> <code>&lt;1&gt;</code> : A generic class can be defined by using multiple inheritance, including <code>typing.Generic</code>. <ul> <li> <code>typing.Generic</code> must decorated with a formal type parameter with brackets <code>[T]</code>.</li> <li>A type variable <code>T</code>, which is defined by using <code>typing.TypeVar</code>, is used to express a formal type parameter.</li> </ul> </li> <li> <code>&lt;2&gt;</code> : The <code>items</code> argument of the <code>__init__</code> method is annotated as <code>Iterable[T]</code>, which becomes <code>Iterable[int]</code> when an instance is initialized by using a parameterized type <code>LottoBlower[int]</code>.</li> <li> <code>&lt;3&gt;</code> : The <code>load</code> method is bounded in the same way as the <code>__init__</code> method.</li> <li> <code>&lt;4&gt;</code> : The return type of the <code>pick</code> method becomes <code>int</code> in a <code>LottoBlower[int]</code>.</li> <li> <code>&lt;6&gt;</code> : The return type of the <code>inspect</code> method becomes <code>tuple[int, ...]</code> in a <code>LottoBlower[int]</code>.</li> </ul> <h3 id="basic-jargon-for-generic-types">Basic Jargon for Generic Types</h3> <dl> <dt>Generic type</dt> <dd>A type declared with one or more type variables. The followings are examples of Generic types. <ul> <li> <code>LottoBlower[T]</code> (A generic type with one type variables)</li> <li> <code>abc.Mapping[KT, VT]</code> (A generic type with two type variables)</li> </ul> </dd> <dt>Formal type parameter</dt> <dd>Type variables that appear in a generic type declaration. <ul> <li> <code>T</code> in <code>LottoBlower[T]</code> </li> <li> <code>KT</code> and <code>VT</code> in <code>abc.Mapping[KT, VT]</code> </li> </ul> </dd> <dt>Parameterized type</dt> <dd>A type derived from a generic type, declared with actual type parameters. <ul> <li><code>LottoBlower[int]</code></li> <li><code>abc.Mapping[str, float]</code></li> </ul> </dd> <dt>Actual type parameter</dt> <dd>An actual type used as a parameter in the declaration of a parameterized type. <ul> <li> <code>int</code> in <code>LottoBlower[int]</code> </li> <li> <code>str</code> and <code>float</code> in <code>abc.Mapping[str, float]</code> </li> </ul> </dd> </dl> <h2 id="variance">Variance</h2> <p>In this subchapter, the following variance of generic class will be discussed.</p> <ol> <li>Invariant types</li> <li>Covariant types</li> <li>Contravariant types</li> </ol> <p>To discuss about variance, we will introduce <code>:&gt;</code> and <code>&lt;:</code> symbols to denote relationships between two types.</p> <dl> <dt><code>A :&gt; B</code></dt> <dd>This means that <code>A</code> is <em>supertype-of</em> or the same as <code>B</code>.</dd> <dt><code>B &lt;: A</code></dt> <dd>This means that <code>B</code> is <em>subtype-of</em> or the same as <code>A</code>.</dd> </dl> <h3 id="an-invariant-dispenser">An Invariant Dispenser</h3> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/invariant.py" language="python" line="2-24"></div> <ul> <li> <code>&lt;1&gt;</code> : A relationship <code>Beverage :&gt; Juice :&gt; OrangeJuice</code> is satisfied.</li> <li> <code>&lt;2&gt;</code> : A generic type using this simple <code>typing.TypeVar()</code> will be an invariant type.</li> <li> <code>&lt;3&gt;</code> : <code>BeverageDispenser</code> is parameterized on the type of beverage.</li> <li> <code>&lt;4&gt;</code> : The <code>install</code> method accepts only the type of <code>BeverageDispenser[Juice]</code>.</li> </ul> <p>The <code>BeverageDispenser</code> will be an invariant type; therefore there is no <em>supertype-of</em> or <em>subtype-of</em> relationship between the following types:</p> <ul> <li><code>BeverageDispenser[Beverage]</code></li> <li><code>BeverageDispenser[Juice]</code></li> <li><code>BeverageDispenser[OrangeJuice]</code></li> </ul> <p>For example, the following code does not raise error.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/invariant.py" language="python" line="30-31"></div> <p>But, <code>mypy</code> will raise errors on the following codes.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/invariant.py" language="python" line="38-42"></div> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/invariant.py" language="python" line="49-53"></div> <h3 id="a-covariant-dispenser">A Covariant Dispenser</h3> <p>By defining a class with <code>TypeVar(covariant=True)</code>, the class will be a covariant generic type.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/covariant.py" language="python" line="1-28"></div> <ul> <li> <code>&lt;1&gt;</code> : To define a covariant generic type, a type variable generated by <code>TypeVar(covariant=True)</code> is needed.</li> <li> <code>&lt;2&gt;</code> : Inheriting <code>Generic[T_co]</code> makes <code>BeverageDispenser</code> a covariant generic type.</li> <li> <code>&lt;3&gt;</code> : The <code>install()</code> function can accepts <code>BeverageDispenser[Juice]</code> or a subtype of <code>BeverageDispenser[Juice]</code>.</li> </ul> <p>This <code>BeverageDispenser</code> will be a covariant type; therefore there are the following relationships between the parameterized types.</p> <ul> <li><code>BeverageDispenser[Beverage] :&gt; BeverageDispenser[Juice]</code></li> <li><code>BeverageDispenser[Juice] :&gt; BeverageDispenser[OrangeJuice]</code></li> </ul> <p>Therefore, the following code does not raise any errors.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/covariant.py" language="python" line="34-38"></div> <p>But, the following code raises an error because the <code>beverage_dispenser</code>, which is the type of the <code>BeverageDispenser[Beverage]</code>, is <em>supertype-of</em> <code>BeverageDispenser[Juice]</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/covariant.py" language="python" line="44-48"></div> <h3 id="a-contravariant-trash-can">A Contravariant Trash Can</h3> <p>By defining a class with <code>TypeVar(contravariant=True)</code>, the class will be a contravariant generic type.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/contravariant.py" language="python" line="2-20"></div> <ul> <li> <code>&lt;1&gt;</code> : A relationship <code>Refuse :&gt; Biodegradable :&gt; Compostable</code> is satisfied.</li> <li> <code>&lt;2&gt;</code> : To define a contravariant generic type, a type variable generated by <code>TypeVar(contravariant=True)</code> is needed.</li> <li> <code>&lt;3&gt;</code> : Inheriting <code>Generic[T_contra]</code> makes <code>TrashCan</code> a contravariant generic type.</li> </ul> <p>The <code>deploy()</code> function can accepts <code>TrashCan[Biodegradable]</code> or any supertype of <code>TrashCan[Biodegradable]</code>. Therefore, the following types can be accepted by the <code>deploy()</code> function:</p> <ul> <li><code>TrashCan[Biodegradable]</code></li> <li><code>TrashCan[Refuse]</code></li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/contravariant.py" language="python" line="28-32"></div> <p>The type <code>TrashCan[Compostable]</code> cannot be accepted by the <code>deploy()</code> function.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/cafeteria/contravariant.py" language="python" line="39-43"></div> <h3 id="variance-review">Variance Review</h3> <p>Assume that <code>A</code> is a <em>supertype-of</em> <code>B</code>, which means <code>A :&gt; B</code>.</p> <h4 id="invariant-types">Invariant types</h4> <p>If the type <code>L</code> is invariant, <code>L[A] :&gt; L[B]</code> or <code>L[B] :&gt; L[A]</code> does not hold true.</p> <p>For example, the following built-in type <code>list</code> is invariant. The methods of <code>list</code> include methods that accept the formal type parameter <code>_T</code> as an argument and methods that return it as a return value at the same time. This aspect of the built-in type <code>list</code> makes it an invariant type.</p> <table> <thead> <tr> <th>Method</th> <th>Where the formal type parameter <code>_T</code> appears</th> </tr> </thead> <tbody> <tr> <td><code>__init__()</code></td> <td>Argument</td> </tr> <tr> <td><code>append()</code></td> <td>Argument</td> </tr> <tr> <td><code>extend()</code></td> <td>Argument</td> </tr> <tr> <td><code>pop()</code></td> <td>Return value</td> </tr> </tbody> </table> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/builtins.pyi" language="python" line="70-72"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/builtins.pyi" language="python" line="743-752"></div> <h4 id="covariant-types">Covariant types</h4> <p>If the type <code>C</code> is covariant, <code>C[A] :&gt; C[B]</code> holds true.</p> <p>For example, immutable containers such as <code>tuple</code> and <code>frozenset</code> is covariant types. The methods of <code>tuple</code> and <code>frozenset</code> return the formal type parameter <code>_T_co</code> as a return value. This aspect of the built-in types <code>tuple</code> and <code>frozenset</code> makes them invariant type.</p> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/builtins.pyi" language="python" line="70-72"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/builtins.pyi" language="python" line="711-733"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/builtins.pyi" language="python" line="872-895"></div> <h4 id="contravariant-types">Contravariant types</h4> <p>If the type <code>K</code> is contravariant, <code>K[A] &lt;: K[B]</code> holds true.</p> <p>There are several contravariant types. For example,</p> <ol> <li> <code>typing.Callable[[ParamType, ...], ReturnType]</code> is contravariant on the <code>ParamType</code>. <sup id="fnref:chapter08__callable" role="doc-noteref"><a href="#fn:chapter08__callable" class="footnote" rel="footnote">16</a></sup> </li> <li>A write-only data structure, also known as âsinkâ, is a contravariant container type.</li> <li> <code>Generator</code>, <code>Coroutine</code>, <code>AsyncGenerator</code>, which have a contravariant type parameter, is a contravariant type.</li> </ol> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="89-97"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="199-202"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="227-239"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="268-272"></div> <h4 id="variance-rules-of-thumb">Variance rules of thumb</h4> <p>To sum up the above discussion, the following rules holds true on variance:</p> <ul> <li>If a formal type parameter defines a type for data that comes out of the object, it can be covariant.</li> <li>If a formal type parameter defines a type for data that goes into the object after its initial construction, it can be contravariant.</li> <li>If a formal type parameter defines a type for data that comes out of the object and the same parameter defines a type for data that goes into the object, it must be invariant.</li> <li>As a precaution, it is advisable to make formal type parameters invariant.</li> </ul> <h2 id="implementing-a-generic-static-protocol">Implementing a Generic Static Protocol</h2> <p>A generic static protocol is a static protocol that can specify the type of an argument or a return value of a static protocol using formal type parameters.</p> <p>Variance discussed in the above contents can be specified on a generic static protocol. The following code is the implementation of <code>SupportsAbs</code> in the <code>typing</code> module.</p> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="89-97"></div> <div class="embed-github-src" repo="python/typeshed" branch="bfc83c365a0b26ab16586beac77ff16729d0e473" path="stdlib/typing.pyi" language="python" line="156-159"></div> <p>The following code is an example of usage of <code>SupportsAbs</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/protocol/abs_demo.py" language="python" line="3-32"></div> <ul> <li> <code>&lt;1&gt;</code> : The class <code>Vector2d</code> supports the <code>abs</code> method that returns a <code>float</code>.</li> <li> <code>&lt;2&gt;</code> : The function <code>is_unit()</code> accepts an argument <code>v</code>, which is an object that support the <code>abs</code> method which returns a <code>float</code>(<code>SupportsAbs[float]</code>) or a subtype of <code>SupportsAbs[float]</code>.</li> <li> <code>&lt;3&gt;</code> : <code>mypy</code> accepts the <code>abs</code> method on <code>v</code>, and <code>abs(v)</code> as the first argument of <code>math.isclose()</code> because <code>v</code> is a type of <code>SupportsAbs[float]</code>.</li> <li> <code>&lt;4&gt;</code> : Thanks to <code>@runtime_checkable</code> on <code>SupportsAbs</code>, this assert statement can be used on runtime.</li> <li> <code>&lt;5&gt;</code> : The remaining code pass <code>mypy</code> checks and runtime assertion check.</li> <li> <code>&lt;6&gt;</code> : <code>int</code> type also have <code>__abs__</code> method and returns <code>int</code>, which is <em>consistent-with</em> the <code>float</code> type. Therefore, <code>int</code> is <em>consistent-with</em> <code>SupportAbs[float]</code> and can be assigned the <code>v</code> argument of <code>is_unit()</code> function.</li> </ul> <p>On the following codes are <code>RandomPicker</code> protocol which is discussed in the chapter 13.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/typing/randompick.py" language="python" line="1-5"></div> <p><code>RandomPicker</code> protocol can be a covariant generic protocol because the return type of the <code>pick()</code> method can be specified by a formal type parameter.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="15-more-types/protocol/random/generic_randompick.py" language="python" line="1-7"></div> <h2 id="chapter-summary">Chapter Summary</h2> <ul> <li> <code>@typing.overload</code> <sup id="fnref:pythonorg__typing_overload:1" role="doc-noteref"><a href="#fn:pythonorg__typing_overload" class="footnote" rel="footnote">2</a></sup> can be used to type-annotate for complex methods. This can be used for object methods.</li> <li>The <code>typing.TypeVar()</code> function generates a type variable. Type variables are used to express common types in arguments and return value of a certain function. This can be used in type-annotation which is using the <code>@typing.overload</code>.</li> <li> <code>typing.TypedDict</code> <sup id="fnref:pythonorg__typing_typeddict:2" role="doc-noteref"><a href="#fn:pythonorg__typing_typeddict" class="footnote" rel="footnote">7</a></sup> can be used to provide type hints for <code>dict</code> object. Be careful that <code>typing.TypedDict</code> has no runtime type checking facility. <ul> <li>If runtime type checking facility is needed for a <code>dict</code> object, consider using the <code>pydantic</code> library to achieve it.</li> </ul> </li> <li> <code>typing.cast()</code> is a function that is used to supress incorrect errors or warnings generated by <code>mypy</code><sup id="fnref:mypy__documentation_casts:1" role="doc-noteref"><a href="#fn:mypy__documentation_casts" class="footnote" rel="footnote">10</a></sup>.</li> <li>To read type annotations at runtime, use the function <code>inspect.get_annotations()</code> (from Python 3.10) or the function <code>typing.get_type_hints()</code> (since Python 3.5) instead of reading the <code>__annotations__</code> property directly.</li> <li>The generic class can be defined by inheriting the <code>typing.Generic</code> class and using formal type parameters.</li> <li>The generic class can have variance.</li> <li>The generic static protocol also can have variance.</li> </ul> <h2 id="further-reading">Further Reading</h2> <table> <thead> <tr> <th>PEP</th> <th>Title</th> <th>Python</th> <th>Year</th> </tr> </thead> <tbody> <tr> <td>3107</td> <td><a href="https://peps.python.org/pep-3107" rel="external nofollow noopener" target="_blank">Function Annotations</a></td> <td>3.0</td> <td>2006</td> </tr> <tr> <td>483*</td> <td><a href="https://peps.python.org/pep-483" rel="external nofollow noopener" target="_blank">The Theory of Type Hints</a></td> <td>n/a</td> <td>2014</td> </tr> <tr> <td>484*</td> <td><a href="https://peps.python.org/pep-484" rel="external nofollow noopener" target="_blank">Type Hints</a></td> <td>3.5</td> <td>2014</td> </tr> <tr> <td>482</td> <td><a href="https://peps.python.org/pep-482" rel="external nofollow noopener" target="_blank">Literature Overview for Type Hints</a></td> <td>n/a</td> <td>2015</td> </tr> <tr> <td>526*</td> <td><a href="https://peps.python.org/pep-526" rel="external nofollow noopener" target="_blank">Syntax for Variable Annotations</a></td> <td>3.6</td> <td>2016</td> </tr> <tr> <td>544*</td> <td><a href="https://peps.python.org/pep-544" rel="external nofollow noopener" target="_blank">Protocols: Structural subtyping (static duck typing)</a></td> <td>3.8</td> <td>2017</td> </tr> <tr> <td>557</td> <td><a href="https://peps.python.org/pep-557" rel="external nofollow noopener" target="_blank">Data Classes</a></td> <td>3.7</td> <td>2017</td> </tr> <tr> <td>560</td> <td><a href="https://peps.python.org/pep-560" rel="external nofollow noopener" target="_blank">Core support for typing module and generic types</a></td> <td>3.7</td> <td>2017</td> </tr> <tr> <td>561</td> <td><a href="https://peps.python.org/pep-561" rel="external nofollow noopener" target="_blank">Distributing and Packaging Type Information</a></td> <td>3.7</td> <td>2017</td> </tr> <tr> <td>563</td> <td><a href="https://peps.python.org/pep-563" rel="external nofollow noopener" target="_blank">Postponed Evaluation of Annotations</a></td> <td>3.7</td> <td>2017</td> </tr> <tr> <td>586*</td> <td><a href="https://peps.python.org/pep-586" rel="external nofollow noopener" target="_blank">Literal Types</a></td> <td>3.8</td> <td>2018</td> </tr> <tr> <td>585</td> <td><a href="https://peps.python.org/pep-585" rel="external nofollow noopener" target="_blank">Type Hinting Generics In Standard Collections</a></td> <td>3.9</td> <td>2019</td> </tr> <tr> <td>589*</td> <td><a href="https://peps.python.org/pep-589" rel="external nofollow noopener" target="_blank">TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a></td> <td>3.8</td> <td>2019</td> </tr> <tr> <td>591*</td> <td><a href="https://peps.python.org/pep-591" rel="external nofollow noopener" target="_blank">Adding a final qualifier to typing</a></td> <td>3.8</td> <td>2019</td> </tr> <tr> <td>593</td> <td><a href="https://peps.python.org/pep-593" rel="external nofollow noopener" target="_blank">Flexible function and variable annotations</a></td> <td>?</td> <td>2019</td> </tr> <tr> <td>604</td> <td><a href="https://peps.python.org/pep-604" rel="external nofollow noopener" target="_blank">Allow writing union types as <code>X | Y</code></a></td> <td>3.10</td> <td>2019</td> </tr> <tr> <td>612</td> <td><a href="https://peps.python.org/pep-612" rel="external nofollow noopener" target="_blank">Parameter Specification Variables</a></td> <td>3.10</td> <td>2019</td> </tr> <tr> <td>613</td> <td><a href="https://peps.python.org/pep-613" rel="external nofollow noopener" target="_blank">Explicit Type Aliases</a></td> <td>3.10</td> <td>2020</td> </tr> <tr> <td>645</td> <td><a href="https://peps.python.org/pep-645" rel="external nofollow noopener" target="_blank">Allow writing optional types as <code>x?</code></a></td> <td>?</td> <td>2020</td> </tr> <tr> <td>646</td> <td><a href="https://peps.python.org/pep-646" rel="external nofollow noopener" target="_blank">Variadic Generics</a></td> <td>?</td> <td>2020</td> </tr> <tr> <td>647</td> <td><a href="https://peps.python.org/pep-647" rel="external nofollow noopener" target="_blank">User-Defined Type Guards</a></td> <td>3.10</td> <td>2021</td> </tr> <tr> <td>649</td> <td><a href="https://peps.python.org/pep-649" rel="external nofollow noopener" target="_blank">Deferred Evaluation Of Annotations Using Descriptors</a></td> <td>?</td> <td>2021</td> </tr> <tr> <td>655</td> <td><a href="https://peps.python.org/pep-655" rel="external nofollow noopener" target="_blank">Marking individual TypedDict items as required or potentially-missing</a></td> <td>?</td> <td>2021</td> </tr> </tbody> </table> <p>PEP with numbers marked with * are important enough to be mentioned in the opening paragraph of the typing documentation.</p> <h2 id="links">Links</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:bible" role="doc-endnote"> <p><a href="https://www.oreilly.com/library/view/fluent-python-2nd/9781492056348/" rel="external nofollow noopener" target="_blank"><em>Fluent Python</em> by Luciano Ramalho</a>Â <a href="#fnref:bible" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__typing_overload" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.overload" rel="external nofollow noopener" target="_blank"><code>typing</code> â Support for type hints : <code>@typing.overload</code></a>Â <a href="#fnref:pythonorg__typing_overload" class="reversefootnote" role="doc-backlink">â©</a>Â <a href="#fnref:pythonorg__typing_overload:1" class="reversefootnote" role="doc-backlink">â©<sup>2</sup></a></p> </li> <li id="fn:pythonorg__builtinfunctions_sum" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/functions.html#sum" rel="external nofollow noopener" target="_blank">Built-in Functions : <code>sum()</code></a>Â <a href="#fnref:pythonorg__builtinfunctions_sum" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__pep570" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0570/" rel="external nofollow noopener" target="_blank">PEP 570 â Python Positional-Only Parameters</a>Â <a href="#fnref:pythonorg__pep570" class="reversefootnote" role="doc-backlink">â©</a>Â <a href="#fnref:pythonorg__pep570:1" class="reversefootnote" role="doc-backlink">â©<sup>2</sup></a></p> </li> <li id="fn:github__python_typeshed_stdlib_2and3_builtins_pyi" role="doc-endnote"> <p><a href="https://github.com/python/typeshed/blob/a8834fcd46339e17fc8add82b5803a1ce53d3d60/stdlib/2and3/builtins.pyi" rel="external nofollow noopener" target="_blank">Github : <code>python/typeshed/stdlib/2and3/builtins.pyi</code></a>Â <a href="#fnref:github__python_typeshed_stdlib_2and3_builtins_pyi" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__pep570_syntax_and_semantics" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0570/#syntax-and-semantics" rel="external nofollow noopener" target="_blank">PEP 570 â Python Positional-Only Parameters : Syntax and Semantics</a>Â <a href="#fnref:pythonorg__pep570_syntax_and_semantics" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__typing_typeddict" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.TypedDict" rel="external nofollow noopener" target="_blank"><code>typing</code> â Support for type hints : <code>class typing.TypedDict</code></a>Â <a href="#fnref:pythonorg__typing_typeddict" class="reversefootnote" role="doc-backlink">â©</a>Â <a href="#fnref:pythonorg__typing_typeddict:1" class="reversefootnote" role="doc-backlink">â©<sup>2</sup></a>Â <a href="#fnref:pythonorg__typing_typeddict:2" class="reversefootnote" role="doc-backlink">â©<sup>3</sup></a></p> </li> <li id="fn:pythonorg__pep589" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0589/" rel="external nofollow noopener" target="_blank">PEP 589 â TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a>Â <a href="#fnref:pythonorg__pep589" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pypiorg__pydantic" role="doc-endnote"> <p><a href="https://pypi.org/project/pydantic/" rel="external nofollow noopener" target="_blank">PyPI - pydantic</a>Â <a href="#fnref:pypiorg__pydantic" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:mypy__documentation_casts" role="doc-endnote"> <p><a href="https://mypy.readthedocs.io/en/stable/type_narrowing.html#casts" rel="external nofollow noopener" target="_blank">mypy documentation : Type narrowing - Casts</a>Â <a href="#fnref:mypy__documentation_casts" class="reversefootnote" role="doc-backlink">â©</a>Â <a href="#fnref:mypy__documentation_casts:1" class="reversefootnote" role="doc-backlink">â©<sup>2</sup></a></p> </li> <li id="fn:pythonorg__pep563" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0563/" rel="external nofollow noopener" target="_blank">PEP 563 â Postponed Evaluation of Annotations</a>Â <a href="#fnref:pythonorg__pep563" class="reversefootnote" role="doc-backlink">â©</a>Â <a href="#fnref:pythonorg__pep563:1" class="reversefootnote" role="doc-backlink">â©<sup>2</sup></a>Â <a href="#fnref:pythonorg__pep563:2" class="reversefootnote" role="doc-backlink">â©<sup>3</sup></a></p> </li> <li id="fn:pythonorg__pep649" role="doc-endnote"> <p><a href="https://peps.python.org/pep-0649/" rel="external nofollow noopener" target="_blank">PEP 649 â Deferred Evaluation of Annoations Using Descriptors</a>Â <a href="#fnref:pythonorg__pep649" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__typing_get_type_hints" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/typing.html#typing.get_type_hints" rel="external nofollow noopener" target="_blank"><code>typing</code> â Support for type hints : <code>typing.get_type_hints</code></a>Â <a href="#fnref:pythonorg__typing_get_type_hints" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__inspect_get_annotations" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/inspect.html#inspect.get_annotations" rel="external nofollow noopener" target="_blank"><code>inspect</code> â Inspect live objects : <code>inspect.get_annotations</code></a>Â <a href="#fnref:pythonorg__inspect_get_annotations" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__annotations_best_practices" role="doc-endnote"> <p><a href="https://docs.python.org/3/howto/annotations.html" rel="external nofollow noopener" target="_blank">Annotations Best Practices</a>Â <a href="#fnref:pythonorg__annotations_best_practices" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:chapter08__callable" role="doc-endnote"> <p><a href="../chapter-08/#callable">Chapter 8 - Types Usable in Annotations - Callable</a>Â <a href="#fnref:chapter08__callable" class="reversefootnote" role="doc-backlink">â©</a></p> </li> </ol> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2024 Dongseok Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script> <script>hljs.highlightAll();</script> <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script> <script>hljs.initLineNumbersOnLoad();</script> <script>function append_code_block_header(e){if(!e.className)return;const[t,r]=get_language_and_url(e);r&&(replace_className(e,t),elemCodeBlockHeader=create_elem_code_block_header(r),append_elem_code_block_header_to_previous(e,elemCodeBlockHeader))}function get_language_and_url(e){return e.className.split(/:(.*)/s)}function replace_className(e,t){e.classList.remove(e.className),e.classList.add(t)}function create_elem_code_block_header(e){var t=document.createElement("a");return t.textContent=e,(e.startsWith("http://")||e.startsWith("https://"))&&(t.setAttribute("href",e),t.setAttribute("target","_blank")),t.className="language-plaintext",t}function append_elem_code_block_header_to_previous(e,t){var r=e.parentElement;r.insertBefore(t,r.firstChild),r.classList.add("code-block-header")}function embed_external_source(e){var t=get_url_raw(e),r=get_url_blob(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c),_={startFrom:Math.max(l,1)};e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c,_)})["catch"](function(e){throw e})}function embed_local_source(e){var t=get_url_raw_local(e),r=get_url_blob_local(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c);e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c)})["catch"](function(e){throw e})}function get_url_raw(e){return["https://raw.githubusercontent.com",e.getAttribute("repo"),e.getAttribute("branch"),e.getAttribute("path")].join("/")}function get_url_blob(e){return["https://github.com",e.getAttribute("repo"),"blob",e.getAttribute("branch"),e.getAttribute("path")+get_line_specifier(e)].join("/")}function get_url_raw_local(e){return e.getAttribute("path")}function get_url_blob_local(e){return get_url_raw_local(e)}function get_lines(e){const t=e.getAttribute("line");if(!t)return[0,0];var[r,n]=t.split(/-(.*)/s);return r=parseInt(r),n=parseInt(n),isNaN(r)&&(r=0),isNaN(n)&&(n=0),[r,n]}function get_line_specifier(e){const t=get_lines(e);return 0==t[0]&&0==t[1]?"":(0==t[1]&&t[1],"#L"+String(t[0])+"-L"+String(t[1]))}function create_elem_code_block(e,t,r,n,c){var l=document.createElement("code");return l.className="language-"+e+":"+t,l.textContent=slice_by_line_number(r,n,c),l}function slice_by_line_number(e,t,r){return 0==t&&0==r?e:(0==t&&(t=1),e.split("\n").slice(t-1,r).join("\n"))}function create_elem_pre_from_code_block(e){var t=document.createElement("pre");return t.appendChild(e),append_code_block_header(e),t}const code=document.getElementsByTagName("code");Array.from(code).forEach(append_code_block_header);var divs=document.getElementsByClassName("embed-github-src");Array.prototype.forEach.call(divs,embed_external_source);divs=document.getElementsByClassName("embed-local-src");Array.prototype.forEach.call(divs,embed_local_source);</script> </body> </html>