<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Chapter 16 | Dongseok Kim</title> <meta name="author" content="Dongseok Kim"> <meta name="description" content="Operator Overloading"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-light.min.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-dark.min.css" media="none" id="highlight_theme_dark"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://d0ngse0kkim.github.io/python/fluent-python/chapter-16/"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Chapter 16",
      "description": "Operator Overloading",
      "published": "February 3, 2024",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">DongseokÂ </span>Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">programming</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/python">Python</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/softwaredesign/">Software Design</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/tools/">Tools</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">hobbies</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/running">running</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">others</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/repositories">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/cv/">cv</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Chapter 16</h1> <p>Operator Overloading</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#abstract">Abstract</a></div> <div><a href="#operator-overloading-101">Operator Overloading 101</a></div> <div><a href="#unary-operators">Unary Operators</a></div> <div><a href="#overloading-for-vector-addition">Overloading + for Vector Addition</a></div> <div><a href="#overloading-for-scalar-multiplication">Overloading * for Scalar Multiplication</a></div> <div><a href="#using-as-an-infix-operator">Using @ as an Infix Operator</a></div> <div><a href="#wrapping-up-arithmetic-operators">Wrapping-Up Arithmetic Operators</a></div> <div><a href="#rich-comparison-operators">Rich Comparison Operators</a></div> <div><a href="#augmented-assignment-operators">Augmented Assignment Operators</a></div> <div><a href="#chapter-summary">Chapter Summary</a></div> <div><a href="#further-reading">Further Reading</a></div> <div><a href="#links">Links</a></div> </nav> </d-contents> <h2 id="abstract">Abstract</h2> <p>This is the 16-th chapter of the book Fluent Python, which is about operator overloading.</p> <h2 id="operator-overloading-101">Operator Overloading 101</h2> <p>In Python, there are operators that can be used to perform operations. For example, the following operators are existing in Python:</p> <ol> <li>Infix operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>//</code>, <code>%</code>, <code>**</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&amp;</code>, <code>^</code>, <code>|</code> <ul> <li>Infix operators are operators that are placed between two operands.</li> </ul> </li> <li>Unary operators: <code>+</code>, <code>-</code>, <code>~</code> <ul> <li>Unary operators are operators that are placed before one operand.</li> </ul> </li> <li>Comparison operators: <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code> <ul> <li>Comparison operators are operators that are used to compare two operands.</li> </ul> </li> <li>Boolean operators: <code>and</code>, <code>or</code>, <code>not</code> <ul> <li>Boolean operators are operators that are used to perform boolean operations.</li> </ul> </li> <li>Function invocation: <code>()</code> <ul> <li>Function invocation is used to call a function.</li> </ul> </li> <li>Attribute access: <code>.</code> <ul> <li>Attribute access is used to access an attribute of an object.</li> </ul> </li> <li>Item access/slicing: <code>[]</code>, <code>[:]</code> <ul> <li>Item access/slicing is used to access an item or a slice of an object.</li> </ul> </li> <li>Assignment: <code>=</code>, <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>//=</code>, <code>%=</code>, <code>**=</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;=</code>, <code>&amp;=</code>, <code>^=</code>, <code>|=</code> <ul> <li>Assignment is used to assign a value to a variable.</li> </ul> </li> </ol> <p>Operator overloading is a language feature that can be abused, making the program harder to understand, and resulting in unexpected behavior and bugs. However, operator overloading can also be used to make the program more readable, and to make the program more efficient.</p> <p>Therefore, Python make the following restrictions on operator overloading to prevent abuse:</p> <ol> <li>It is not possible to overload operators for built-in types.</li> <li>It is not possible to make a new operator. However, it is only possible to overload the existing operators.</li> <li>It is not possible to overload the following operators: <ul> <li> <code>and</code>, <code>or</code>, <code>not</code> </li> <li> <code>is</code>, <code>is not</code>, <code>in</code>, <code>not in</code> </li> <li> <code>[]</code>, <code>[:]</code>, <code>()</code>, <code>.</code>, <code>=</code> </li> <li> <code>-&gt;</code>, <code>,</code> </li> <li> <code>yield</code>, <code>yield from</code> </li> <li> <code>if</code>, <code>elif</code>, <code>else</code> </li> <li> <code>for</code>, <code>while</code> </li> <li> <code>try</code>, <code>except</code>, <code>finally</code> </li> <li> <code>with</code>, <code>as</code> </li> <li><code>assert</code></li> <li> <code>import</code>, <code>def</code>, <code>class</code> </li> <li> <code>lambda</code>, <code>nonlocal</code>, <code>pass</code>, <code>raise</code>, <code>return</code>, <code>global</code>, <code>del</code> </li> <li> <code>break</code>, <code>continue</code> </li> <li> <code>from</code>, <code>print</code> </li> <li> <code>async</code>, <code>await</code> </li> </ul> </li> </ol> <h2 id="unary-operators">Unary Operators</h2> <p>The Python Language Reference <sup id="fnref:pythonorg__expressions_unary" role="doc-noteref"><a href="#fn:pythonorg__expressions_unary" class="footnote" rel="footnote">1</a></sup> <sup id="fnref:pythonorg__datamodel_abs" role="doc-noteref"><a href="#fn:pythonorg__datamodel_abs" class="footnote" rel="footnote">2</a></sup> defines the following unary operators:</p> <ol> <li> <code>-</code> : Unary arithmetic negation which is implemented by <code>__neg__</code>. <ul> <li>If <code>x</code> is <code>-2</code>, then <code>-x</code> is <code>2</code>.</li> </ul> </li> <li> <code>+</code> : Unary arithmetic positive which is implemented by <code>__pos__</code>. <ul> <li>If <code>x</code> is <code>-2</code>, then <code>+x</code> is <code>-2</code>.</li> <li>However, <code>+x</code> is not always equal to <code>x</code>, because <code>+x</code> may return a new object.</li> </ul> </li> <li> <code>~</code> : Unary arithmetic inversion which is implemented by <code>__invert__</code>. <ul> <li>If <code>x</code> is <code>2</code>, then <code>~x</code> is <code>-3</code> because the <code>~</code> operator on the <code>int</code> type means bitwise inverse operator.</li> </ul> </li> <li> <code>abs()</code> : Absolute value which is implemented by <code>__abs__</code>. <ul> <li>If <code>x</code> is <code>-2</code>, then <code>abs(x)</code> is <code>2</code>.</li> </ul> </li> </ol> <h3 id="examples-of-implementations-of-unary-operators"><em>Examples of Implementations of Unary Operators</em></h3> <p>The unary operators can be implemented by implementing the corresponding special methods, which take only one argument, <code>self</code>. The following code shows an example of implementing the unary operators <code>abs()</code>, <code>-</code>, and <code>+</code> on the <code>Vector</code> class.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="285-292"></div> <ul> <li> <code>&lt;1&gt;</code> : It is possible to get the components of a <code>Vector</code> object by using a <code>for</code> loop and generator expression, because the <code>Vector</code> class implements the <code>__iter__</code> method.</li> <li> <code>&lt;2&gt;</code> : The method <code>__pos__</code> builds a new <code>Vector</code> object by using the <code>Vector</code> constructor.</li> </ul> <h3 id="example-of-a-case-which-x-is-not-equal-to-x"><em>Example of a case which <code>x</code> is not equal to <code>+x</code></em></h3> <p>The following code shows an example of a case which <code>x</code> is not equal to <code>+x</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/unary_plus_decimal.py" language="python" line="4-16"></div> <ul> <li> <code>&lt;1&gt;</code> : Get a reference to the current global arithmetic context.</li> <li> <code>&lt;2&gt;</code> : Change the precision of the current global arithmetic context to <code>40</code>.</li> <li> <code>&lt;3&gt;</code> : Create a <code>Decimal</code> object <code>one_third</code> with the value <code>1/3</code>.</li> <li> <code>&lt;4&gt;</code> : Print the value of <code>one_third</code> with the precision of <code>40</code>.</li> <li> <code>&lt;5&gt;</code> : Check whether <code>+one_third</code> is equals to <code>one_third</code>.</li> <li> <code>&lt;6&gt;</code> : Change the precision of the current global arithmetic context from <code>40</code> into <code>28</code>.</li> <li> <code>&lt;7&gt;</code> : Check whether <code>+one_third</code> is equals to <code>one_third</code> again and the result of this comparison is <code>False</code>.</li> <li> <code>&lt;8&gt;</code> : The reason of the above comparison is <code>False</code> is that <code>+one_third</code> returns a new <code>Decimal</code> object with the precision of <code>28</code>. <ul> <li>The fact that <code>+one_third</code> returns a new <code>Decimal</code> object can be verified by checking that the <code>id(one_third)</code> and <code>id(+one_third)</code> are different value.</li> </ul> </li> </ul> <h2 id="overloading--for-vector-addition">Overloading <code>+</code> for Vector Addition</h2> <p>In this subsection, the <code>+</code> operator is overloaded to support vector addition.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="351-359"></div> <ul> <li> <code>pairs = itertools.zip_longest(self, other, fillvalue=0.0)</code> fills the missing values with <code>0.0</code> and this makes it possible to add two <code>Vector</code> objects with different lengths.</li> <li> <code>return Vector(a + b for a, b in pairs)</code> builds a new <code>Vector</code> object. By doing this, <code>+</code> operator returns a new <code>Vector</code> object instead of modifying the existing <code>Vector</code> object.</li> <li> <code>try:</code> and <code>except TypeError:</code> and <code>return NotImplemented</code> are used to get the correct exception message.</li> <li> <code>__radd__</code> method delegates to <code>__add__</code> method, and this makes it possible to add a <code>Vector</code> object and an object of another type.</li> </ul> <h3 id="usage-of--for-vector-class"><em>Usage of <code>+</code> for <code>Vector</code> Class</em></h3> <p>The following code shows the basic usage of <code>+</code> for the <code>Vector</code> class.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="202-212"></div> <h3 id="implementation-of-mixed-type-addition"><em>Implementation of Mixed Type Addition</em></h3> <p>Mixed type addition such as adding a <code>Vector</code> object to a <code>tuple</code> object can only be supported if the <code>tuple</code> object is the right operand of the <code>+</code> operator.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="215-222"></div> <p>Mixed type addition, such as adding a <code>tuple</code> object to a <code>Vector</code> object, cannot be supported by implementing <code>__add__</code> method alone when the <code>tuple</code> object is the left operand of the <code>+</code> operator.</p> <pre><code class="language-python">&gt;&gt;&gt; v1 = Vector([3, 4, 5])
&gt;&gt;&gt; (10, 20, 30) + v1
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: can only concatenate tuple (not "Vector") to tuple
&gt;&gt;&gt; from vector2d_v3 import Vector2d
&gt;&gt;&gt; v2d = Vector2d(1, 2)
&gt;&gt;&gt; v2d + v1
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: unsupported operand type(s) for +: 'Vector2d' and 'Vector'
</code></pre> <p>By implementing the <code>__radd__</code> method in addition to the <code>__add__</code> method, it is possible to support mixed type addition, such as adding a <code>tuple</code> object and a <code>Vector</code> object, regardless of the order of the operands.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="225-232"></div> <p>Computing process with <code>__add__</code> and <code>__radd__</code> method can be visualized as the following flowchart:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-16/add_radd.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Flowchart for computing <code>a + b</code> with <code>__add__</code> and <code>__radd__</code>.</figcaption> </figure> </div> </div> <p>To sum up the above flowchart, the following rules are used to compute <code>a + b</code>:</p> <ol> <li>If <code>a</code> has an <code>__add__</code> method, then <code>a.__add__(b)</code> is called. If the result of <code>a.__add__(b)</code> is not <code>NotImplemented</code>, then the result of <code>a.__add__(b)</code> is returned.</li> <li>If <code>a</code> does not have <code>__add__</code> method or the result of <code>a.__add__(b)</code> is <code>NotImplemented</code>, then <code>b.__radd__(a)</code> is called. If the result of <code>b.__radd__(a)</code> is not <code>NotImplemented</code>, then the result of <code>b.__radd__(a)</code> is returned.</li> <li>If <code>b</code> does not have <code>__radd__</code> method or the result of <code>b.__radd__(a)</code> is <code>NotImplemented</code>, then a <code>TypeError</code> exception is raised.</li> </ol> <p>Note that <code>NotImplemented</code> and <code>NotImplementedError</code> are different.</p> <ul> <li> <code>NotImplemented</code> is a special singleton value that is used to indicate that the operator is not implemented for the operands.</li> <li> <code>NotImplementedError</code> is an exception that is raised when a method of an abstract base class that is not implemented is called.</li> </ul> <p>Without <code>try</code> and <code>except TypeError</code> and <code>return NotImplemented</code> in the <code>__add__</code> method, the following code will raise a misleading <code>TypeError</code> exception message.</p> <pre><code class="language-python">'''Implementation of Vector class is omitted here...'''
    def __add__(self, other):
        # Implementation without try and except TypeError and return NotImplemented
        pairs = itertools.zip_longest(self, other, fillvalue=0.0)
        return Vector(a + b for a, b in pairs)

    def __radd__(self, other):
        return self + other
'''Implementation of Vector class is omitted here...'''

&gt;&gt;&gt; v1 = Vector([3, 4, 5])
&gt;&gt;&gt; v1 + 1 Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "vector_v6.py", line 328, in __add__
    pairs = itertools.zip_longest(self, other, fillvalue=0.0)
TypeError: zip_longest argument #2 must support iteration

&gt;&gt;&gt; v1 + 'ABC'
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "vector_v6.py", line 329, in __add__
    return Vector(a + b for a, b in pairs)
  File "vector_v6.py", line 243, in __init__
    self._components = array(self.typecode, components)
  File "vector_v6.py", line 329, in &lt;genexpr&gt;
    return Vector(a + b for a, b in pairs)
TypeError: unsupported operand type(s) for +: 'float' and 'str
</code></pre> <p>To prevent this misleading exception message, <code>TypeError</code> exception must be prevented by using <code>try:</code> and <code>except TypeError:</code> and <code>return NotImplemented</code> to get the correct exception message.</p> <pre><code class="language-python">'''Implementation of Vector class is omitted here...'''
    def __add__(self, other):
        # Implementation with try and except TypeError and return NotImplemented
        try:
            pairs = itertools.zip_longest(self, other, fillvalue=0.0)
            return Vector(a + b for a, b in pairs)
        except TypeError:
            return NotImplemented

    def __radd__(self, other):
        return self + other
'''Implementation of Vector class is omitted here...'''
</code></pre> <p>By the above implementation, the following code will raise a correct <code>TypeError</code> exception message.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v6.py" language="python" line="235-244"></div> <h2 id="overloading--for-scalar-multiplication">Overloading <code>*</code> for Scalar Multiplication</h2> <p>In this subsection, the <code>*</code> operator is overloaded to support scalar multiplication. To overload the <code>*</code> operator, the <code>__mul__</code> and <code>__rmul__</code> method must be implemented.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v7.py" language="python" line="410-418"></div> <ul> <li> <code>factor = float(scalar)</code> is a duck typing technique to support scalar multiplication with an object that is not a <code>float</code> object.</li> <li> <code>try:</code>, <code>except TypeError:</code> and <code>return NotImplemented</code> are used to get the correct exception message.</li> <li> <code>__rmul__</code> method delegates to <code>__mul__</code> method, and this makes it possible to multiply a <code>Vector</code> object and an object of another type.</li> </ul> <h3 id="usage-of--for-vector-class-1"><em>Usage of <code>*</code> for <code>Vector</code> Class</em></h3> <p>The following code shows the basic usage of <code>*</code> for the <code>Vector</code> class.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v7.py" language="python" line="247-253"></div> <p>The following code shows an example of a case which <code>*</code> is used to multiply with unusual types.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v7.py" language="python" line="256-262"></div> <h2 id="using--as-an-infix-operator">Using <code>@</code> as an Infix Operator</h2> <p><code>@</code> is a new infix operator that is introduced in Python 3.5 <sup id="fnref:pythonorg__pep465" role="doc-noteref"><a href="#fn:pythonorg__pep465" class="footnote" rel="footnote">3</a></sup>. <code>@</code> is used to perform matrix multiplication. To overload the <code>@</code> operator, <code>__matmul__</code> and <code>__rmatmul__</code> method must be implemented.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v7.py" language="python" line="420-431"></div> <ul> <li>The parameter <code>other</code> of the <code>__matmul__</code> method must implement <code>__len__</code> and <code>__iter__</code> method. If <code>other</code> does not implement <code>__len__</code> and <code>__iter__</code>, then the <code>__matmul__</code> returns <code>NotImplemented</code>.</li> <li>The <code>__matmul__</code> method returns the result of the matrix multiplication only if the length of <code>other</code> is equal to the length of <code>self</code>. Otherwise, the <code>__matmul__</code> method raises <code>ValueError</code> with proper exception message.</li> <li> <code>__rmatmul__</code> method delegates to <code>__matmul__</code> method, and this makes it possible to perform matrix multiplication with an object of another type.</li> </ul> <h2 id="wrapping-up-arithmetic-operators">Wrapping-Up Arithmetic Operators</h2> <p>The following table shows the arithmetic infix operators and the corresponding special methods that are used to overload the arithmetic infix operators.</p> <table> <thead> <tr> <th>Operator</th> <th>Forward</th> <th>Reverse</th> <th>In-place</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>+</code></td> <td><code>__add__</code></td> <td><code>__radd__</code></td> <td><code>__iadd__</code></td> <td>Addition</td> </tr> <tr> <td><code>-</code></td> <td><code>__sub__</code></td> <td><code>__rsub__</code></td> <td><code>__isub__</code></td> <td>Subtraction</td> </tr> <tr> <td><code>*</code></td> <td><code>__mul__</code></td> <td><code>__rmul__</code></td> <td><code>__imul__</code></td> <td>Multiplication or repetition</td> </tr> <tr> <td><code>/</code></td> <td><code>__truediv__</code></td> <td><code>__rtruediv__</code></td> <td><code>__itruediv__</code></td> <td>True division</td> </tr> <tr> <td><code>//</code></td> <td><code>__floordiv__</code></td> <td><code>__rfloordiv__</code></td> <td><code>__ifloordiv__</code></td> <td>Floor division</td> </tr> <tr> <td><code>%</code></td> <td><code>__mod__</code></td> <td><code>__rmod__</code></td> <td><code>__imod__</code></td> <td>Modulo</td> </tr> <tr> <td><code>divmod()</code></td> <td><code>__divmod__</code></td> <td><code>__rdivmod__</code></td> <td><code>__idivmod__</code></td> <td>Divmod (Returns tuple of floor division quotient and modulo)</td> </tr> <tr> <td> <code>**</code>,<code>pow()</code> </td> <td><code>__pow__</code></td> <td><code>__rpow__</code></td> <td><code>__ipow__</code></td> <td>Exponentiation</td> </tr> <tr> <td><code>@</code></td> <td><code>__matmul__</code></td> <td><code>__rmatmul__</code></td> <td><code>__imatmul__</code></td> <td>Matrix multiplication</td> </tr> <tr> <td><code>&amp;</code></td> <td><code>__and__</code></td> <td><code>__rand__</code></td> <td><code>__iand__</code></td> <td>Bitwise AND</td> </tr> <tr> <td><code>|</code></td> <td><code>__or__</code></td> <td><code>__ror__</code></td> <td><code>__ior__</code></td> <td>Bitwise OR</td> </tr> <tr> <td><code>^</code></td> <td><code>__xor__</code></td> <td><code>__rxor__</code></td> <td><code>__ixor__</code></td> <td>Bitwise XOR</td> </tr> <tr> <td><code>&lt;&lt;</code></td> <td><code>__lshift__</code></td> <td><code>__rlshift__</code></td> <td><code>__ilshift__</code></td> <td>Bitwise left shift</td> </tr> <tr> <td><code>&gt;&gt;</code></td> <td><code>__rshift__</code></td> <td><code>__rrshift__</code></td> <td><code>__irshift__</code></td> <td>Bitwise right shift</td> </tr> </tbody> </table> <h2 id="rich-comparison-operators">Rich Comparison Operators</h2> <p>There are six rich comparison operators <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> in Python.</p> <ul> <li>These operators are called rich comparison operators because they return a rich set of boolean values.</li> <li>The same set of methods is used in forward and reverse comparison.</li> <li>The only exception is that <code>==</code> and <code>!=</code> has fallback behavior. <ul> <li> <code>==</code> : If the reverse method is missing or returns <code>NotImplemented</code>, then the <code>__eq__</code> method compares the <code>id</code> of the two objects.</li> <li> <code>!=</code> : If the reverse method is missing or returns <code>NotImplemented</code>, then the <code>__ne__</code> method returns the negation of the result of <code>__eq__</code> method.</li> </ul> </li> </ul> <table> <thead> <tr> <th>Group</th> <th>Infix operator</th> <th>Forward method call</th> <th>Reverse method call</th> <th>Fallback</th> </tr> </thead> <tbody> <tr> <td>Equality</td> <td><code>a == b</code></td> <td><code>a.__eq__(b)</code></td> <td><code>b.__eq__(a)</code></td> <td><code>Return id(a) == id(b)</code></td> </tr> <tr> <td>Equality</td> <td><code>a != b</code></td> <td><code>a.__ne__(b)</code></td> <td><code>b.__ne__(a)</code></td> <td><code>Return not (a == b)</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &gt; b</code></td> <td><code>a.__gt__(b)</code></td> <td><code>b.__lt__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &lt; b</code></td> <td><code>a.__lt__(b)</code></td> <td><code>b.__gt__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &gt;= b</code></td> <td><code>a.__ge__(b)</code></td> <td><code>b.__le__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &lt;= b</code></td> <td><code>a.__le__(b)</code></td> <td><code>b.__ge__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> </tbody> </table> <h3 id="example-of-implementations-of-rich-comparison-operators"><em>Example of Implementations of Rich Comparison Operators</em></h3> <p>The following code shows an example of implementing <code>__eq__</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v7.py" language="python" line="328-330"></div> <p>By using this implementation, comparing two <code>Vector</code> objects with the same components will return <code>True</code>, regardless of the type of the other object to be compared.</p> <pre><code class="language-python">&gt;&gt;&gt; va = Vector([1.0, 2.0, 3.0])
&gt;&gt;&gt; vb = Vector(range(1, 4))
&gt;&gt;&gt; va == vb
True
&gt;&gt;&gt; vc = Vector([1, 2])
&gt;&gt;&gt; from vector2d_v3 import Vector2d
&gt;&gt;&gt; v2d = Vector2d(1, 2)
&gt;&gt;&gt; vc == v2d
True
&gt;&gt;&gt; t3 = (1, 2, 3)
&gt;&gt;&gt; va == t3
True
</code></pre> <p>Comparison between <code>Vector</code> objects with different type of iteratable objects may cause unexpected behavior. In the following example of <code>__eq__</code> method, comparison <code>Vector</code> objects with different type of iteratable objects will return <code>NotImplemented</code>.</p> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v8.py" language="python" line="330-335"></div> <ul> <li> <code>&lt;1&gt;</code> : By using <code>isinstance</code> check on <code>other</code> object, it is possible to prevent comparison between <code>Vector</code> object and an object of another type.</li> <li> <code>&lt;2&gt;</code> : If <code>other</code> object is not an instance of <code>Vector</code> class, then <code>NotImplemented</code> is returned.</li> </ul> <h3 id="what-happens-when-using--operator"><em>What happens when using <code>==</code> operator</em></h3> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v8.py" language="python" line="273-285"></div> <h4 id="tests-of-operator-vc--v2d"><em>Tests of operator <code>vc == v2d</code></em></h4> <p><code>vc == v2d</code> returns <code>True</code> on the above example. The following steps show that how <code>True</code> is returned.</p> <ol> <li>To evaluate <code>vc == v2d</code>, <code>vc.__eq__(v2d)</code> is called.</li> <li> <code>vc.__eq__(v2d)</code> returns <code>NotImplemented</code> because <code>v2d</code> is not an instance of <code>Vector</code> class.</li> <li> <code>v2d.__eq__(vc)</code> is called because <code>NotImplemented</code> is returned.</li> <li>In the <code>v2d.__eq__(vc)</code> method, there is no <code>isinstance</code> check on <code>other</code> object, so the result <code>True</code> is returned.</li> </ol> <h4 id="tests-of-operator-va--t3"><em>Tests of operator <code>va == t3</code></em></h4> <p><code>va == t3</code> returns <code>False</code> on the above example. The following steps show that how <code>False</code> is returned.</p> <ol> <li>To evaluate <code>va == t3</code>, <code>va.__eq__(t3)</code> is called.</li> <li> <code>va.__eq__(t3)</code> returns <code>NotImplemented</code> because <code>t3</code> is not an instance of <code>Vector</code> class.</li> <li> <code>t3.__eq__(va)</code> is called because <code>NotImplemented</code> is returned.</li> <li>The <code>t3.__eq__(va)</code> method cannot handle the comparison between <code>Vector</code> object and <code>tuple</code> object, so <code>NotImplemented</code> is returned.</li> <li> <code>NotImplemented</code> is returned from <code>t3.__eq__(va)</code>, so the fallback behavior <code>id(va) == id(t3)</code> is used. Since <code>va</code> and <code>t3</code> are different objects, <code>False</code> is returned.</li> </ol> <h3 id="what-happens-when-using--operator-1"><em>What happens when using <code>!=</code> operator</em></h3> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="01e717b60a9a14bc1bca4bffd915f7ed2c637e5e" path="16-op-overloading/vector_v8.py" language="python" line="288-295"></div> <p>There is no implementation of <code>__ne__</code> method on the above example. Therefore, the fallback behavior is used when <code>va != vb</code>, <code>vc != v2d</code> and <code>va != (1, 2, 3)</code> is evaluated.</p> <p>The fallback behavior of <code>!=</code> operator is <code>not (a == b)</code>. Therefore, the following comparison results are returned when <code>!=</code> operator is used.</p> <ol> <li> <code>va != vb</code> is equivalant to <code>not (va == vb)</code>, so <code>False</code> is returned.</li> <li> <code>vc != v2d</code> is equivalant to <code>not (vc == v2d)</code>, so <code>False</code> is returned.</li> <li> <code>va != (1, 2, 3)</code> is equivalant to <code>not (va == (1, 2, 3))</code>, so <code>True</code> is returned.</li> </ol> <h2 id="augmented-assignment-operators">Augmented Assignment Operators</h2> <p>Augmented assignment operators are used to perform an operation and assign the result to the left operand. For example, the following code shows the usage of augmented assignment operators <code>+=</code> and <code>*=</code> on <code>Vector</code> objects.</p> <pre><code class="language-python">&gt;&gt;&gt; v1 = Vector([1, 2, 3])
&gt;&gt;&gt; v1_alias = v1
&gt;&gt;&gt; id(v1)
4302860128
&gt;&gt;&gt; v1 += Vector([4, 5, 6])
&gt;&gt;&gt; v1
Vector([5.0, 7.0, 9.0])
&gt;&gt;&gt; id(v1)
4302859904
&gt;&gt;&gt; v1_alias
Vector([1.0, 2.0, 3.0])
&gt;&gt;&gt; v1 *= 11
&gt;&gt;&gt; v1
Vector([55.0, 77.0, 99.0])
&gt;&gt;&gt; id(v1)
4302858336
</code></pre> <h3 id="syntactic-sugar-of-augmented-assignment-operators"><em>Syntactic Sugar of Augmented Assignment Operators</em></h3> <ul> <li> <code>a += b</code> : <code>a.__iadd__(b)</code> is called if <code>a</code> has <code>__iadd__</code> method. Otherwise, <code>a = a + b</code> is called.</li> <li> <code>a *= b</code> : <code>a.__imul__(b)</code> is called if <code>a</code> has <code>__imul__</code> method. Otherwise, <code>a = a * b</code> is called.</li> </ul> <p>The <code>Vector</code> objects already supports <code>+=</code> and <code>*=</code> operators because the <code>Vector</code> class implements <code>__add__</code> method and <code>__mul__</code> method.</p> <p>However, the results of calling <code>id()</code> on the above example shows that the results of <code>v1 += Vector([4, 5, 6])</code> and <code>v1 *= 11</code> are different objects from <code>v1_alias</code>. This is because the <code>__add__</code> method and <code>__mul__</code> method returns a new <code>Vector</code> object instead of modifying the existing <code>Vector</code> object.</p> <p><code>Vector</code> class is immutable, therefore <code>__iadd__</code> and <code>__imul__</code> methods should not be implemented. However, if <code>Vector</code> class is mutable, then <code>__iadd__</code> and <code>__imul__</code> methods, which modify the existing <code>Vector</code> object, should be implemented.</p> <h3 id="implementation-of-addablebingocage-class"><em>Implementation of <code>AddableBingoCage</code> Class</em></h3> <p>In this subchapter, the <code>AddableBingoCage</code> class is implemented to support the infix operator <code>+</code> and the augmented assignment operator <code>+=</code>. The <code>AddableBingoCage</code> object is mutable, therefore the <code>+=</code> operator modifies the existing object.</p> <dl> <dt> <code>+</code> Operator</dt> <dd>The <code>+</code> operator on the <code>AddableBingoCage</code> class accepts only the abstract base class <code>Tombola</code>. The result of the <code>+</code> operator produces a new <code>AddableBingoCage</code> object.</dd> <dt> <code>+=</code> Operator</dt> <dd>The <code>+=</code> operator on the <code>AddableBingoCage</code> class accepts the abc <code>Tombola</code> and any iterable object. The result of the <code>+=</code> operator modifies the existing <code>AddableBingoCage</code> object and returns <code>self</code>.</dd> </dl> <h4 id="details-of-implementation"><em>Details of Implementation</em></h4> <details><summary> Details of the <code>Tombola</code> class </summary> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="135eca25d91595e30eb8538a4b9b7f70393ad5a6" path="13-protocol-abc/tombola.py" language="python" line="3-31"></div> </details> <details><summary> Details of the <code>BingoCage</code> class </summary> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="13-protocol-abc/bingo.py" language="python" line="3-26"></div> </details> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="16-op-overloading/bingoaddable.py" language="python" line="58-81"></div> <ul> <li> <code>&lt;2&gt;</code> : The <code>AddableBingoCage</code> class inherits from the <code>BingoCage</code> class.</li> <li> <code>&lt;3&gt;</code> : The <code>+</code> operator on the <code>AddableBingoCage</code> object only accepts the abstract base class <code>Tombola</code>.</li> <li> <code>&lt;4&gt;</code> : If <code>other</code> object is an instance of the <code>Tombola</code> class, then <code>other.inspect()</code> is called to get the contents of <code>other</code> object.</li> <li> <code>&lt;5&gt;</code> : If <code>other</code> object is not an instance of <code>Tombola</code> class, then try to get iterator from the <code>other</code> object.</li> <li> <code>&lt;6&gt;</code> : If acquiring iterator from <code>other</code> object is failed and <code>TypeError</code> is raised, then raises <code>TypeError</code> exception with proper exception message.</li> <li> <code>&lt;7&gt;</code> : Load the contents of <code>other</code> object using the iterator acquired from <code>&lt;5&gt;</code>.</li> <li> <code>&lt;8&gt;</code> : The <code>AddableBingoCage</code> object is mutable, therefore the <code>__iadd__</code> method returns <code>self</code>.</li> </ul> <h4 id="usage-of-addablebingocage-class"><em>Usage of <code>AddableBingoCage</code> Class</em></h4> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="16-op-overloading/bingoaddable.py" language="python" line="11-26"></div> <ul> <li> <code>&lt;1&gt;</code> : Create an <code>AddableBingoCage</code> object <code>vowels</code> with the contents <code>AEIOU</code>.</li> <li> <code>&lt;2&gt;</code> : Pop one of the contents of <code>globe</code> object and verify that the popped value is one of the vowels.</li> <li> <code>&lt;3&gt;</code> : Check the number of contents of <code>globe</code> object.</li> <li> <code>&lt;4&gt;</code> : Create a second instance with three item <code>'XYZ'</code>.</li> <li> <code>&lt;5&gt;</code> : Confirm the number of contents of <code>globe3</code> object.</li> <li> <code>&lt;6&gt;</code> : Mixed type addition is not supported, so this code will raise the <code>TypeError</code> exception.</li> </ul> <div class="embed-github-src" repo="fluentpython/example-code-2e/" branch="47cafc801a8e811b7cd7e7a5821f1ad4a65efa52" path="16-op-overloading/bingoaddable.py" language="python" line="35-49"></div> <ul> <li> <code>&lt;1&gt;</code> : Create an alias for the <code>globe</code> object.</li> <li> <code>&lt;2&gt;</code> : The <code>globe</code> has 4 items.</li> <li> <code>&lt;3&gt;</code> : Adds <code>globe2</code>, which is an object of the <code>AddableBingoCage</code> class, to the <code>globe</code> object.</li> <li> <code>&lt;4&gt;</code> : The augmented assignment operator <code>+=</code> can be used to add an iterable object to the <code>globe</code> object.</li> <li> <code>&lt;5&gt;</code> : The alias for the <code>globe</code> object, <code>globe_orig</code>, and <code>globe</code> object are the same objects. <ul> <li>There is no <code>__eq__</code> method on the <code>AddableBingoCage</code> class, so the <code>==</code> operator will compare the <code>id</code> of the two objects, which is the fallback behavior of the <code>==</code> operator.</li> </ul> </li> <li> <code>&lt;6&gt;</code> : Trying to add a non-iterable object to the <code>globe</code> object will raise a <code>TypeError</code> exception.</li> </ul> <h2 id="chapter-summary">Chapter Summary</h2> <h3 id="unary-operators-1">Unary Operators</h3> <table> <thead> <tr> <th>Operator</th> <th>Method</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>-</code></td> <td><code>__neg__</code></td> <td>Negation</td> </tr> <tr> <td><code>+</code></td> <td><code>__pos__</code></td> <td>Plus</td> </tr> <tr> <td><code>~</code></td> <td><code>__invert__</code></td> <td>Bitwise NOT</td> </tr> <tr> <td><code>abs()</code></td> <td><code>__abs__</code></td> <td>Absolute value</td> </tr> </tbody> </table> <h3 id="infix-operators">Infix Operators</h3> <table> <thead> <tr> <th>Operator</th> <th>Forward</th> <th>Reverse</th> <th>In-place</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>+</code></td> <td><code>__add__</code></td> <td><code>__radd__</code></td> <td><code>__iadd__</code></td> <td>Addition</td> </tr> <tr> <td><code>-</code></td> <td><code>__sub__</code></td> <td><code>__rsub__</code></td> <td><code>__isub__</code></td> <td>Subtraction</td> </tr> <tr> <td><code>*</code></td> <td><code>__mul__</code></td> <td><code>__rmul__</code></td> <td><code>__imul__</code></td> <td>Multiplication or repetition</td> </tr> <tr> <td><code>/</code></td> <td><code>__truediv__</code></td> <td><code>__rtruediv__</code></td> <td><code>__itruediv__</code></td> <td>True division</td> </tr> <tr> <td><code>//</code></td> <td><code>__floordiv__</code></td> <td><code>__rfloordiv__</code></td> <td><code>__ifloordiv__</code></td> <td>Floor division</td> </tr> <tr> <td><code>%</code></td> <td><code>__mod__</code></td> <td><code>__rmod__</code></td> <td><code>__imod__</code></td> <td>Modulo</td> </tr> <tr> <td><code>divmod()</code></td> <td><code>__divmod__</code></td> <td><code>__rdivmod__</code></td> <td><code>__idivmod__</code></td> <td>Divmod</td> </tr> <tr> <td> <code>**</code>,<code>pow()</code> </td> <td><code>__pow__</code></td> <td><code>__rpow__</code></td> <td><code>__ipow__</code></td> <td>Exponentiation</td> </tr> <tr> <td><code>@</code></td> <td><code>__matmul__</code></td> <td><code>__rmatmul__</code></td> <td><code>__imatmul__</code></td> <td>Matrix multiplication</td> </tr> <tr> <td><code>&amp;</code></td> <td><code>__and__</code></td> <td><code>__rand__</code></td> <td><code>__iand__</code></td> <td>Bitwise AND</td> </tr> <tr> <td><code>|</code></td> <td><code>__or__</code></td> <td><code>__ror__</code></td> <td><code>__ior__</code></td> <td>Bitwise OR</td> </tr> <tr> <td><code>^</code></td> <td><code>__xor__</code></td> <td><code>__rxor__</code></td> <td><code>__ixor__</code></td> <td>Bitwise XOR</td> </tr> <tr> <td><code>&lt;&lt;</code></td> <td><code>__lshift__</code></td> <td><code>__rlshift__</code></td> <td><code>__ilshift__</code></td> <td>Bitwise left shift</td> </tr> <tr> <td><code>&gt;&gt;</code></td> <td><code>__rshift__</code></td> <td><code>__rrshift__</code></td> <td><code>__irshift__</code></td> <td>Bitwise right shift</td> </tr> </tbody> </table> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/fluent-python/chapter-16/add_radd.svg-1400.webp"></source> <img src="/python/fluent-python/chapter-16/add_radd.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Flowchart for computing <code>a + b</code> with <code>__add__</code> and <code>__radd__</code>.</figcaption> </figure> </div> </div> <h3 id="rich-comparison-operators-1">Rich Comparison Operators</h3> <table> <thead> <tr> <th>Group</th> <th>Infix operator</th> <th>Forward method call</th> <th>Reverse method call</th> <th>Fallback</th> </tr> </thead> <tbody> <tr> <td>Equality</td> <td><code>a == b</code></td> <td><code>a.__eq__(b)</code></td> <td><code>b.__eq__(a)</code></td> <td><code>Return id(a) == id(b)</code></td> </tr> <tr> <td>Equality</td> <td><code>a != b</code></td> <td><code>a.__ne__(b)</code></td> <td><code>b.__ne__(a)</code></td> <td><code>Return not (a == b)</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &gt; b</code></td> <td><code>a.__gt__(b)</code></td> <td><code>b.__lt__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &lt; b</code></td> <td><code>a.__lt__(b)</code></td> <td><code>b.__gt__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &gt;= b</code></td> <td><code>a.__ge__(b)</code></td> <td><code>b.__le__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> <tr> <td>Ordering</td> <td><code>a &lt;= b</code></td> <td><code>a.__le__(b)</code></td> <td><code>b.__ge__(a)</code></td> <td><code>Raise TypeError</code></td> </tr> </tbody> </table> <h2 id="further-reading">Further Reading</h2> <ul> <li><a href="https://neopythonic.blogspot.com/2019/03/why-operators-are-useful.html" rel="external nofollow noopener" target="_blank">Why operators are useful</a></li> <li><a href="https://treyhunner.com/2019/03/python-deep-comparisons-and-code-readability/" rel="external nofollow noopener" target="_blank">Tuple ordering and deep comparisons in Python</a></li> <li><a href="https://docs.python.org/3/reference/datamodel.html" rel="external nofollow noopener" target="_blank">3. Data model</a></li> <li><a href="https://docs.python.org/3/library/numbers.html#implementing-the-arithmetic-operations" rel="external nofollow noopener" target="_blank"><code>numbers</code> â Numeric abstract base classes : Implementing the arithmetic operations</a></li> </ul> <h2 id="links">Links</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:pythonorg__expressions_unary" role="doc-endnote"> <p><a href="https://docs.python.org/3/reference/expressions.html#unary-arithmetic-and-bitwise-operations" rel="external nofollow noopener" target="_blank">6. Expressions : 6.6. Unary arithmetic and bitwise operations</a>Â <a href="#fnref:pythonorg__expressions_unary" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__datamodel_abs" role="doc-endnote"> <p><a href="https://docs.python.org/3/reference/datamodel.html#object.__abs__" rel="external nofollow noopener" target="_blank">3. Data model : <code>object.__abs__</code></a>Â <a href="#fnref:pythonorg__datamodel_abs" class="reversefootnote" role="doc-backlink">â©</a></p> </li> <li id="fn:pythonorg__pep465" role="doc-endnote"> <p><a href="https://www.python.org/dev/peps/pep-0465/" rel="external nofollow noopener" target="_blank">PEP 465 â A dedicated infix operator for matrix multiplication</a>Â <a href="#fnref:pythonorg__pep465" class="reversefootnote" role="doc-backlink">â©</a></p> </li> </ol> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2024 Dongseok Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script> <script>hljs.highlightAll();</script> <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script> <script>hljs.initLineNumbersOnLoad();</script> <script>function append_code_block_header(e){if(!e.className)return;const[t,r]=get_language_and_url(e);r&&(replace_className(e,t),elemCodeBlockHeader=create_elem_code_block_header(r),append_elem_code_block_header_to_previous(e,elemCodeBlockHeader))}function get_language_and_url(e){return e.className.split(/:(.*)/s)}function replace_className(e,t){e.classList.remove(e.className),e.classList.add(t)}function create_elem_code_block_header(e){var t=document.createElement("a");return t.textContent=e,(e.startsWith("http://")||e.startsWith("https://"))&&(t.setAttribute("href",e),t.setAttribute("target","_blank")),t.className="language-plaintext",t}function append_elem_code_block_header_to_previous(e,t){var r=e.parentElement;r.insertBefore(t,r.firstChild),r.classList.add("code-block-header")}function embed_external_source(e){var t=get_url_raw(e),r=get_url_blob(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c),_={startFrom:Math.max(l,1)};e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c,_)})["catch"](function(e){throw e})}function embed_local_source(e){var t=get_url_raw_local(e),r=get_url_blob_local(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c);e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c)})["catch"](function(e){throw e})}function get_url_raw(e){return["https://raw.githubusercontent.com",e.getAttribute("repo"),e.getAttribute("branch"),e.getAttribute("path")].join("/")}function get_url_blob(e){return["https://github.com",e.getAttribute("repo"),"blob",e.getAttribute("branch"),e.getAttribute("path")+get_line_specifier(e)].join("/")}function get_url_raw_local(e){return e.getAttribute("path")}function get_url_blob_local(e){return get_url_raw_local(e)}function get_lines(e){const t=e.getAttribute("line");if(!t)return[0,0];var[r,n]=t.split(/-(.*)/s);return r=parseInt(r),n=parseInt(n),isNaN(r)&&(r=0),isNaN(n)&&(n=0),[r,n]}function get_line_specifier(e){const t=get_lines(e);return 0==t[0]&&0==t[1]?"":(0==t[1]&&t[1],"#L"+String(t[0])+"-L"+String(t[1]))}function create_elem_code_block(e,t,r,n,c){var l=document.createElement("code");return l.className="language-"+e+":"+t,l.textContent=slice_by_line_number(r,n,c),l}function slice_by_line_number(e,t,r){return 0==t&&0==r?e:(0==t&&(t=1),e.split("\n").slice(t-1,r).join("\n"))}function create_elem_pre_from_code_block(e){var t=document.createElement("pre");return t.appendChild(e),append_code_block_header(e),t}const code=document.getElementsByTagName("code");Array.from(code).forEach(append_code_block_header);var divs=document.getElementsByClassName("embed-github-src");Array.prototype.forEach.call(divs,embed_external_source);divs=document.getElementsByClassName("embed-local-src");Array.prototype.forEach.call(divs,embed_local_source);</script> </body> </html>