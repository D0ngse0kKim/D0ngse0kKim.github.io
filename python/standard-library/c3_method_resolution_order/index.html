<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>C3 Method Resolution Order | Dongseok Kim</title> <meta name="author" content="Dongseok Kim"> <meta name="description" content="Details of method resolution order in complex class hierarchy"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-light.min.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-dark.min.css" media="none" id="highlight_theme_dark"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://d0ngse0kkim.github.io/python/standard-library/c3_method_resolution_order/"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "C3 Method Resolution Order",
      "description": "Details of method resolution order in complex class hierarchy",
      "published": "February 3, 2024",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Dongseok </span>Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">programming</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/python">Python</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/softwaredesign/">Software Design</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/tools/">Tools</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">hobbies</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/running">running</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">others</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/repositories">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/cv/">cv</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>C3 Method Resolution Order</h1> <p>Details of method resolution order in complex class hierarchy</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#abstract">Abstract</a></div> <div><a href="#basic-definitions">Basic Definitions</a></div> <div><a href="#an-example-of-the-nonexistence-of-linearization">An example of the nonexistence of linearization</a></div> <div><a href="#the-c3-method-resolution-order">The C3 Method Resolution Order</a></div> <div><a href="#mro-calculation-examples">MRO calculation examples</a></div> <div><a href="#bad-method-resolution-orders">Bad Method Resolution Orders</a></div> <div><a href="#mro-calculation-codes">MRO Calculation Codes</a></div> <div><a href="#links">Links</a></div> </nav> </d-contents> <h2 id="abstract">Abstract</h2> <p>In this article, the method resolution order introduced in the Python 2.3 <sup id="fnref:MRO-in-Python-2-3" role="doc-noteref"><a href="#fn:MRO-in-Python-2-3" class="footnote" rel="footnote">1</a></sup> will be discussed.</p> <h2 id="basic-definitions">Basic Definitions</h2> <ol> <li> <dl> <dt>Method Resolution Order(MRO)</dt> <dd>Given a class <code>C</code> in a complicated multiple inheritance hierarchy, it is a non-trivial task to specify the order in which methods are overridden, i.e. to specify the order of the ancestors of <code>C</code>. <strong>Method Resolution Order(MRO)</strong> defines the order in which a method is searched for in a classes hierarchy.</dd> </dl> </li> <li> <dl> <dt>A list of the ancestors of a class <code>C</code> and the linearization of <code>C</code> </dt> <dd>The list of the ancestors of a class <code>C</code>, including the class itself, ordered from the nearest ancestor to the furthest in MRO, is called <strong>the class precedence list</strong> or <strong>the linearization of <code>C</code></strong>.</dd> </dl> </li> <li> <dl> <dt>The Method Resolution Order (MRO) and Linearization</dt> <dd>The Method Resolution Order (MRO) is the set of rules that construct the linearization. In the Python literature, the idiom “the MRO of <code>C</code>” is also used as a synonymous for the linearization of the class <code>C</code>.</dd> </dl> </li> <li> <dl> <dt>Example of MRO and Linearization</dt> <dd>For instance, in the case of single inheritance hierarchy, if <code>C</code> is a subclass of <code>C1</code>, and <code>C1</code> is a subclass of <code>C2</code>, then the linearization of <code>C</code> is simply the list <code>[C, C1, C2]</code>. However, with multiple inheritance hierarchies, the construction of the linearization is more cumbersome, since it is more difficult to construct a linearization that respects local precedence ordering and monotonicity.</dd> </dl> </li> <li> <dl> <dt>Monotonicity on MRO</dt> <dd>I will discuss the local precedence ordering later, but I can give the definition of monotonicity here. A MRO is <strong>monotonic</strong> when the following is true:</dd> </dl> <ol> <li>If <code>C1</code> precedes <code>C2</code> in the linearization of <code>C</code>, then <code>C1</code> precedes <code>C2</code> in the linearization of any subclass of <code>C</code>.</li> <li>Otherwise, the innocuous operation of deriving a new class could change the resolution order of methods, potentially introducing very subtle bugs. Examples where this happens will be shown later.</li> </ol> </li> <li> <dl> <dt>Existance of linearization</dt> <dd>Not all classes admit a linearization. There are cases, in complicated hierarchies, where it is not possible to derive a class such that its linearization respects all the desired properties.</dd> </dl> </li> </ol> <h2 id="an-example-of-the-nonexistence-of-linearization">An example of the nonexistence of linearization</h2> <p>Consider the following source code defining classes <code>O</code>, <code>X</code>, <code>Y</code>, <code>A</code>, <code>B</code> and <code>C</code>. In this case, it is not possible to derive a new class <code>C</code> from class <code>A</code> and <code>B</code> due to the following reasons:</p> <ol> <li>The definition of class <code>A</code> has <code>X</code> preceding <code>Y</code>, but in the definition of class <code>B</code>, <code>Y</code> precedes <code>X</code>.</li> <li>As a result, the method resolution order would be ambiguous in class <code>C</code>.</li> </ol> <p>Python 2.3 raises an exception in this situation (<code>TypeError: MRO conflict among bases Y, X</code>) preventing the creation of ambiguous hierarchies by naive programmers. On the other hand, Python 2.2 instead does not raise an exception, but chooses an <em>ad hoc</em> ordering (<code>CABXYO</code> in this case).</p> <div class="row row-cols-2 align-items-center"> <div class="col-sm-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/OXYAB.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes O, X, Y, A and B.</figcaption> </figure> </div> <div class="col-sm-9"> <pre class="language-python">
            <code class="language-python hljs">O = object

class X(O): pass
class Y(O): pass

class A(X,Y): pass
class B(Y,X): pass

class C(A,B): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes O, X, Y, A and B.</figcaption> </div> </div> <h2 id="the-c3-method-resolution-order">The C3 Method Resolution Order</h2> <h3 id="notations">Notations</h3> <p>This chapter describes the C3 Method Resolution Order. In order to illustrates class hierarchy for a certain method resolution order, the following shortcut notation is used to indicate the list of classes <code>[C1, C2, ..., CN]</code></p> \[C_1\;C_2\;\ldots\;C_N\] <p>In this notation, the <em>head</em> of the list means its first element:</p> \[\textrm{head} = C_1\] <p>The <em>tail</em> of the list means the rest element of the list:</p> \[\textrm{tail} = C_2 \ldots C_N\] <p>In order to denote the sum of the lists <code>[C] + [C1, C2, ..., CN]</code>, the following notation will be used.</p> \[C + (C_1\;C_2\;\ldots\;C_N) = C\;C_1\;C_2\;\ldots\;C_N\] <h3 id="how-the-mro-works-in-the-python-23">How the MRO works in the Python 2.3</h3> <p>Consider a class <code>C</code> in a complex multiple inheritance hierarchy, with <code>C</code> inheriting from the base classes <code>B1</code>, <code>B2</code>, …, <code>BN</code>. We want to compute the linearization $L\left[C\right]$ of the class <code>C</code>. The rule is the following.</p> <p>The linearization of <code>C</code>, denotes as $L\left[C\left(B_1\;B_2\;\ldots\;B_N\right)\right]$ is the sum of</p> <ol> <li>$C$ and</li> <li> <p>the $merge$ of</p> <ol> <li>the linearizations of the parents ($L\left[C\left(B_1\;B_2\;\ldots\;B_N\right)\right]$)</li> <li>the list of the parents ($B_1\;B_2\;\ldots\;B_N$).</li> </ol> </li> </ol> <p>This can be denote by the following equations.</p> \[\begin{split} &amp;L\left[C\left(B_1\;B_2\;\ldots\;B_N\right)\right] \\ &amp;= C + merge\left(L[B_1]\;L[B_2]\;\ldots\;L[B_N],\;B_1\;B_2\;\ldots\;B_N\right) \end{split}\] <p>In order to calculate $merge$, the following procedures are needed:</p> <ol> <li>Take the head of the first list, idx.e $L[B_1][0]$</li> <li>If this head is not in the tail of any of the other lists, then add the first list to the linearization of $C$ and remove it from the lists in the $merge$ operation. Otherwise, look at the head of the next list and take it, if it is a good head.</li> <li>Then repeat the operation until all the class are removed or it is impossible to find good heads.</li> </ol> <p>This prescription ensures that the $merge$ operation preserves the ordering, if the ordering can be preserved. On the other hand, if the order cannot be preserved (as in the example of serious order disagreement discussed above) then the $merge$ cannot be computed.</p> <h2 id="mro-calculation-examples">MRO calculation examples</h2> <h3 id="simple-example-of-computation-in-case-of-single-inheritance">Simple Example of Computation in case of Single Inheritance</h3> <p>The following computation of the merge is trivial if $C$ has only one parent (single inheritance).</p> \[\begin{split} L[C] = L[C(B)] &amp;= C + merge\left(L[B],\;B\right) \\ &amp;=C + L[B] \end{split}\] <p>In special case of $C = object$, the linearization of $C$(equals $object$) is represented by the following equation because $object$ has no parent.</p> \[L[object] = object\] <h3 id="first-complex-example-of-multiple-inheritance">First Complex example of multiple inheritance</h3> <div class="row row-cols-2 align-items-center"> <div class="col-sm-4"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/OFEDCBA.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes O, F, E, D, C, B and A.</figcaption> </figure> </div> <div class="col-sm-6"> <pre class="language-python">
            <code class="language-python hljs">O = object

class F(O): pass
class E(O): pass
class D(O): pass

class C(D,F): pass
class B(D,E): pass

class A(B,C): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes O, F, E, D, C, B and A.</figcaption> </div> </div> <p>The linearization of $O$, $D$, $E$, $F$(represented by $L[O]$, $L[D]$, $L[E]$, $L[F]$) are derived like the following equation:</p> \[\begin{split} L[O] &amp;= O \\ L[D] &amp;= L[D(O)] = D + merge(L[O], O) = D\;L[O] = DO\\ L[E] &amp;= L[E(O)] = E + merge(L[O], O) = E\;L[O] = EO\\ L[F] &amp;= L[F(O)] = F + merge(L[O], O) = F\;L[O] = FO \end{split}\] <p>The linearization of $B$ (represented by $L[B]$ or $L[B(D\;E)]$ in a more explicit form) can be computed using the following equation:</p> \[\begin{split} L[B] = L[B(D\;E)] &amp;= B + merge[L[D],\;L[E],\;DE] \\ &amp;= B + merge[DO,\;EO, DE] \\ &amp;= BD + merge[O,\;EO, E] \\ &amp;= BDE + merge[O,\;O] \\ &amp;= BDEO \end{split}\] <p>The linearization of $C$ (represented by $L[C]$ or $L[C(D\;F)]$ in a more explicit form) can be computed using the following equation:</p> \[\begin{split} L[C] = L[C(D\;F)] &amp;= C + merge[L[D],\;L[F],\;DF] \\ &amp;= C + merge[DO,\;FO, DF] \\ &amp;= CD + merge[O,\;FO, F] \\ &amp;= CDF + merge[O,\;O] \\ &amp;= CDFO \end{split}\] <p>Now we can compute the linearization of $A$ (represented by $L[A]$ or $L[A(B\;C)]$ in a more explicit form) using the following equation:</p> \[\begin{split} L[A] = L[A(B\;C)] &amp;= A + merge[L[B],\;L[C],\;BC]\\ &amp;= A + merge[BDEO,\;CDFO,\;BC] \\ &amp;= AB + merge[DEO,\;CDFO,\;C] \\ &amp;= ABC + merge[DEO,\;DFO] \\ &amp;= ABCD + merge[EO,\;FO] \\ &amp;= ABCDE + merge[O,\;FO] \\ &amp;= ABCDEF + merge[O,\;O] \\ &amp;= ABCDEFO \\ \end{split}\] <h3 id="second-complex-example-of-multiple-inheritance">Second Complex example of multiple inheritance</h3> <div class="row row-cols-2 align-items-center"> <div class="col-sm-4"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA2.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA2.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/OFEDCBA2.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/OFEDCBA2.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes O, F, E, D, C, B and A.</figcaption> </figure> </div> <div class="col-sm-6"> <pre class="language-python">
            <code class="language-python hljs">O = object

class F(O): pass
class E(O): pass
class D(O): pass

class C(D,F): pass
class B(E,D): pass

class A(B,C): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes O, X, Y, A and B.</figcaption> </div> </div> <p>The linearization of $O$, $D$, $E$, $F$ (represented by $L[O]$, $L[D]$, $L[E]$, $L[F]$) are derived like the following equation:</p> \[\begin{split} L[O] &amp;= O \\ L[D] &amp;= L[D(O)] = D + merge(L[O], O) = D L[O] = DO\\ L[E] &amp;= L[E(O)] = E + merge(L[O], O) = E L[O] = EO\\ L[F] &amp;= L[F(O)] = F + merge(L[O], O) = F L[O] = FO \end{split}\] <p>The linearization of $B$ (represented by $L[B]$ or $L[B(E\;D)]$ in a more explicit form) can be computed using the following equation:</p> \[\begin{split} L[B] = L[B(E\;D)] &amp;= B + merge[L[E],\;L[D],\;ED] \\ &amp;= B + merge[EO,\;DO, ED] \\ &amp;= BE + merge[O,\;DO, D] \\ &amp;= BED + merge[O,\;O] \\ &amp;= BEDO \end{split}\] <p>The linearization of $C$ (represented by $L[C]$ or $L[C(D\;F)]$ in a more explicit form) can be computed using the following equation:</p> \[\begin{split} L[C] = L[C(D\;F)] &amp;= C + merge[L[D],\;L[F],\;DF] \\ &amp;= C + merge[DO,\;FO, DF] \\ &amp;= CD + merge[O,\;FO, F] \\ &amp;= CDF + merge[O,\;O] \\ &amp;= CDFO \\ \end{split}\] <p>Now we can compute the linearization of $A$ (represented by $L[A]$ or $L[A(B\;C)]$ in a more explicit form) using the following equation:</p> \[\begin{split} L[A] = L[A(B\;C)] &amp;= A + merge[L[B],\;L[C],\;BC]\\ &amp;= A + merge[BEDO,\;CDFO,\;BC] \\ &amp;= AB + merge[EDO,\;CDFO,\;C] \\ &amp;= ABE + merge[DO,\;CDFO,\;C] \\ &amp;= ABEC + merge[DO,\;DFO] \\ &amp;= ABECD + merge[O,\;FO] \\ &amp;= ABECDF + merge[O,\;O] \\ &amp;= ABECDFO \end{split}\] <p>The results of $L[A(B\;C)] = ABECDFO$ can be checked by obtaining MRO from <code>A.mro()</code> method in Python interpreter. The following are examples of interpreter output:</p> <pre><code class="language-python">&gt;&gt;&gt; O = object
&gt;&gt;&gt; class F(O): pass
...
&gt;&gt;&gt; class E(O): pass
...
&gt;&gt;&gt; class D(O): pass
...
&gt;&gt;&gt; class C(D,F): pass
...
&gt;&gt;&gt; class B(E,D): pass
...
&gt;&gt;&gt; class A(B,C): pass
...
&gt;&gt;&gt; A.mro()
[
    &lt;class '__main__.A'&gt;, &lt;class '__main__.B'&gt;,
    &lt;class '__main__.E'&gt;, &lt;class '__main__.C'&gt;,
    &lt;class '__main__.D'&gt;, &lt;class '__main__.F'&gt;,
    &lt;class 'object'&gt;
]
</code></pre> <h3 id="an-example-of-the-nonexistence-of-linearization-1">An example of the nonexistence of linearization</h3> <div class="row row-cols-2 align-items-center"> <div class="col-sm-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/OXYAB.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/OXYAB.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes O, X, Y, A and B.</figcaption> </figure> </div> <div class="col-sm-9"> <pre class="language-python">
            <code class="language-python hljs">O = object

class X(O): pass
class Y(O): pass

class A(X,Y): pass
class B(Y,X): pass

class C(A,B): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes O, X, Y, A and B.</figcaption> </div> </div> <p>The linearization of $O$, $X$, $Y$ (represented by $L[O]$, $L[X]$, $L[Y]$) are derived like the following equation:</p> \[\begin{split} L[O] &amp;= O \\ L[X] &amp;= L[X(O)] = X + merge(L[O], O) = X L[O] = XO\\ L[Y] &amp;= L[Y(O)] = Y + merge(L[O], O) = Y L[O] = YO \end{split}\] <p>The linearization of $A$ (represented by $L[A]$ or $L[A(X\;Y)]$ in a more explicit form) can be computed using the following equation:</p> \[\begin{split} L[A] = L[A(X\;Y)] &amp;= A + merge[L[X],\;L[Y],\;XY] \\ &amp;= A + merge[XO,\;YO, XY] \\ &amp;= AX + merge[O,\;YO, Y] \\ &amp;= AXY + merge[O,\;O] \\ &amp;= AXYO \end{split}\] <p>Now we can compute the linearization of $B$ (represented by $L[B]$ or $L[B(Y\;X)]$ in a more explicit form) using the following equation:</p> \[\begin{split} L[B] = L[B(Y\;X)] &amp;= B + merge[L[Y],\;L[X],\;YX]\\ &amp;= B + merge[YO,\;XO,\;YX] \\ &amp;= BY + merge[O,\;XO,\;X] \\ &amp;= BYX + merge[O,\;O] \\ &amp;= BYXO \end{split}\] <p>Now we can compute the linearization of $C$ (represented by $L[C]$ or $L[C(A\;B)]$ in a more explicit form) using the following equation:</p> \[\begin{split} L[C] = L[C(A\;B)] &amp;= C + merge[L[A],\;L[B],\;AB]\\ &amp;= C + merge[AXYO,\;BYXO,\;AB]\\ &amp;= CA + merge[XYO,\;BYXO,\;B]\\ &amp;= CAB + merge[XYO,\;YXO] \end{split}\] <p>$merge[XYO,\;YXO]$ cannot be calculated since $X$ is in the tail of $YXO$ whereas $Y$ is in the tail of $XYO$. Therefore there are no good heads and the C3 algorithm stops. Python 2.3 raises an error and refuses to create the class $C$ like the following results of the python interpreter execution.</p> <pre><code class="language-python">&gt;&gt;&gt; O = object
&gt;&gt;&gt; class X(O): pass
...
&gt;&gt;&gt; class Y(O): pass
...
&gt;&gt;&gt; class A(X,Y): pass
...
&gt;&gt;&gt; class B(Y,X): pass
...
&gt;&gt;&gt; class C(A,B): pass
...
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: Cannot create a consistent method resolution
order (MRO) for bases X, Y
</code></pre> <h2 id="bad-method-resolution-orders">Bad Method Resolution Orders</h2> <h3 id="class-defining-built-in-function">Class Defining Built-in Function</h3> <dl> <dt><code>class type(name, bases, dict, **kwds)</code></dt> <dd>Details of this built-in function can be found in this article<sup id="fnref:Built-in-Functions__type" role="doc-noteref"><a href="#fn:Built-in-Functions__type" class="footnote" rel="footnote">2</a></sup>. <ul> <li> <code>name</code> : a string of the class name and becomes the <code>__name__</code> attribute.</li> <li> <code>bases</code> : a tuple contains the base lasses and becomes the <code>__bases__</code> attribute.</li> <li> <code>dict</code> : a dictionary containts attribute and method definitions for the class body</li> </ul> </dd> </dl> <h3 id="an-example-of-ambiguous-hierarchies">An Example of Ambiguous Hierarchies.</h3> <p>Using this <code>type</code> function, the following codes are defining a class $F$, $E$ and $G$.</p> <pre><code class="language-python">&gt;&gt;&gt; F=type('Food',(),{'remember2buy':'spam'})
&gt;&gt;&gt; F.remember2buy
'spam'
&gt;&gt;&gt; E=type('Eggs',(F,),{'remember2buy':'eggs'})
&gt;&gt;&gt; E.remember2buy
'eggs'
&gt;&gt;&gt; G=type('GoodFood',(F,E),{}) # under Python 2.3 this is an error!
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: Cannot create a consistent method resolution
order (MRO) for bases Food, Eggs
</code></pre> <div class="row row-cols-2 align-items-center"> <div class="col-sm"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/FEG.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/FEG.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/FEG.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/FEG.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes F, E and G.</figcaption> </figure> </div> </div> <p>The linearization of $G$ (represented by $L[G]$ or $L[G(F\;E)]$ in a more explicit form) can be calculated by the following equation:</p> \[\begin{split} L[F] = L[F(O)] &amp;= F + merge(L[O],\;O) = F + merge(O,\;O) = FO\\ L[E] = L[E(F)] &amp;= E + merge(L[F],\;F) = E + merge(O,\;F) = EFO \end{split}\] \[\begin{split} L[G] = L[G(F\;E)] &amp;= G + merge(L[F],\;L[E],\;FE)\\ &amp;= G + merge(FO,\;EFO,\;FE) \end{split}\] <p>In C3 algorithm, $merge(FO,\;EFO,\;FE)$ cannot be calculated because $F$ is the tail of $EFO$ and $E$ is the tail of $FE$. This is the reason of <code>TypeError: Cannot create a consistent method resolution order (MRO) for bases Food, Eggs</code>.</p> <p>On the other hands, class $G$ can be defined in Python 2.2 without <code>TypeError</code> and the linearization of $G$ ($L[G]$) can be calculated and retrived from <code>G.mro()</code>. The results of <code>G.mro()</code> represents the following linearization of $G$.</p> <pre><code class="language-python">Python 2.2.3 (#1, Jul 17 2023, 01:41:16)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; F=type('Food',(),{'remember2buy':'spam'})
&gt;&gt;&gt; F.remember2buy
'spam'
&gt;&gt;&gt; E=type('Eggs',(F,),{'remember2buy':'eggs'})
&gt;&gt;&gt; E.remember2buy
'eggs'
&gt;&gt;&gt; G=type('GoodFood',(F,E),{}) # No error occurs on this definition in Python 2.2
&gt;&gt;&gt; G.remember2buy
'eggs'
&gt;&gt;&gt; G.mro()
[&lt;class '__main__.GoodFood'&gt;, &lt;class '__main__.Eggs'&gt;, &lt;class '__main__.Food'&gt;, &lt;type 'object'&gt;]
</code></pre> \[L[G] = GEFO\] <p>As a general rule, hierarchies such as the previous one should be avoided, because it is unclear whether $F$ should override $E$ or vice versa. Python 2.3 solves this ambiguity by raising an exception in the creation of class $G$, effectively preventing the programmer from generating ambiguous hierarchies. The reason for that is that the C3 algorithm fails when the $merge(FO,\;EFO,\;FE)$.</p> <p>The correct solution is to design a non-ambiguous hierarchy, idx.e. to derive $G$ from $E$ and $F$ (with the more specific class $G$ placed at first) instead of deriving $G$ from $F$ and $E$. In this case the MRO will be $GEF$ without any doubt.</p> <h3 id="an-example-of-error-prone-hierarchies">An Example of Error-prone Hierarchies</h3> <p>Python 2.3 forces the programmer to write good hierarchies (or, at least, less error-prone ones).</p> <p>On a related note, let me point out that the Python 2.3 algorithm is smart enough to recognize obvious mistakes, as the duplication of classes in the list of parents:</p> <pre><code class="language-python">Python 3.11.1 (main, Feb  4 2023, 17:05:54) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; class A(object): pass
...
&gt;&gt;&gt; class C(A,A): pass
...
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: duplicate base class A
</code></pre> <p>The reason of <code>TypeError</code> on this code can be checked by the following equations:</p> \[\begin{split} L[A(O)] &amp;= A + merge(L[O], O) = A + merge(O, O) = AO\\ L[C(A\;A)] &amp;= C + merge(L[A],\;L[A],\;AA) \\ &amp;= C + merge(AO, AO, AA) \end{split}\] <p>The results of linearization of $C$ (represented by $L[C(A\;A)]$) yields $merge(AO, AO, AA)$ which has no good head because $A$ is the tail of $AA$.</p> <p>On the other hands, Python 2.2 (both for classic classes and new style classes) in this situation, would not raise any exception.</p> <p>Finally, I would like to point out a lesson we have learned from this example:</p> <p>Despite the name, the MRO determines the resolution order of attributes, not only methods.</p> <pre><code class="language-python">Python 2.2.3 (#1, Jul 17 2023, 01:41:16)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; class A(object): pass
...
&gt;&gt;&gt; class C(A,A): pass # No error occurs in this definition!
...
&gt;&gt;&gt; C.mro()
[&lt;class '__main__.C'&gt;, &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;]
</code></pre> <h3 id="an-example-without-monotonicity">An example without Monotonicity</h3> <div class="row row-cols-2 align-items-center"> <div class="col-sm-4"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/CABD.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/CABD.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/CABD.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/CABD.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes C, A, B, and D.</figcaption> </figure> </div> <div class="col-sm-6"> <pre class="language-python">
            <code class="language-python hljs">C = object

class A(C): pass
class B(C): pass

class D(A,B): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes C, A, B, and D.</figcaption> </div> </div> \[\begin{split} L[A(C)] &amp;= A + merge(L[C], C) = A + merge(C,C) = AC\\ L[B(C)] &amp;= B + merge(L[C], C) = B + merge(C,C) = BC\\ L[D(A\;B)] &amp;= D + merge(L[A],\;L[B],\;AB)\\ &amp;= D + merge(AC,\;BC,\;AB)\\ &amp;= DA + merge(C,\;BC,\;B)\\ &amp;= DAB + merge(C,\;C)\\ &amp;= DABC \end{split}\] <p>Python 2.2 yields MRO as $DABC$ as described above equations.</p> <pre><code class="language-python">Python 2.2.3 (#1, Jul 17 2023, 02:59:21)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; C = object
&gt;&gt;&gt; class A(C): pass
...
&gt;&gt;&gt; class B(C): pass
...
&gt;&gt;&gt; class D(A,B): pass
...
&gt;&gt;&gt; D.mro()
[
    &lt;class '__main__.D'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;type 'object'&gt;
]
</code></pre> <p>Python 3.11 yields MRO as $DABC$ as described above equations.</p> <pre><code class="language-python">Python 3.11.1 (main, Feb  4 2023, 17:05:54) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; C = object
&gt;&gt;&gt; C.mro()
[&lt;class 'object'&gt;]
&gt;&gt;&gt; class A(C): pass
...
&gt;&gt;&gt; class B(C): pass
...
&gt;&gt;&gt; A.mro()
[&lt;class '__main__.A'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; B.mro()
[&lt;class '__main__.B'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; class D(A,B): pass
...
&gt;&gt;&gt; D.mro()
[
    &lt;class '__main__.D'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class 'object'&gt;
]
</code></pre> <p>On the other hands, Python 2.1 yields $L[D] = DACBC$.</p> <h3 id="a-complex-example">A complex example</h3> <h4 id="class-definition">Class Definition</h4> <div class="row row-cols-2 align-items-center"> <div class="col-sm-6"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/python/standard-library/c3_method_resolution_order/ABCDEK1K2K3Z.svg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/python/standard-library/c3_method_resolution_order/ABCDEK1K2K3Z.svg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/python/standard-library/c3_method_resolution_order/ABCDEK1K2K3Z.svg-1400.webp"></source> <img src="/python/standard-library/c3_method_resolution_order/ABCDEK1K2K3Z.svg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">UML diagram of classes A, B, C, D, E, K1, K2, K3, and Z</figcaption> </figure> </div> <div class="col-sm-6"> <pre class="language-python">
            <code class="language-python hljs">O = object

class A(O): pass
class B(O): pass
class C(O): pass
class D(O): pass
class E(O): pass

class K1(A,B,C): pass
class K2(D,B,E): pass
class K3(D,A):   pass

class Z(K1,K2,K3): pass
            </code>
        </pre> <figcaption class="caption">Source code of classes A, B, C, D, E, K1, K2, K3, and Z.</figcaption> </div> </div> <h4 id="the-results-of-c3-mro">The results of C3 MRO</h4> <p>The results of linearization of class $A$, $B$, $C$, $D$ and $E$ (represented by $L[A(O)]$, $L[B(O)]$, $L[C(O)]$, $L[D(O)]$, $L[E(O)]$) can be derived by the following equations with C3 MRO.</p> \[\begin{split} L[O] &amp;= O + merge(L[O,\; O]) = O\\ L[A(O)] &amp;= A + merge(L[O],\; O) = A + merge(O,\;O) = AO\\ L[B(O)] &amp;= B + merge(L[O],\; O) = B + merge(O,\;O) = BO\\ L[C(O)] &amp;= C + merge(L[O],\; O) = C + merge(O,\;O) = CO\\ L[D(O)] &amp;= D + merge(L[O],\; O) = D + merge(O,\;O) = DO\\ L[E(O)] &amp;= E + merge(L[O],\; O) = E + merge(O,\;O) = EO\\ \end{split}\] <p>The results of linearization of $K_1$, $K_2$, and $K_3$ (represented by $L[K_1(A,\;B,\;C)]$, $L[K_2(D,\;B,\;E)]$, $L[K_3(D,\;A)]$) can be derived by the following equations.</p> \[\begin{split} L[K_1(A,\;B,\;C)] &amp;= K_1 + merge(L[A],\;L[B],\;L[C],\;ABC)\\ &amp;= K_1 + merge(AO,\;BO,\;CO,\;ABC)\\ &amp;= K_1A + merge(O,\;BO,\;CO,\;BC)\\ &amp;= K_1AB + merge(O,\;O,\;CO,\;C)\\ &amp;= K_1ABC + merge(O,\;O,\;O)\\ &amp;= K_1ABCO \end{split}\] \[\begin{split} L[K_2(D,\;B,\;E)] &amp;= K_2 + merge(L[D],\;L[B],\;L[E],\;DBE)\\ &amp;= K_2 + merge(DO,\;BO,\;EO,\;DBE)\\ &amp;= K_2D + merge(O,\;BO,\;EO,\;BE)\\ &amp;= K_2DB + merge(O,\;O,\;EO,\;E)\\ &amp;= K_2DBE + merge(O,\;O,\;O)\\ &amp;= K_2DBEO \end{split}\] \[\begin{split} L[K_3(D,\;A)] &amp;= K_3 + merge(L[D],\;L[A],\;DA)\\ &amp;= K_3 + merge(DO,\;AO,\;DA)\\ &amp;= K_3D + merge(O,\;AO,\;A)\\ &amp;= K_3DA + merge(O,\;O)\\ &amp;= K_3DAO \end{split}\] <p>The results of linearization of $Z$ (represented by $L[Z(K_1,\;K_2,\;K_3)]$) can be derived by the following equations.</p> \[\begin{split} L[Z(K_1,\;K_2,\;K_3)] &amp;= Z + merge(L[K_1],\;L[K_2],\;L[K_3],\;K_1K_2K_3)\\ &amp;= Z + merge(K_1ABCO,\;K_2DBEO,\;K_3DAO,\;K_1K_2K_3)\\ &amp;= ZK_1 + merge(ABCO,\;K_2DBEO,\;K_3DAO,\;K_2K_3)\\ &amp;= ZK_1K_2 + merge(ABCO,\;DBEO,\;K_3DAO,\;K_3)\\ &amp;= ZK_1K_2K_3 + merge(ABCO,\;DBEO,\;DAO)\\ &amp;= ZK_1K_2K_3D + merge(ABCO,\;BEO,\;AO)\\ &amp;= ZK_1K_2K_3DA + merge(BCO,\;BEO,\;O)\\ &amp;= ZK_1K_2K_3DAB + merge(CO,\;EO,\;O)\\ &amp;= ZK_1K_2K_3DABC + merge(O,\;EO,\;O)\\ &amp;= ZK_1K_2K_3DABCE + merge(O,\;O,\;O)\\ &amp;= ZK_1K_2K_3DABCEO \end{split}\] <p>To summarize the results of linearization of each classes by C3 MRO are represented by the following equations.</p> \[\begin{split} L[A(O)] &amp;= AO \\ L[B(O)] &amp;= BO \\ L[C(O)] &amp;= CO \\ L[D(O)] &amp;= DO \\ L[E(O)] &amp;= EO \\ L[K_1(A,\;B,\;C)] &amp;= K_1ABCO \\ L[K_2(D,\;B,\;E)] &amp;= K_2DBEO \\ L[K_3(D,\;A)] &amp;= K_3DAO \\ L[Z(K_1,\;K_2,\;K_3)] &amp;= ZK_1K_2K_3DABCEO \end{split}\] <h4 id="source-code-for-checking-mro">Source Code for checking MRO</h4> <p>These results can be checked by the following Python code on Python 2.2 or a later version. This is because the Python 2.1 or earlier versions do not have <code>object</code> type.</p> <pre><code class="language-python">O = object
class A(O): pass
class B(O): pass
class C(O): pass
class D(O): pass
class E(O): pass

class K1(A,B,C): pass
class K2(D,B,E): pass
class K3(D,A):   pass

class Z(K1,K2,K3): pass

A.mro()
B.mro()
C.mro()
D.mro()
E.mro()
K1.mro()
K2.mro()
K3.mro()
Z.mro()
</code></pre> <h4 id="results-in-python-22">Results in Python 2.2</h4> <pre><code class="language-python">Python 2.2.3 (#1, Jul 18 2023, 04:37:32)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; O = object
&gt;&gt;&gt; class A(O): pass
...
&gt;&gt;&gt; class B(O): pass
...
&gt;&gt;&gt; class C(O): pass
...
&gt;&gt;&gt; class D(O): pass
...
&gt;&gt;&gt; class E(O): pass
...
&gt;&gt;&gt; class K1(A,B,C): pass
...
&gt;&gt;&gt; class K2(D,B,E): pass
...
&gt;&gt;&gt; class K3(D,A):   pass
...
&gt;&gt;&gt; class Z(K1,K2,K3): pass
...
&gt;&gt;&gt; A.mro()
[&lt;class '__main__.A'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; B.mro()
[&lt;class '__main__.B'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; C.mro()
[&lt;class '__main__.C'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; D.mro()
[&lt;class '__main__.D'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; E.mro()
[&lt;class '__main__.E'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; K1.mro()
[
    &lt;class '__main__.K1'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;type 'object'&gt;
]
&gt;&gt;&gt; K2.mro()
[
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.E'&gt;,
    &lt;type 'object'&gt;
]
&gt;&gt;&gt; K3.mro()
[
    &lt;class '__main__.K3'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;
]
&gt;&gt;&gt; Z.mro()
[
    &lt;class '__main__.Z'&gt;, &lt;class '__main__.K1'&gt;,
    &lt;class '__main__.K3'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;class '__main__.E'&gt;, &lt;type 'object'&gt;
]
</code></pre> <p>To summarize the results of executing the above source code, the linearizations of each class are represented by the following equations.</p> \[\begin{split} L[A(O)] &amp;= AO \\ L[B(O)] &amp;= BO \\ L[C(O)] &amp;= CO \\ L[D(O)] &amp;= DO \\ L[E(O)] &amp;= EO \\ L[K_1(A,\;B,\;C)] &amp;= K_1ABCO \\ L[K_2(D,\;B,\;E)] &amp;= K_2DBEO \\ L[K_3(D,\;A)] &amp;= K_3DAO \\ L[Z(K_1,\;K_2,\;K_3)] &amp;= ZK_1K_3AK_2DBCEO \end{split}\] <p>The result of linearization of class $Z$($L[Z(K_1,\;K_2,\;K_3)]$) is different from the results of C3 MRO ($L[Z(K_1,\;K_2,\;K_3)] = ZK_1K_2K_3DABCEO$).</p> <p>It is clear that this linearization is wrong, since $A$ comes before $D$ whereas in the linearization of $K_3$ $A$ comes after $D$. In other words, in $K_3$, methods derived by $D$ override methods derived by $A$, but in $Z$, which still is a subclass of $K_3$, methods derived by $A$ override methods derived by $D$.</p> <p>This is a violation of monotonicity. Moreover, the Python 2.2 linearization of $Z$ is also inconsistent with local precedence ordering, since the local precedence list of the class $Z$ is <code>[K1, K2, K3]</code> ($K_2$ precedes $K_3$), whereas in the linearization of $Z$, $K_2$ follows $K_3$. These problems explain why the 2.2 rule has been dismissed in favor of the C3 MRO rule.</p> <h4 id="results-in-python-23">Results in Python 2.3</h4> <pre><code class="language-python">Python 2.3.7 (#1, Jul 18 2023, 04:48:37)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; O = object
&gt;&gt;&gt; class A(O): pass
...
&gt;&gt;&gt; class B(O): pass
...
&gt;&gt;&gt; class C(O): pass
...
&gt;&gt;&gt; class D(O): pass
...
&gt;&gt;&gt; class E(O): pass
...
&gt;&gt;&gt; class K1(A,B,C): pass
...
&gt;&gt;&gt; class K2(D,B,E): pass
...
&gt;&gt;&gt; class K3(D,A):   pass
...
&gt;&gt;&gt; class Z(K1,K2,K3): pass
...
&gt;&gt;&gt; A.mro()
[&lt;class '__main__.A'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; B.mro()
[&lt;class '__main__.B'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; C.mro()
[&lt;class '__main__.C'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; D.mro()
[&lt;class '__main__.D'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; E.mro()
[&lt;class '__main__.E'&gt;, &lt;type 'object'&gt;]
&gt;&gt;&gt; K1.mro()
[
    &lt;class '__main__.K1'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;type 'object'&gt;
]
&gt;&gt;&gt; K2.mro()
[
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.E'&gt;,
    &lt;type 'object'&gt;
]
&gt;&gt;&gt; K3.mro()
[
    &lt;class '__main__.K3'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;
]
&gt;&gt;&gt; Z.mro()
[
    &lt;class '__main__.Z'&gt;, &lt;class '__main__.K1'&gt;,
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.K3'&gt;,
    &lt;class '__main__.D'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;class '__main__.E'&gt;, &lt;type 'object'&gt;
]
</code></pre> <p>To summarize the results of executing the above source code, the linearizations of each class are represented by the following equations.</p> \[\begin{split} L[A(O)] &amp;= AO \\ L[B(O)] &amp;= BO \\ L[C(O)] &amp;= CO \\ L[D(O)] &amp;= DO \\ L[E(O)] &amp;= EO \\ L[K_1(A,\;B,\;C)] &amp;= K_1ABCO \\ L[K_2(D,\;B,\;E)] &amp;= K_2DBEO \\ L[K_3(D,\;A)] &amp;= K_3DAO \\ L[Z(K_1,\;K_2,\;K_3)] &amp;= ZK_1K_2K_3DABCEO \end{split}\] <p>The result of linearization of class $Z$($L[Z(K_1,\;K_2,\;K_3)]$) is same as the results of C3 MRO ($L[Z(K_1,\;K_2,\;K_3)] = ZK_1K_2K_3DABCEO$).</p> <h4 id="results-in-python-311">Results in Python 3.11</h4> <p>Results in Python 3.11 are same as the results in Python 2.3</p> <p>The result of linearization of class $Z$($L[Z(K_1,\;K_2,\;K_3)]$) is same as the results of C3 MRO ($L[Z(K_1,\;K_2,\;K_3)] = ZK_1K_2K_3DABCEO$).</p> <pre><code class="language-python">Python 3.11.1 (main, Feb  4 2023, 17:05:54) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; O = object
&gt;&gt;&gt; class A(O): pass
...
&gt;&gt;&gt; class B(O): pass
...
&gt;&gt;&gt; class C(O): pass
...
&gt;&gt;&gt; class D(O): pass
...
&gt;&gt;&gt; class E(O): pass
...
&gt;&gt;&gt; class K1(A,B,C): pass
...
&gt;&gt;&gt; class K2(D,B,E): pass
...
&gt;&gt;&gt; class K3(D,A):   pass
...
&gt;&gt;&gt; class Z(K1,K2,K3): pass
...
&gt;&gt;&gt; A.mro()
[&lt;class '__main__.A'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; B.mro()
[&lt;class '__main__.B'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; C.mro()
[&lt;class '__main__.C'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; D.mro()
[&lt;class '__main__.D'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; E.mro()
[&lt;class '__main__.E'&gt;, &lt;class 'object'&gt;]
&gt;&gt;&gt; K1.mro()
[
    &lt;class '__main__.K1'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;class 'object'&gt;
]
&gt;&gt;&gt; K2.mro()
[
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.E'&gt;,
    &lt;class 'object'&gt;
]
&gt;&gt;&gt; K3.mro()
[
    &lt;class '__main__.K3'&gt;, &lt;class '__main__.D'&gt;,
    &lt;class '__main__.A'&gt;, &lt;class 'object'&gt;
]
&gt;&gt;&gt; Z.mro()
[
    &lt;class '__main__.Z'&gt;, &lt;class '__main__.K1'&gt;,
    &lt;class '__main__.K2'&gt;, &lt;class '__main__.K3'&gt;,
    &lt;class '__main__.D'&gt;, &lt;class '__main__.A'&gt;,
    &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;,
    &lt;class '__main__.E'&gt;, &lt;class 'object'&gt;
]
</code></pre> <h2 id="mro-calculation-codes-for-python-22">MRO Calculation Codes for Python 2.2</h2> <pre><code class="language-python">#&lt;mro.py&gt;

"""C3 algorithm by Samuele Pedroni (with readability enhanced by me)."""

class __metaclass__(type):
    "All classes are metamagically modified to be nicely printed"
    __repr__ = lambda cls: cls.__name__

class ex_2:
    "Serious order disagreement" #From Guido
    class O: pass
    class X(O): pass
    class Y(O): pass
    class A(X,Y): pass
    class B(Y,X): pass
    try:
        class Z(A,B): pass #creates Z(A,B) in Python 2.2
    except TypeError:
        pass # Z(A,B) cannot be created in Python 2.3

class ex_5:
    "My first example"
    class O: pass
    class F(O): pass
    class E(O): pass
    class D(O): pass
    class C(D,F): pass
    class B(D,E): pass
    class A(B,C): pass

class ex_6:
    "My second example"
    class O: pass
    class F(O): pass
    class E(O): pass
    class D(O): pass
    class C(D,F): pass
    class B(E,D): pass
    class A(B,C): pass

class ex_9:
    "Difference between Python 2.2 MRO and C3" #From Samuele
    class O: pass
    class A(O): pass
    class B(O): pass
    class C(O): pass
    class D(O): pass
    class E(O): pass
    class K1(A,B,C): pass
    class K2(D,B,E): pass
    class K3(D,A): pass
    class Z(K1,K2,K3): pass

def merge(seqs):
    print '\n\nCPL[%s]=%s' % (seqs[0][0],seqs),
    res = []; i=0
    while 1:
      nonemptyseqs=[seq for seq in seqs if seq]
      if not nonemptyseqs: return res
      i+=1; print '\n',i,'round: candidates...',
      for seq in nonemptyseqs: # find merge candidates among seq heads
          cand = seq[0]; print ' ',cand,
          nothead=[s for s in nonemptyseqs if cand in s[1:]]
          if nothead: cand=None #reject candidate
          else: break
      if not cand: raise "Inconsistent hierarchy"
      res.append(cand)
      for seq in nonemptyseqs: # remove cand
          if seq[0] == cand: del seq[0]

def mro(C):
    "Compute the class precedence list (mro) according to C3"
    return merge([[C]]+map(mro,C.__bases__)+[list(C.__bases__)])

def print_mro(C):
    print '\nMRO[%s]=%s' % (C,mro(C))
    print '\nP22 MRO[%s]=%s' % (C,C.mro())

print_mro(ex_9.Z)

#&lt;/mro.py&gt;
</code></pre> <p>The results of <code>print_mro(ex_9.Z)</code> in Python 2.2.3 is described in below codes.</p> <pre><code class="language-python">Python 2.2.3 (#1, Jul 19 2023, 03:00:12)
[GCC 9.4.0] on linux5
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; print_mro(ex_9.Z)


CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[A]=[[A], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   A
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[B]=[[B], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   B
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[C]=[[C], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   C
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[K1]=[[K1], [A, O, &lt;type 'object'&gt;], [B, O, &lt;type 'object'&gt;], [C, O, &lt;type 'object'&gt;], [A, B, C]]
1 round: candidates...   K1
2 round: candidates...   A
3 round: candidates...   O   B
4 round: candidates...   O   O   C
5 round: candidates...   O
6 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[D]=[[D], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   D
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[B]=[[B], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   B
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[E]=[[E], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   E
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[K2]=[[K2], [D, O, &lt;type 'object'&gt;], [B, O, &lt;type 'object'&gt;], [E, O, &lt;type 'object'&gt;], [D, B, E]]
1 round: candidates...   K2
2 round: candidates...   D
3 round: candidates...   O   B
4 round: candidates...   O   O   E
5 round: candidates...   O
6 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[D]=[[D], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   D
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[&lt;type 'object'&gt;]=[[&lt;type 'object'&gt;], []]
1 round: candidates...   &lt;type 'object'&gt;

CPL[O]=[[O], [&lt;type 'object'&gt;], [&lt;type 'object'&gt;]]
1 round: candidates...   O
2 round: candidates...   &lt;type 'object'&gt;

CPL[A]=[[A], [O, &lt;type 'object'&gt;], [O]]
1 round: candidates...   A
2 round: candidates...   O
3 round: candidates...   &lt;type 'object'&gt;

CPL[K3]=[[K3], [D, O, &lt;type 'object'&gt;], [A, O, &lt;type 'object'&gt;], [D, A]]
1 round: candidates...   K3
2 round: candidates...   D
3 round: candidates...   O   A
4 round: candidates...   O
5 round: candidates...   &lt;type 'object'&gt;

CPL[Z]=[[Z], [K1, A, B, C, O, &lt;type 'object'&gt;], [K2, D, B, E, O, &lt;type 'object'&gt;], [K3, D, A, O, &lt;type 'object'&gt;], [K1, K2, K3]]
1 round: candidates...   Z
2 round: candidates...   K1
3 round: candidates...   A   K2
4 round: candidates...   A   D   K3
5 round: candidates...   A   D
6 round: candidates...   A
7 round: candidates...   B
8 round: candidates...   C
9 round: candidates...   O   E
10 round: candidates...   O
11 round: candidates...   &lt;type 'object'&gt;
MRO[Z]=[Z, K1, K2, K3, D, A, B, C, E, O, &lt;type 'object'&gt;]

P22 MRO[Z]=[Z, K1, K3, A, K2, D, B, C, E, O, &lt;type 'object'&gt;]
</code></pre> <h2 id="links">Links</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:MRO-in-Python-2-3" role="doc-endnote"> <p><a href="https://www.python.org/download/releases/2.3/mro/" rel="external nofollow noopener" target="_blank">the method resolution order introduced in the Python 2.3</a> <a href="#fnref:MRO-in-Python-2-3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:Built-in-Functions__type" role="doc-endnote"> <p><a href="https://docs.python.org/3/library/functions.html#type" rel="external nofollow noopener" target="_blank">Built-in Functions : <code>class type(name, bases, dict, **kwds)</code></a> <a href="#fnref:Built-in-Functions__type" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Dongseok Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script> <script>hljs.highlightAll();</script> <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script> <script>hljs.initLineNumbersOnLoad();</script> <script>function append_code_block_header(e){if(!e.className)return;const[t,r]=get_language_and_url(e);r&&(replace_className(e,t),elemCodeBlockHeader=create_elem_code_block_header(r),append_elem_code_block_header_to_previous(e,elemCodeBlockHeader))}function get_language_and_url(e){return e.className.split(/:(.*)/s)}function replace_className(e,t){e.classList.remove(e.className),e.classList.add(t)}function create_elem_code_block_header(e){var t=document.createElement("a");return t.textContent=e,(e.startsWith("http://")||e.startsWith("https://"))&&(t.setAttribute("href",e),t.setAttribute("target","_blank")),t.className="language-plaintext",t}function append_elem_code_block_header_to_previous(e,t){var r=e.parentElement;r.insertBefore(t,r.firstChild),r.classList.add("code-block-header")}function embed_external_source(e){var t=get_url_raw(e),r=get_url_blob(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c),_={startFrom:Math.max(l,1)};e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c,_)})["catch"](function(e){throw e})}function embed_local_source(e){var t=get_url_raw_local(e),r=get_url_blob_local(e),n=e.getAttribute("language"),c=get_lines(e),l=c[0],a=c[1];fetch(t).then(function(e){return e.text()}).then(function(t){var c=create_elem_code_block(n,r,t,l,a),o=create_elem_pre_from_code_block(c);e.appendChild(o),hljs.highlightBlock(c),hljs.lineNumbersBlock(c)})["catch"](function(e){throw e})}function get_url_raw(e){return["https://raw.githubusercontent.com",e.getAttribute("repo"),e.getAttribute("branch"),e.getAttribute("path")].join("/")}function get_url_blob(e){return["https://github.com",e.getAttribute("repo"),"blob",e.getAttribute("branch"),e.getAttribute("path")+get_line_specifier(e)].join("/")}function get_url_raw_local(e){return e.getAttribute("path")}function get_url_blob_local(e){return get_url_raw_local(e)}function get_lines(e){const t=e.getAttribute("line");if(!t)return[0,0];var[r,n]=t.split(/-(.*)/s);return r=parseInt(r),n=parseInt(n),isNaN(r)&&(r=0),isNaN(n)&&(n=0),[r,n]}function get_line_specifier(e){const t=get_lines(e);return 0==t[0]&&0==t[1]?"":(0==t[1]&&t[1],"#L"+String(t[0])+"-L"+String(t[1]))}function create_elem_code_block(e,t,r,n,c){var l=document.createElement("code");return l.className="language-"+e+":"+t,l.textContent=slice_by_line_number(r,n,c),l}function slice_by_line_number(e,t,r){return 0==t&&0==r?e:(0==t&&(t=1),e.split("\n").slice(t-1,r).join("\n"))}function create_elem_pre_from_code_block(e){var t=document.createElement("pre");return t.appendChild(e),append_code_block_header(e),t}const code=document.getElementsByTagName("code");Array.from(code).forEach(append_code_block_header);var divs=document.getElementsByClassName("embed-github-src");Array.prototype.forEach.call(divs,embed_external_source);divs=document.getElementsByClassName("embed-local-src");Array.prototype.forEach.call(divs,embed_local_source);</script> </body> </html>